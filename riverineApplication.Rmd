# Riverine Application How To

```{r riverine setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The [Riverine Assessment App](https://rconnect.deq.virginia.gov/IR2024riverineAssessmentApp/) is located on the R server. **The linked version of the application is in draft development stage with DRAFT DATA until after the data solicitation deadline and final product release. Expect this release in late April 2023.**

The purpose of this tool is to expand upon the Station Table summary provided by the automated assessment methodology. A single parameter summary (or in the case of metals, toxics, etc. a single summary of multiple parameters) does not do justice to the data analyzed by the automated assessment process. The Riverine Assessment App provides an interactive data analysis experience to improve users' understanding of automated assessment analyses and decisions. The intended audience is any DEQ employee from regional assessors and field staff, to managers, providing better data understanding through interactive data visualizations, descriptive standard application and WQA guidance explanations, and statewide applicability. 

A notable benefit of these standardized tools is the increased accessibility of assessment decisions. No longer are assessment tools limited to regional assessment staff, resulting in bottlenecks when assessment questions arise. These self-service tools articulate assessment procedures to guide data and decision discussions across multiple end users. 

This tool is a companion to the Station Table throughout the decision-making process the regional assessment staff sustain as data is entered into WQA CEDS. The next sections will detail typical workflow procedures to using this tool for data exploration and/or assessment. 

## Application Orientation

This application brings station-level automated analyses provided in the Station Table to life through interactive data visualizations, maps, and tables. The tool is divided into three tabs that must be visited sequentially for proper application functionality. The `Data Upload` tab provides a basic overview of application data sources, provides download of the statewide Station Table resultant from previous automated assessment procedures, and requires upload of either the default Station Table or a custom Station Table (e.g. the Station Table filtered to a specific region). The `Watershed Selection` tab allows further investigation of particular assessment watersheds (VAHU6) by assessment region and major basin. This tab offers high level summaries of stations within a chosen assessment watershed as well as detailed exceedance summaries across assessment units through tools embedded in modal windows. The `Assessment Unit Review` tab dives into all assessment units and stations contained within a selected assessment watershed. By drilling down from watershed to assessment unit to station, users may explore assessment data against applicable Water Quality Standards and criteria to better understand how assessment guidance leads assessment staff to appropriate decisions across designated uses. Previous assessment decisions are provided along with all centrally stored assessment data to provide a full picture of stations that require addressing during a given assessment cycle.

## Application Use: Data Upload Tab

The `Data Upload` tab is the first screen to appear on application load. The purpose of this screen is to orient users to basic application usage and data sources and to provide a location to upload the Station Table. The Station Table is key to running any subsequent parts of this application. Users may download the latest copy of the statewide Station Table using the `Download statewide example dataset to upload to the tool.` button at the bottom of the screen. Helptext below the download button indicates the last time the Station Table template was last updated. 

The Station Table must be uploaded to the application each time the tool is used. The reason the tool requires an upload of the Station Table each use is to allow flexibility for regional assessment staff to change station assessment unit (AU) designations throughout the assessment process. If this dataset were sourced from the R server like all other datasets used by the Riverine App, then assessors would need to notify the Assessment Data Analyst each time a station AU changes, is split, or requires additional AUs. By allowing the regional assessment staff to edit this information in a .csv, the application allows self-service changes to station organization.

Users may upload the entire statewide Station Table to the `Browse` button in the tool or a version filtered ans saved locally with just the region of interest. 

![](images/riverine1.png)

## Application Use: Watershed Selection Tab

The `Watershed Selection` tab allows users to choose a particular region to investigate further. Using the drop down menu in the sidebar panel, users must choose one assessment region and then click `Retrieve Assessment Units From Server` in order to proceed with any analyses. Based on the assessment region selected, the application then extracts the appropriate spatial data from standardized datasets saved on the R server and provides that information to the application. A progress message is visible in the lower right of the screen while this data transaction occurs.

Once this data is available to the application, the user may further refine data by dynamic filtering drop downs on the sidebar panel. Users may select from only the subbasins within the selected assessment region and then only the assessment watersheds (VAHU6) within the selected subbasin. An interactive map dynamically updates to display the user selection on the main panel of the application. Additional information about the each VAHU6 may be found in the popup table revealed upon clicking on a VAHU6 in the map. 


![](images/riverine2.png)
Proceeding down the sidebar panel, two buttons reveal modal dialog boxes with additional information about the selected VAHU6. The `Spatially Preview Stations and Assessment Units` button reveals a modal dialog box with an interactive map of all stations and AUs that fall within the chosen VAHU6. This box provides a preview summarizing the amount of information that must be addressed for the current IR cycle in the chosen VAHU6. AUs are colored by their desingated name and hovering over the AU reveals the name. Clicking the AU segment brings up a popup table with additional AU information. All stations with information related to the current IR cycle are displayed based on whether or not they have data within the cycle. Hovering and clicking on a given station reveals additional station information with dialog boxes and popup tables, respectively. The dialog box may be closed by either clicking outside the box in the grayed out area of the application or by using the `Dismiss` button.

![](images/riverine3.png)

The `Watershed Status Overview` button reveals a modal dialog box that quickly summarizes station parameter statuses throughout the selected VAHU6. For application rendering speed, the statuses displayed are from the uploaded Station Table. Should a user change a parameter status in the Station Table uploaded to the application, then the resultant status map could change.

![](images/riverine4.png)

The map presents an overall station overview where each station in the selected VAHU6 is colored based on the most harmful status category (e.g. if a station has 8 Supporting parameter statuses, 2 Insufficient parameter statuses, and 1 Impaired status, the station will be colored red to reflect the Impaired status). The number of statuses in the most harmful category is reported for each station in the popup table (accessed by clicking the station in the map). The `Choose parameter to report station status` drop down is set to "Overall Status" by default on modal load, but any parameter specified in the Station Table may be selected to redraw the map with only that parameter status displayed. The dialog box may be closed by either clicking outside the box in the grayed out area of the application or by using the `Dismiss` button.

![](images/riverine5.png)


The main panel of the `Watershed Selection` tab details information about the selected VAHU6. The interactive map describes spatially where the VAHU6 falls within the basin. Subsequent tables detail the AUs and stations within the VAHU6. The "Assessment Units in Selected VAHU6" table lists all AUs that fall inside the selected VAHU6, retrieved from the previous Assessment cycle. The "Stations in Selected VAHU6 that were sampled in current window" table identifies all stations that fall within the VAHU6 with "conventionals" data in the current Assessment cycle. The stations highlighted in gray can be analyzed by the application. The stations highlighted in yellow were sampled in the current window, but cannot be analyzed by the application because they are not designated as the appropriate waterbody type (using AU naming system) in the input stations table (e.g. stations linked to lake AUs cannot be analyzed appropriately in the riverine app and are thus highlighted yellow here). The last table identifies stations in selected VAHU6 that have no data in the current window but were carried over from last cycle due to an IM designation in one of the previous IR status fields or the previous IR stations table reports the station was carried over from a more previous cycle. The purpose of this table is to identify which stations in the selected VAHU6 are carried over from a previous cycle and require review before carrying forward another cycle. These stations can be viewed in the application and stations table, but none of the parameter modules will display data as no data is available in the current window.


## Application Use: Assessment Unit Review Tab

After selecting a VAHU6 to investigate on the `Watershed Review` tab, the `Assessment Unit Review` tab is where the user will find the most interactive analytical tools. The tab provides a drill-down view of all assessment data related to the selected VAHU6. Users explore the chosen VAHU6 using a heirarchical schema from VAHU6 -> AUs within the VAHU6 -> Stations within the AU. 

The table at the top of the tab reminds the user which VAHU6 is currently selected for investigation and which major basin ths VAHU6 falls in. The "Assessment Unit Selection" drop down allows users to choose from all AUs within the chosen VAHU6. These AUs are retrieved from the final AU spatial layer from the previous cycle. The table immediately below this drop down provides AU information for the chosen AU from the previous cycle as a summary of use attainment and AU comments in the most previous cycle. If, during the assessment process, an AU is split or renamed to a name not contained within the previous cycle final AU spatial layer and the Station Table uploaded to the application contains this new/changed AU, the previous final AU spatial layer will not contain information about this AU. However, the application will still allow the user to perform all expected analyses without this information. 

Based on the AU selected, all stations attributed to the AU are available in the subsequent "Station Selection" drop down. The stations available in the drop down are limited to stations with an ID305B_1:ID305B_10 designation equal to the selected AU as provided in the uploaded Station Table. Once a station is selected, all further visualizations and analyses pertain to that station. In the subsequent panel, current and previous information about the selected station are provided. On the left, a table provides station and WQS information, organizing AU and station type designations (pulled from the uploaded Station Table) and WQS information (pulled from pinned data on the R server, originally provided by the regional assessor during the previous metadata steps). A thumbnail map identifies the station and all associated AUs. The table on the right provides Station Table results from the two most previous assessment cycles to collate relevant historical information about the station in one area. 

![](images/riverine6.png)

Information specific to the current assessment cycle is presented below the general station information panel. The "Station Table Results" table outputs the site specific results for direct export to the Station Table. It also serves to highlight where exceedances are present and should be reviewed in the individual parameter visualization tabs below. If no station table appears, then there is no data within the assessment window for the selected station. Please investigate the Historical Station Information table above for information as to why this station is included in the application. In the "Station Table Results" table, parameters are highlighted in different colors to indicate further review may be necessary. Parameters highlighted in yellow have at least one violation of a standard or criteria. When BENTHIC_STAT is highlighted, it indicates there is benthic data available for that site and the assessor should review that information with information presented in the `Benthic` tab below and their Regional Biologist. Parameters highlighted in red exceed the 10.5% exceedance rate. Both scenarios warrant further investigation and may require comments in the Station Table and CEDS WQA.

**Pro Tip: The "Station Table Results" table is editable by the user. This is helpful when the user wants to minimize the number of applications running throughout a given assessment session. Should the assessor determine that an automated result presented in the table requires changing, they may triple-click (click three times in rapid succession) on the cell that needs the change to reveal a text entry box. The user may edit that cell to whatever they desire, preferably following the rules outlined in the Data Entry Manual. Regardless whether any cells were manipulated, the user may use the Copy/CSV/Excel buttons above the table to copy the table information to their clipboard or download the information as the chose file format.**

The "PWS Criteria" table indicates PWS criteria results if the chosen station has PWS designation in the WQS metadata attached to the station. If PWS criteria apply to the station, note that Chloride, Sulfate, Total Dissolved Solids, Iron, and Foaming Agents are secondary criteria and are only applicable to data collected at the drinking water intake. A flag is presented in this section if the station selected falls within 100 meters of a drinking water intake to improve the assessment of these parameters. No set distance is established in guidance to define a station "at the intake" and assessor digression is encouraged to determine whether these secondary standards apply to data collected at the station.


![](images/riverine7.png)


The "Assessment Unit Raw Data Review and Visualization" area organizes all the standardized statewide datasets organized for automated assessment uses in one area to expedite data review for individual stations. The area is divided into multiple tabs, each with subtabs. These hierarchical tabs organize the conventionals data and all associated parameter modules, benthic data, metals data, and toxics data. Future iterations of this application may include more data review areas as the underlying data sources undergo rigorous organizational steps in order to be sourced by the automated applications and scripts.

By clicking any of the above mentioned tabs, users may begin to dig into different types of data for a chosen station.

![](images/riverine8.png)


### Conventionals Data Tab

The "Conventionals" tab provides visualization and analysis modules for each parameter with waterbody-specific criteria or standards. 

The "Raw Data" subtab presents all the conventionals data filtered to the current cycle. Users may download or copy this information to their clipboard for investigation in other programs. The Data Summary section provides AU and station record counts.

![](images/riverine9.png)

The "Temperature" subtab displays an interactive graph of all temperature data for the chosen station as well as the applicable WQS. Users may change the WQS assigned to the station and reassess on the fly using the "WQS for Analysis" drop down menu. This feature controls all the exceedance and summary statistics in the station area of the modal. Users may review and download raw parameter data by clicking the "Review Raw Parameter Data" button to reveal a modal dialog box with a table and various copy/download options.

A low flow flag appears when the station selected contains data (Temperature, pH, or DO) collected on the same date where a USGS gage in the major river basin (James, York, Potomac, etc.) fell below the gage-specific 7Q10 calculation. Red bold language appears to indicate the chosen station contains data that might have been collected during a low flow event. The data that is flagged for 7Q10 is represented with a red halo behind it in the interactive plot. Users may find out more information about the proximity of this flagged gage to the station, flow statistics, and USGS NWIS links inside the modal visible by clicking the "Review Low Flow Information" button. The table at the bottom of that modal recalculates the station's exceedance statistics based on the assumption that the data flagged with the 7Q10 flag should not be used for assessment. It is up to the assessor to determine whether or not this data should be assessed or not due to flow on the day the sample was collected. 

![](images/riverine10.png)

The "pH" subtab displays an interactive graph of all pH data for the chosen station as well as the applicable WQS. Users may change the WQS assigned to the station and reassess on the fly using the "WQS for Analysis" drop down menu. This feature controls all the exceedance and summary statistics in the station area of the modal. Users may review and download raw parameter data by clicking the "Review Raw Parameter Data" button to reveal a modal dialog box with a table and various copy/download options.

The "Display Benthic Stressor Analysis Colors on Plot" checkbox allows users to visualize thresholds of potential stress to aquatic organisms for increased data context.

A low flow flag appears when the station selected contains data (Temperature, pH, or DO) collected on the same date where a USGS gage in the major river basin (James, York, Potomac, etc.) fell below the gage-specific 7Q10 calculation. Red bold language appears to indicate the chosen station contains data that might have been collected during a low flow event. The data that is flagged for 7Q10 is represented with a red halo behind it in the interactive plot. Users may find out more information about the proximity of this flagged gage to the station, flow statistics, and USGS NWIS links inside the modal visible by clicking the "Review Low Flow Information" button. The table at the bottom of that modal recalculates the station's exceedance statistics based on the assumption that the data flagged with the 7Q10 flag should not be used for assessment. It is up to the assessor to determine whether or not this data should be assessed or not due to flow on the day the sample was collected. 

![](images/riverine11.png)





The "DO" subtab displays an interactive graph of all dissolved oxygen data for the chosen station as well as the applicable WQS. Users may change the WQS assigned to the station and reassess on the fly using the "WQS for Analysis" drop down menu. This feature controls all the exceedance and summary statistics in the station area of the modal. Users may review and download raw parameter data by clicking the "Review Raw Parameter Data" button to reveal a modal dialog box with a table and various copy/download options. Daily average DO exceedances and summary statistics are visible below the raw data analysis.

The "Display Benthic Stressor Analysis Colors on Plot" checkbox allows users to visualize thresholds of potential stress to aquatic organisms for increased data context.

A low flow flag appears when the station selected contains data (Temperature, pH, or DO) collected on the same date where a USGS gage in the major river basin (James, York, Potomac, etc.) fell below the gage-specific 7Q10 calculation. Red bold language appears to indicate the chosen station contains data that might have been collected during a low flow event. The data that is flagged for 7Q10 is represented with a red halo behind it in the interactive plot. Users may find out more information about the proximity of this flagged gage to the station, flow statistics, and USGS NWIS links inside the modal visible by clicking the "Review Low Flow Information" button. The table at the bottom of that modal recalculates the station's exceedance statistics based on the assumption that the data flagged with the 7Q10 flag should not be used for assessment. It is up to the assessor to determine whether or not this data should be assessed or not due to flow on the day the sample was collected. 

![](images/riverine12.png)


The "Specific Conductance" subtab displays an interactive graph of all specific conductivity data for the chosen station. Users may review and download raw parameter data by clicking the "Review Raw Parameter Data" button to reveal a modal dialog box with a table and various copy/download options.

The "Display Benthic Stressor Analysis Colors on Plot" checkbox allows users to visualize thresholds of potential stress to aquatic organisms for increased data context.


![](images/riverine13.png)

The "Salinity" subtab displays an interactive graph of all salinity data for the chosen station. Users may review and download raw parameter data by clicking the "Review Raw Parameter Data" button to reveal a modal dialog box with a table and various copy/download options.


![](images/riverine14.png)


The "Total Nitrogen" subtab displays an interactive graph of all TN data for the chosen station. Users may review and download raw parameter data by clicking the "Review Raw Parameter Data" button to reveal a modal dialog box with a table and various copy/download options.

The "Display Benthic Stressor Analysis Colors on Plot" checkbox allows users to visualize thresholds of potential stress to aquatic organisms for increased data context.


![](images/riverine15.png)


The "Ammonia" subtab displays an interactive graph of all ammonia data for the chosen station as well as the applicable WQS. The Freshwater Criteria Default Analysis Settings
section identifies the criteria settings applied to the station based on the WQS Class attributed to the station. All analyses presented reflect these conditions. The default WQS settings are specified to expedite application rendering time. If the default analysis settings do not meet your needs, please contact Emma Jones (emma.jones@deq.virginia.gov). Users may review and download raw parameter data by clicking the "Review Raw Parameter Data" button to reveal a modal dialog box with a table and various copy/download options.

The Combined Ammonia Criteria Analysis Results section allows users to explore this complicated ammonia standard interactively. All ammonia records that are above the acute, chronic, or four day criteria for the selected site are highlighted below.

![](images/riverine16.png)






The "Total Phosphorus" subtab displays an interactive graph of all TP data for the chosen station. Users may review and download raw parameter data by clicking the "Review Raw Parameter Data" button to reveal a modal dialog box with a table and various copy/download options.

The "Display Benthic Stressor Analysis Colors on Plot" checkbox allows users to visualize thresholds of potential stress to aquatic organisms for increased data context.


![](images/riverine17.png)








