# Lacustrine Application How To

```{r lacustrine setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


The [Lakes Assessment App](https://rconnect.deq.virginia.gov/IR2024lakesAssessmentApp/) is located on the R server. **The linked version of the application is in draft development stage with DRAFT DATA until after the data solicitation deadline and final product release. Expect this release in late April 2023.**

The purpose of this tool is to expand upon the Station Table summary provided by the automated assessment methodology. A single parameter summary (or in the case of metals, toxics, etc. a single summary of multiple parameters) does not do justice to the data analyzed by the automated assessment process. The Lakes Assessment App provides an interactive data analysis experience to improve users' understanding of automated assessment analyses and decisions. The intended audience is any DEQ employee from regional assessors, field staff to managers, providing better data understanding through interactive data visualizations, descriptive standardized application and WQA guidance explanations, and statewide applicability. 

A notable benefit of these standardized tools is the increased accessibility of assessment decisions. No longer are assessment tools limited to regional assessment staff, resulting in bottlenecks when assessment questions arise. These self-service tools articulate assessment procedures to guide data and decision discussions across multiple end users as needed for timely decisions. 

This tool is a companion to the Station Table throughout the decision-making process. Upon beginning the assessment review period, regional assessment staff download a copy of the statewide Station Table (available inside either the Riverine or Lakes App). This copy is manipulated locally by regional assessment staff as decisions are reviewed (using these interactive applications) and entered into WQA CEDS. The next sections will detail typical workflow procedures to using this tool for data exploration and/or assessment. 

## Application Orientation

This application brings station-level automated analyses- provided in the Station Table- to life through interactive data visualizations, maps, and tables. The tool is divided into three tabs that must be visited sequentially for proper application functionality. The `Data Upload` tab provides a basic overview of application data sources, provides download of the statewide Station Table resultant from previous automated assessment procedures, and requires upload of either the default Station Table or a custom Station Table (e.g. the Station Table filtered to a specific region). The `Lake Selection` tab allows further investigation of particular lakes by assessment region. This tab offers high level summaries of stations within a chosen lake. The `Assessment Unit Review` tab dives into all assessment units and stations contained within a selected lake. By drilling down from lake to assessment unit to station, users may explore assessment data against applicable Water Quality Standards and criteria to better understand how assessment guidance leads assessment staff to appropriate decisions across designated uses. Previous assessment decisions are provided along with all centrally stored assessment data to provide a full picture of stations that require addressing during a given assessment cycle.

## Application Use: Data Upload Tab


The `Data Upload` tab is the first screen to appear on application load. The purpose of this screen is to orient users to basic application usage and data sources and to provide a location to upload the Station Table. The Station Table is key to running any subsequent parts of this application. Users may download the latest copy of the statewide Station Table using the `Download statewide example dataset to upload to the tool.` button at the bottom of the screen. Helptext below the download button indicates the last time the Station Table template was updated. 

The Station Table must be uploaded to the application each time the tool is used. The reason the tool requires an upload of the Station Table each use is to allow flexibility for regional assessment staff to change station assessment unit (AU) designations throughout the assessment process. If this dataset were sourced from the R server like all other datasets used by the Lakes App, then assessors would need to notify the Assessment Data Analyst each time a station AU changes, is split, or requires additional AUs. By allowing the regional assessment staff to edit this information in a .csv, the application allows self-service changes to station organization.

Users may upload the entire statewide Station Table to the `Browse` button in the tool or a version filtered and saved locally with just the region of interest. 

![](images/lakes1.png)

## Application Use: Lake Selection Tab

The `Lake Selection` tab allows users to choose a particular region to investigate further. Using the drop down menu in the sidebar panel, users must choose one assessment region and then click `Retrieve Assessment Units From Server` in order to proceed with any analyses. Based on the assessment region selected, the application then extracts the appropriate spatial data from standardized datasets saved on the R server and provides that information to the application. A progress message is visible in the lower right of the screen while this data transaction occurs.

Once this data is available to the application, the user may further refine data by using a dynamic filtering drop down on the sidebar panel. Users may select from only the lakes within the selected assessment region. An interactive map dynamically updates to display the user selection on the main panel of the application. Additional information about the each AU and station within the lake may be found in the popup table revealed upon clicking on a each item in the interactive map. Users may zoom in/out, change baselayers or data layers plotted, and hover/click on map items using the interactive leaflet map in the main panel of the application.

![](images/lakes2.png)


The main panel of the `Lake Selection` tab details information about the selected lake. The interactive map describes spatially where the lake falls within the state. Subsequent tables detail the AUs and stations within the VAHU6. The "Assessment Units in Selected Lake" table lists all AUs that fall inside the selected lake, retrieved from the previous Assessment cycle spatial layer. The "Stations in Selected Lake that were sampled in current window" table identifies all stations that fall within the lake with data in the current Assessment cycle. Stations in this table that lack most of the metadata are likely sampled only by programs that do not enter data into CEDS (e.g. PCB or Fish Tissue data). This can be confirmed in the Data_Source field where a "Data from outside conventionals query" flag will be noted. These stations can still be analyzed using the application, but they will lack data in the typical field and analyte analysis modules.

The last table identifies stations in selected lake that have no data in the current window but were carried over from last cycle due to an IM designation in one of the previous IR status fields or the previous IR Station Table reports the station was carried over from a more previous cycle. The purpose of this table is to identify which stations in the selected lake are carried over from a previous cycle and require review before carrying forward another cycle. These stations can be viewed in the application and Station Table, but none of the parameter modules will display data as no data is available in the current window.

**To view a station in the Lakes App, each station must have at least one ID305B field with a valid lake AU and WATER_TYPE must equal to RESERVOIR. Riverine and estuarine stations can reside in the uploaded Station Table, but only stations that comply with the logic set out above will be able to be analyzed in the Lakes App."


## Application Use: Assessment Unit Review Tab

After selecting a lake to investigate on the `Lake Selection` tab, the `Assessment Unit Review` tab is where the user will find the most interactive analytical tools. The tab provides a drill-down view of all assessment data related to the selected lake. Users explore the chosen lake using a hierarchical schema from lake -> AUs within the lake -> Stations within the AU. 
The table at the top of the tab reminds the user which lake is currently selected for investigation, the VAHU6(s) the lake falls in, and whether or not the lake is attributed to a WQS segment tagged as a Section 187 lake. The "Assessment Unit Selection" drop down allows users to choose from all AUs within the chosen lake. These AUs are retrieved from the final AU spatial layer from the previous cycle. The table immediately below this drop down provides AU information for the chosen AU from the previous cycle as a summary of use attainment and AU comments in the most previous cycle. If, during the assessment process, an AU is split or renamed to a name not contained within the previous cycle final AU spatial layer and the Station Table uploaded to the application contains this new/changed AU, the previous final AU spatial layer will not contain information about this AU. However, the application will still allow the user to perform all expected analyses without this information. 

Based on the AU selected, all stations attributed to the AU are available in the subsequent "Station Selection" drop down. The stations available in the drop down are limited to stations with an ID305B_1:ID305B_10 designation equal to the selected AU as provided in the uploaded Station Table. Once a station is selected, all further visualizations and analyses pertain to that station. In the subsequent panel, current and previous information about the selected station are provided. On the left, a table provides station and WQS information, organizing AU and station type designations (pulled from the uploaded Station Table) and WQS information (pulled from pinned data on the R server, originally provided by the regional assessor during the previous metadata steps). A thumbnail map identifies the station and all associated AUs. The table on the right provides Station Table results from the two most previous assessment cycles to collate relevant historical information about the station in one area. 

![](images/lakes3.png)

Information specific to the current assessment cycle is presented below the general station information panel. The "Station Table Results" table outputs the site specific results for direct export to the Station Table. It also serves to highlight where exceedances are present and should be reviewed in the individual parameter visualization tabs below. If no station table appears, then there is no data within the assessment window for the selected station. Please investigate the Historical Station Information table above for information as to why this station is included in the application. In the "Station Table Results" table, parameters are highlighted in different colors to indicate further review may be necessary. Parameters highlighted in yellow have at least one violation of a standard or criteria. When BENTHIC_STAT is highlighted, it indicates there is benthic data available for that site and the assessor should review that information with information presented in the `Benthic` tab below and their Regional Biologist. Parameters highlighted in red exceed the 10.5% exceedance rate. Both scenarios warrant further investigation and may require comments in the Station Table and CEDS WQA.

**Pro Tip: The "Station Table Results" table is editable by the user. This is helpful when the user wants to minimize the number of applications running throughout a given assessment session. Should the assessor determine that an automated result presented in the table requires changing, they may triple-click (click three times in rapid succession) on the cell that needs the change to reveal a text entry box. The user may edit that cell to whatever they desire, preferably following the rules outlined in the Data Entry Manual. Regardless whether any cells were manipulated, the user may use the Copy/CSV/Excel buttons above the table to copy the table information to their clipboard or download the information as the chose file format.**


The "Assessment Unit Raw Data Review and Visualization" area organizes all the standardized statewide datasets organized for automated assessment uses in one area to expedite data review for individual stations. The area is divided into multiple tabs, each with subtabs. These hierarchical tabs organize the conventionals data and all associated parameter modules, benthic data, metals data, and toxics data. Future iterations of this application may include more data review areas as the underlying data sources undergo rigorous organizational steps in order to be sourced by the automated applications and scripts.

By clicking any of the above mentioned tabs, users may begin to dig into different types of data for a chosen station.

![](images/riverine8.png)


### Conventionals Data Tab
