<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.4 Automated Assessment Analysis | DEQ Water Quality Automated Assessment User Guide</title>
  <meta name="description" content="A companion document describing the WQA automated assessment methodology." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3.4 Automated Assessment Analysis | DEQ Water Quality Automated Assessment User Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A companion document describing the WQA automated assessment methodology." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.4 Automated Assessment Analysis | DEQ Water Quality Automated Assessment User Guide" />
  
  <meta name="twitter:description" content="A companion document describing the WQA automated assessment methodology." />
  

<meta name="author" content="DEQ Automated Assessment Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="automated-assessment.html"/>
<link rel="next" href="individual-parameter-analyses.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="assets/book.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DEQ Water Quality Automated Assessment User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="HowToUseDocument.html"><a href="HowToUseDocument.html"><i class="fa fa-check"></i><b>1.1</b> How to Use Document</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="HowToUseDocument.html"><a href="HowToUseDocument.html#ProgrammingExpectations"><i class="fa fa-check"></i><b>1.1.1</b> Programming Expectations</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ProjectHistory.html"><a href="ProjectHistory.html"><i class="fa fa-check"></i><b>1.2</b> Project History</a></li>
<li class="chapter" data-level="1.3" data-path="wqa-technical-support-team.html"><a href="wqa-technical-support-team.html"><i class="fa fa-check"></i><b>1.3</b> WQA Technical Support Team</a></li>
<li class="chapter" data-level="1.4" data-path="Acknowledgements.html"><a href="Acknowledgements.html"><i class="fa fa-check"></i><b>1.4</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-organization.html"><a href="data-organization.html"><i class="fa fa-check"></i><b>2</b> Data Organization</a>
<ul>
<li class="chapter" data-level="2.1" data-path="conventionals-data.html"><a href="conventionals-data.html"><i class="fa fa-check"></i><b>2.1</b> Conventionals Data</a></li>
<li class="chapter" data-level="2.2" data-path="water-column-metals.html"><a href="water-column-metals.html"><i class="fa fa-check"></i><b>2.2</b> Water Column Metals</a></li>
<li class="chapter" data-level="2.3" data-path="sediment-metals.html"><a href="sediment-metals.html"><i class="fa fa-check"></i><b>2.3</b> Sediment Metals</a></li>
<li class="chapter" data-level="2.4" data-path="fish-tissue-data.html"><a href="fish-tissue-data.html"><i class="fa fa-check"></i><b>2.4</b> Fish Tissue Data</a></li>
<li class="chapter" data-level="2.5" data-path="pcb-data.html"><a href="pcb-data.html"><i class="fa fa-check"></i><b>2.5</b> PCB Data</a></li>
<li class="chapter" data-level="2.6" data-path="vdh-data.html"><a href="vdh-data.html"><i class="fa fa-check"></i><b>2.6</b> VDH Data</a></li>
<li class="chapter" data-level="2.7" data-path="citizen-monitoring-data.html"><a href="citizen-monitoring-data.html"><i class="fa fa-check"></i><b>2.7</b> Citizen Monitoring Data</a></li>
<li class="chapter" data-level="2.8" data-path="station-metadata.html"><a href="station-metadata.html"><i class="fa fa-check"></i><b>2.8</b> Station Metadata</a></li>
<li class="chapter" data-level="2.9" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html"><i class="fa fa-check"></i><b>2.9</b> Low Flow (7Q10) Data</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#q10-method"><i class="fa fa-check"></i><b>2.9.1</b> 7Q10 Method</a></li>
<li class="chapter" data-level="2.9.2" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#usgs-site-data-gathering"><i class="fa fa-check"></i><b>2.9.2</b> USGS Site Data Gathering</a></li>
<li class="chapter" data-level="2.9.3" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#important-7q10-calculation-notes"><i class="fa fa-check"></i><b>2.9.3</b> Important 7Q10 Calculation Notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="automated-assessment-methods.html"><a href="automated-assessment-methods.html"><i class="fa fa-check"></i><b>3</b> Automated Assessment Methods</a>
<ul>
<li class="chapter" data-level="3.1" data-path="metadata-attribution.html"><a href="metadata-attribution.html"><i class="fa fa-check"></i><b>3.1</b> Metadata Attribution</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="metadata-attribution.html"><a href="metadata-attribution.html#distinct-sites"><i class="fa fa-check"></i><b>3.1.1</b> Distinct Sites</a></li>
<li class="chapter" data-level="3.1.2" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-assessment-region-and-subbasin-information"><i class="fa fa-check"></i><b>3.1.2</b> Join Assessment Region and Subbasin Information</a></li>
<li class="chapter" data-level="3.1.3" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-stations-to-wqs"><i class="fa fa-check"></i><b>3.1.3</b> Join Stations to WQS</a></li>
<li class="chapter" data-level="3.1.4" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-stations-to-aus"><i class="fa fa-check"></i><b>3.1.4</b> Join Stations to AUs</a></li>
<li class="chapter" data-level="3.1.5" data-path="metadata-attribution.html"><a href="metadata-attribution.html#where-does-this-information-go"><i class="fa fa-check"></i><b>3.1.5</b> Where does this information go?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="organize-metadata.html"><a href="organize-metadata.html"><i class="fa fa-check"></i><b>3.2</b> Organize Metadata</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="organize-metadata.html"><a href="organize-metadata.html#reorganize-conventionals-dataset"><i class="fa fa-check"></i><b>3.2.1</b> Reorganize Conventionals Dataset</a></li>
<li class="chapter" data-level="3.2.2" data-path="organize-metadata.html"><a href="organize-metadata.html#adding-secchi-depth-to-conventionals-dataset"><i class="fa fa-check"></i><b>3.2.2</b> Adding Secchi Depth to conventionals dataset</a></li>
<li class="chapter" data-level="3.2.3" data-path="organize-metadata.html"><a href="organize-metadata.html#add-citizen-monitoring-data-to-conventionals"><i class="fa fa-check"></i><b>3.2.3</b> Add Citizen Monitoring Data to conventionals</a></li>
<li class="chapter" data-level="3.2.4" data-path="organize-metadata.html"><a href="organize-metadata.html#ensure-all-stations-have-necessary-wqs-and-au-information"><i class="fa fa-check"></i><b>3.2.4</b> Ensure all stations have necessary WQS and AU information</a></li>
<li class="chapter" data-level="3.2.5" data-path="organize-metadata.html"><a href="organize-metadata.html#clean-up-pcb-dataset"><i class="fa fa-check"></i><b>3.2.5</b> Clean up PCB dataset</a></li>
<li class="chapter" data-level="3.2.6" data-path="organize-metadata.html"><a href="organize-metadata.html#clean-up-fish-tissue-dataset"><i class="fa fa-check"></i><b>3.2.6</b> Clean up Fish Tissue dataset</a></li>
<li class="chapter" data-level="3.2.7" data-path="organize-metadata.html"><a href="organize-metadata.html#pin-official-clean-ir-data-to-r-server"><i class="fa fa-check"></i><b>3.2.7</b> Pin Official Clean IR data to R server</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="automated-assessment.html"><a href="automated-assessment.html"><i class="fa fa-check"></i><b>3.3</b> Automated Assessment</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="automated-assessment.html"><a href="automated-assessment.html#bring-in-required-datasets"><i class="fa fa-check"></i><b>3.3.1</b> Bring in required datasets</a></li>
<li class="chapter" data-level="3.3.2" data-path="automated-assessment.html"><a href="automated-assessment.html#attach-wqs-information"><i class="fa fa-check"></i><b>3.3.2</b> Attach WQS information</a></li>
<li class="chapter" data-level="3.3.3" data-path="automated-assessment.html"><a href="automated-assessment.html#identify-station-type"><i class="fa fa-check"></i><b>3.3.3</b> Identify Station Type</a></li>
<li class="chapter" data-level="3.3.4" data-path="automated-assessment.html"><a href="automated-assessment.html#bring-in-low-flow-information"><i class="fa fa-check"></i><b>3.3.4</b> Bring in Low Flow Information</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="automated-assessment-analysis.html"><a href="automated-assessment-analysis.html"><i class="fa fa-check"></i><b>3.4</b> Automated Assessment Analysis</a></li>
<li class="chapter" data-level="3.5" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html"><i class="fa fa-check"></i><b>3.5</b> Individual Parameter Analyses</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#how-to-test-individual-parameter-functions"><i class="fa fa-check"></i><b>3.5.1</b> How to Test Individual Parameter Functions</a></li>
<li class="chapter" data-level="3.5.2" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#temperature"><i class="fa fa-check"></i><b>3.5.2</b> Temperature</a></li>
<li class="chapter" data-level="3.5.3" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#dissolved-oxygen"><i class="fa fa-check"></i><b>3.5.3</b> Dissolved Oxygen</a></li>
<li class="chapter" data-level="3.5.4" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#ph"><i class="fa fa-check"></i><b>3.5.4</b> pH</a></li>
<li class="chapter" data-level="3.5.5" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#bacteria"><i class="fa fa-check"></i><b>3.5.5</b> Bacteria</a></li>
<li class="chapter" data-level="3.5.6" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#nutrients"><i class="fa fa-check"></i><b>3.5.6</b> Nutrients</a></li>
<li class="chapter" data-level="3.5.7" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#ammonia"><i class="fa fa-check"></i><b>3.5.7</b> Ammonia</a></li>
<li class="chapter" data-level="3.5.8" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#water-column-toxics"><i class="fa fa-check"></i><b>3.5.8</b> Water Column Toxics</a></li>
<li class="chapter" data-level="3.5.9" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#public-water-supply-criteria"><i class="fa fa-check"></i><b>3.5.9</b> Public Water Supply Criteria</a></li>
<li class="chapter" data-level="3.5.10" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#freshwater-chloride"><i class="fa fa-check"></i><b>3.5.10</b> Freshwater Chloride</a></li>
<li class="chapter" data-level="3.5.11" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#pcb"><i class="fa fa-check"></i><b>3.5.11</b> PCB</a></li>
<li class="chapter" data-level="3.5.12" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#metals"><i class="fa fa-check"></i><b>3.5.12</b> Metals</a></li>
<li class="chapter" data-level="3.5.13" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#fish-tissue"><i class="fa fa-check"></i><b>3.5.13</b> Fish Tissue</a></li>
<li class="chapter" data-level="3.5.14" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#benthics"><i class="fa fa-check"></i><b>3.5.14</b> Benthics</a></li>
<li class="chapter" data-level="3.5.15" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#additional-functions"><i class="fa fa-check"></i><b>3.5.15</b> Additional Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="automated-output.html"><a href="automated-output.html"><i class="fa fa-check"></i><b>3.6</b> Automated Output</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regional-metadata-validation-tool-how-to.html"><a href="regional-metadata-validation-tool-how-to.html"><i class="fa fa-check"></i><b>4</b> Regional Metadata Validation <br>Tool How To</a>
<ul>
<li class="chapter" data-level="4.1" data-path="application-orientation.html"><a href="application-orientation.html"><i class="fa fa-check"></i><b>4.1</b> Application Orientation</a></li>
<li class="chapter" data-level="4.2" data-path="application-use-water-quality-standards-qa-watershed-selection-tab.html"><a href="application-use-water-quality-standards-qa-watershed-selection-tab.html"><i class="fa fa-check"></i><b>4.2</b> Application Use: <br>Water Quality Standards QA- <br>Watershed Selection Tab</a></li>
<li class="chapter" data-level="4.3" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html"><i class="fa fa-check"></i><b>4.3</b> Application Use: <br>Water Quality Standards QA- <br>Manual Review Tab</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#map-orientation"><i class="fa fa-check"></i><b>4.3.1</b> Map Orientation</a></li>
<li class="chapter" data-level="4.3.2" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#what-do-the-buttons-do"><i class="fa fa-check"></i><b>4.3.2</b> What do the buttons do?</a></li>
<li class="chapter" data-level="4.3.3" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation"><i class="fa fa-check"></i><b>4.3.3</b> Application Operation</a></li>
<li class="chapter" data-level="4.3.4" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-1-wqs-segment"><i class="fa fa-check"></i><b>4.3.4</b> Application Operation: <br>Station that Snapped to 1 WQS Segment</a></li>
<li class="chapter" data-level="4.3.5" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-1-wqs-segment-1"><i class="fa fa-check"></i><b>4.3.5</b> Application Operation: <br>Station that Snapped to &gt;1 WQS Segment</a></li>
<li class="chapter" data-level="4.3.6" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-0-wqs-segments"><i class="fa fa-check"></i><b>4.3.6</b> Application Operation: <br>Station that Snapped to 0 WQS Segments</a></li>
<li class="chapter" data-level="4.3.7" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-there-are-no-more-stations-to-attribute"><i class="fa fa-check"></i><b>4.3.7</b> Application Operation: <br>There are no more stations to attribute</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="having-problems.html"><a href="having-problems.html"><i class="fa fa-check"></i><b>4.4</b> Having problems?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="riverine-application-how-to.html"><a href="riverine-application-how-to.html"><i class="fa fa-check"></i><b>5</b> Riverine Application How To</a></li>
<li class="chapter" data-level="6" data-path="lacustrine-application-how-to.html"><a href="lacustrine-application-how-to.html"><i class="fa fa-check"></i><b>6</b> Lacustrine Application How To</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DEQ Water Quality Automated Assessment User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="automated-assessment-analysis" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Automated Assessment Analysis</h2>
<p>Finally, we are ready to analyze some data! Go through stationTable one station at a time, join conventionals, analyze all available data by each parameter function (or nested functions), and report out results in the WQA CEDS bulk upload template format. The next chunk is long. We start by setting up placeholder objects to store the data we want to save for later (<code>stationTableResults</code> and <code>ammoniaAnalysis</code>). The ammonia calculation takes a bit of time, so we save all the data, analysis, and results in <code>ammoniaAnalysis</code> so we can easily source this information for faster application rendering.</p>
<p>The loop runs through each station, correcting special standards information and running any thermocline analyses, as necessary. This <code>stationData</code> object is fed into all subsequent automated assessment functions that calculate results for individual parameters and output information into the appropriate output format. Certain parameter functions take longer to compute than others, or are sourced multiple times in this chunk, so they are run first, e.g. ammonia, Public Water Supply (PWS) criteria, nutrients, dissolved oxygen daily average criteria, etc. The <code>results</code> object is then constructed parameter by parameter into the Stations Table template format. This dataset is then appended to the overall output dataset, <code>stationTableResults</code>, before moving on to the next station. Should a station in the <code>stationTable</code> object not have any data in <code>conventionals</code>, the appropriate metadata in the Stations Table template format is still sent to the <code>stationTable</code> output object with any previous cycle comments, potentially indicating that the station doesn’t have new data.</p>
<p>Please see the <a href="individual-parameter-analyses.html#individual-parameter-analyses">Individual Parameter Analyses</a> section for detailed descriptions of what each individual parameter functions are doing during the below analysis.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="automated-assessment-analysis.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make placeholder objects to store data results</span></span>
<span id="cb77-2"><a href="automated-assessment-analysis.html#cb77-2" aria-hidden="true" tabindex="-1"></a>stationTableResults <span class="ot">&lt;-</span> stationsTemplate </span>
<span id="cb77-3"><a href="automated-assessment-analysis.html#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># save ammonia results (based on default assessment information) for use in app to speed rendering</span></span>
<span id="cb77-4"><a href="automated-assessment-analysis.html#cb77-4" aria-hidden="true" tabindex="-1"></a>ammoniaAnalysis <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb77-5"><a href="automated-assessment-analysis.html#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="automated-assessment-analysis.html#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="automated-assessment-analysis.html#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># time the operation so we can know how long it takes:</span></span>
<span id="cb77-8"><a href="automated-assessment-analysis.html#cb77-8" aria-hidden="true" tabindex="-1"></a>startTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb77-9"><a href="automated-assessment-analysis.html#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="automated-assessment-analysis.html#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over all sites, not super efficient but get the job done in easy to follow format</span></span>
<span id="cb77-11"><a href="automated-assessment-analysis.html#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stationTable)){</span>
<span id="cb77-12"><a href="automated-assessment-analysis.html#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="automated-assessment-analysis.html#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;Assessing station&#39;</span>, i, <span class="st">&#39;of&#39;</span>, <span class="fu">nrow</span>(stationTable), <span class="at">sep=</span><span class="st">&#39; &#39;</span>)) <span class="co"># print progress information</span></span>
<span id="cb77-14"><a href="automated-assessment-analysis.html#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="automated-assessment-analysis.html#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull one station data</span></span>
<span id="cb77-16"><a href="automated-assessment-analysis.html#cb77-16" aria-hidden="true" tabindex="-1"></a>  stationData <span class="ot">&lt;-</span> <span class="fu">filter</span>(conventionals, FDT_STA_ID <span class="sc">%in%</span> stationTable<span class="sc">$</span>STATION_ID[i]) <span class="sc">%&gt;%</span></span>
<span id="cb77-17"><a href="automated-assessment-analysis.html#cb77-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(stationTable, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;FDT_STA_ID&#39;</span> <span class="ot">=</span> <span class="st">&#39;STATION_ID&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-18"><a href="automated-assessment-analysis.html#cb77-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Special Standards Correction step. This is done on the actual data bc some special standards have temporal components</span></span>
<span id="cb77-19"><a href="automated-assessment-analysis.html#cb77-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pHSpecialStandardsCorrection</span>() <span class="sc">%&gt;%</span> <span class="co"># correct pH to special standards where necessary</span></span>
<span id="cb77-20"><a href="automated-assessment-analysis.html#cb77-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">temperatureSpecialStandardsCorrection</span>() <span class="sc">%&gt;%</span> <span class="co"># correct temperature special standards where necessary</span></span>
<span id="cb77-21"><a href="automated-assessment-analysis.html#cb77-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># special lake steps</span></span>
<span id="cb77-22"><a href="automated-assessment-analysis.html#cb77-22" aria-hidden="true" tabindex="-1"></a>    {<span class="cf">if</span>(stationTable<span class="sc">$</span>STATION_ID[i] <span class="sc">%in%</span> lakeStations<span class="sc">$</span>STATION_ID)</span>
<span id="cb77-23"><a href="automated-assessment-analysis.html#cb77-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>(</span>
<span id="cb77-24"><a href="automated-assessment-analysis.html#cb77-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(., <span class="at">lakeStation =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-25"><a href="automated-assessment-analysis.html#cb77-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">thermoclineDepth</span>())) <span class="co"># adds thermocline information and SampleDate</span></span>
<span id="cb77-26"><a href="automated-assessment-analysis.html#cb77-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="fu">mutate</span>(., <span class="at">lakeStation =</span> <span class="cn">FALSE</span>) }</span>
<span id="cb77-27"><a href="automated-assessment-analysis.html#cb77-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-28"><a href="automated-assessment-analysis.html#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb77-29"><a href="automated-assessment-analysis.html#cb77-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add some extra columns that are helpful for assessors but don&#39;t fit the bulk upload template</span></span>
<span id="cb77-30"><a href="automated-assessment-analysis.html#cb77-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-31"><a href="automated-assessment-analysis.html#cb77-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Previous station table comments</span></span>
<span id="cb77-32"><a href="automated-assessment-analysis.html#cb77-32" aria-hidden="true" tabindex="-1"></a>  comments <span class="ot">&lt;-</span> <span class="fu">stationTableComments</span>(stationTable<span class="sc">$</span>STATION_ID[i], stationsTable2022, <span class="st">&#39;2022&#39;</span>, stationsTable2020, <span class="st">&#39;2020&#39;</span>)</span>
<span id="cb77-33"><a href="automated-assessment-analysis.html#cb77-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-34"><a href="automated-assessment-analysis.html#cb77-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Date last sampled</span></span>
<span id="cb77-35"><a href="automated-assessment-analysis.html#cb77-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(stationData) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb77-36"><a href="automated-assessment-analysis.html#cb77-36" aria-hidden="true" tabindex="-1"></a>    dateLastSampled <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">max</span>(stationData<span class="sc">$</span>FDT_DATE_TIME)) } <span class="cf">else</span> {dateLastSampled <span class="ot">&lt;-</span> <span class="st">&#39;No data in conventionals data pull&#39;</span>}</span>
<span id="cb77-37"><a href="automated-assessment-analysis.html#cb77-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-38"><a href="automated-assessment-analysis.html#cb77-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Low Flow Summary, only gives flag if station has FDT_TEMP_CELCIUS, DO_mg_L, FDT_FIELD_PH collected on day with gage in subbasin </span></span>
<span id="cb77-39"><a href="automated-assessment-analysis.html#cb77-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># below 7Q10</span></span>
<span id="cb77-40"><a href="automated-assessment-analysis.html#cb77-40" aria-hidden="true" tabindex="-1"></a>  lowFlowSummary <span class="ot">&lt;-</span> <span class="fu">lowFlowFlagColumn</span>(stationData)</span>
<span id="cb77-41"><a href="automated-assessment-analysis.html#cb77-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-42"><a href="automated-assessment-analysis.html#cb77-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#---------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb77-43"><a href="automated-assessment-analysis.html#cb77-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-44"><a href="automated-assessment-analysis.html#cb77-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ammonia special section</span></span>
<span id="cb77-45"><a href="automated-assessment-analysis.html#cb77-45" aria-hidden="true" tabindex="-1"></a>  ammoniaAnalysisStation <span class="ot">&lt;-</span> <span class="fu">freshwaterNH3limit</span>(stationData, <span class="at">trout =</span> <span class="fu">ifelse</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>CLASS) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;V&#39;</span>,<span class="st">&#39;VI&#39;</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb77-46"><a href="automated-assessment-analysis.html#cb77-46" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">mussels =</span> <span class="cn">TRUE</span>, <span class="at">earlyLife =</span> <span class="cn">TRUE</span>) </span>
<span id="cb77-47"><a href="automated-assessment-analysis.html#cb77-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section155/ states the assumption is that</span></span>
<span id="cb77-48"><a href="automated-assessment-analysis.html#cb77-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  waters are to be assessed with the assumption that mussels and early life stages of fish should be present</span></span>
<span id="cb77-49"><a href="automated-assessment-analysis.html#cb77-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># trout presence is determined by WQS class, this can be changed in the app but is forced to be what the station</span></span>
<span id="cb77-50"><a href="automated-assessment-analysis.html#cb77-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is attributed to in the automated assessment scripts</span></span>
<span id="cb77-51"><a href="automated-assessment-analysis.html#cb77-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-52"><a href="automated-assessment-analysis.html#cb77-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PWS Criteria</span></span>
<span id="cb77-53"><a href="automated-assessment-analysis.html#cb77-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(stationData) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb77-54"><a href="automated-assessment-analysis.html#cb77-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>PWS))  ){</span>
<span id="cb77-55"><a href="automated-assessment-analysis.html#cb77-55" aria-hidden="true" tabindex="-1"></a>      PWSconcat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">PWS=</span> <span class="cn">NA</span>)</span>
<span id="cb77-56"><a href="automated-assessment-analysis.html#cb77-56" aria-hidden="true" tabindex="-1"></a>   } <span class="cf">else</span> {</span>
<span id="cb77-57"><a href="automated-assessment-analysis.html#cb77-57" aria-hidden="true" tabindex="-1"></a>     PWSconcat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="co">#tibble(STATION_ID = unique(stationData$FDT_STA_ID)),</span></span>
<span id="cb77-58"><a href="automated-assessment-analysis.html#cb77-58" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">assessPWS</span>(stationData, NITRATE_mg_L, LEVEL_NITRATE, <span class="dv">10</span>, <span class="st">&#39;PWS_Nitrate&#39;</span>),</span>
<span id="cb77-59"><a href="automated-assessment-analysis.html#cb77-59" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">assessPWS</span>(stationData, CHLORIDE_mg_L, LEVEL_CHLORIDE, <span class="dv">250</span>, <span class="st">&#39;PWS_Chloride&#39;</span>),</span>
<span id="cb77-60"><a href="automated-assessment-analysis.html#cb77-60" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">assessPWS</span>(stationData, SULFATE_TOTAL_mg_L, LEVEL_SULFATE_TOTAL, <span class="dv">250</span>, <span class="st">&#39;PWS_Total_Sulfate&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-61"><a href="automated-assessment-analysis.html#cb77-61" aria-hidden="true" tabindex="-1"></a>       dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&#39;exceedanceRate&#39;</span>)) }</span>
<span id="cb77-62"><a href="automated-assessment-analysis.html#cb77-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-63"><a href="automated-assessment-analysis.html#cb77-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># chloride assessment if data exists</span></span>
<span id="cb77-64"><a href="automated-assessment-analysis.html#cb77-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(<span class="fu">filter</span>(stationData, <span class="sc">!</span><span class="fu">is.na</span>(CHLORIDE_mg_L))) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb77-65"><a href="automated-assessment-analysis.html#cb77-65" aria-hidden="true" tabindex="-1"></a>      chlorideFreshwater <span class="ot">&lt;-</span> <span class="fu">rollingWindowSummary</span>(</span>
<span id="cb77-66"><a href="automated-assessment-analysis.html#cb77-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annualRollingExceedanceSummary</span>(</span>
<span id="cb77-67"><a href="automated-assessment-analysis.html#cb77-67" aria-hidden="true" tabindex="-1"></a>          <span class="fu">annualRollingExceedanceAnalysis</span>(<span class="fu">chlorideFreshwaterAnalysis</span>(stationData), <span class="at">yearsToRoll =</span> <span class="dv">3</span>, <span class="at">aquaticLifeUse =</span> <span class="cn">TRUE</span>) ), <span class="st">&quot;CHL&quot;</span>)</span>
<span id="cb77-68"><a href="automated-assessment-analysis.html#cb77-68" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {chlorideFreshwater <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">CHL_EXC =</span> <span class="cn">NA</span>, <span class="at">CHL_STAT=</span> <span class="cn">NA</span>)}</span>
<span id="cb77-69"><a href="automated-assessment-analysis.html#cb77-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-70"><a href="automated-assessment-analysis.html#cb77-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Water toxics combination with PWS, Chloride Freshwater, and water column PCB data</span></span>
<span id="cb77-71"><a href="automated-assessment-analysis.html#cb77-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(<span class="fu">bind_cols</span>(PWSconcat,</span>
<span id="cb77-72"><a href="automated-assessment-analysis.html#cb77-72" aria-hidden="true" tabindex="-1"></a>                    chlorideFreshwater,</span>
<span id="cb77-73"><a href="automated-assessment-analysis.html#cb77-73" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">PCBmetalsDataExists</span>(<span class="fu">filter</span>(markPCB, <span class="fu">str_detect</span>(SampleMedia, <span class="st">&#39;Water&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-74"><a href="automated-assessment-analysis.html#cb77-74" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">filter</span>(StationID <span class="sc">%in%</span> stationData<span class="sc">$</span>FDT_STA_ID), <span class="st">&#39;WAT_TOX&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-75"><a href="automated-assessment-analysis.html#cb77-75" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">&#39;_EXC&#39;</span>,<span class="st">&#39;_STAT&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb77-76"><a href="automated-assessment-analysis.html#cb77-76" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>( <span class="fu">everything</span>(),  as.character)) <span class="sc">%&gt;%</span></span>
<span id="cb77-77"><a href="automated-assessment-analysis.html#cb77-77" aria-hidden="true" tabindex="-1"></a>          <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">&#39;_EXC&#39;</span>,<span class="st">&#39;_STAT&#39;</span>)), <span class="at">names_to =</span> <span class="st">&#39;parameter&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;values&#39;</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-78"><a href="automated-assessment-analysis.html#cb77-78" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">str_detect</span>(values, <span class="st">&#39;WQS info missing from analysis&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-79"><a href="automated-assessment-analysis.html#cb77-79" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(<span class="sc">!</span> values <span class="sc">==</span> <span class="st">&quot;S&quot;</span>)) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb77-80"><a href="automated-assessment-analysis.html#cb77-80" aria-hidden="true" tabindex="-1"></a>    WCtoxics <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">WAT_TOX_EXC =</span> <span class="cn">NA</span>, <span class="at">WAT_TOX_STAT =</span> <span class="st">&#39;Review&#39;</span>)</span>
<span id="cb77-81"><a href="automated-assessment-analysis.html#cb77-81" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { WCtoxics <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">WAT_TOX_EXC =</span> <span class="cn">NA</span>, <span class="at">WAT_TOX_STAT =</span> <span class="cn">NA</span>)} </span>
<span id="cb77-82"><a href="automated-assessment-analysis.html#cb77-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-83"><a href="automated-assessment-analysis.html#cb77-83" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb77-84"><a href="automated-assessment-analysis.html#cb77-84" aria-hidden="true" tabindex="-1"></a>    WCtoxics <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">WAT_TOX_EXC =</span> <span class="cn">NA</span>, <span class="at">WAT_TOX_STAT =</span> <span class="cn">NA</span>)</span>
<span id="cb77-85"><a href="automated-assessment-analysis.html#cb77-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-86"><a href="automated-assessment-analysis.html#cb77-86" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb77-87"><a href="automated-assessment-analysis.html#cb77-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If data exists for station, run it, otherwise just output what last cycle said and comment</span></span>
<span id="cb77-88"><a href="automated-assessment-analysis.html#cb77-88" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(stationData) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb77-89"><a href="automated-assessment-analysis.html#cb77-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nutrients based on station type</span></span>
<span id="cb77-90"><a href="automated-assessment-analysis.html#cb77-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nutrient: TP (lakes have real standards; riverine no longer uses 0.2 mg/L as an observed effect for Aquatic life use)</span></span>
<span id="cb77-91"><a href="automated-assessment-analysis.html#cb77-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>lakeStation) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb77-92"><a href="automated-assessment-analysis.html#cb77-92" aria-hidden="true" tabindex="-1"></a>      TP <span class="ot">&lt;-</span> <span class="fu">TP_Assessment</span>(stationData) </span>
<span id="cb77-93"><a href="automated-assessment-analysis.html#cb77-93" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb77-94"><a href="automated-assessment-analysis.html#cb77-94" aria-hidden="true" tabindex="-1"></a>        TP <span class="ot">&lt;-</span> <span class="fu">countNutrients</span>(stationData, PHOSPHORUS_mg_L, LEVEL_PHOSPHORUS, <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">quickStats</span>(<span class="st">&#39;NUT_TP&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-95"><a href="automated-assessment-analysis.html#cb77-95" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">NUT_TP_STAT =</span> <span class="fu">ifelse</span>(NUT_TP_STAT <span class="sc">!=</span> <span class="st">&quot;S&quot;</span>, <span class="st">&quot;Review&quot;</span>, <span class="cn">NA</span>)) } <span class="co"># flag OE but don&#39;t show a real assessment decision</span></span>
<span id="cb77-96"><a href="automated-assessment-analysis.html#cb77-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-97"><a href="automated-assessment-analysis.html#cb77-97" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Nutrients: Chl a (lakes)</span></span>
<span id="cb77-98"><a href="automated-assessment-analysis.html#cb77-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>lakeStation) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb77-99"><a href="automated-assessment-analysis.html#cb77-99" aria-hidden="true" tabindex="-1"></a>      chla <span class="ot">&lt;-</span> <span class="fu">chlA_Assessment</span>(stationData)</span>
<span id="cb77-100"><a href="automated-assessment-analysis.html#cb77-100" aria-hidden="true" tabindex="-1"></a>        <span class="co">#tibble(NUT_CHLA_EXC = NA, NUT_CHLA_SAMP = NA, NUT_CHLA_STAT = NA) # placeholder for now</span></span>
<span id="cb77-101"><a href="automated-assessment-analysis.html#cb77-101" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb77-102"><a href="automated-assessment-analysis.html#cb77-102" aria-hidden="true" tabindex="-1"></a>        chla <span class="ot">&lt;-</span> <span class="fu">countNutrients</span>(stationData, CHLOROPHYLL_A_ug_L, LEVEL_CHLOROPHYLL_A, <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">quickStats</span>(<span class="st">&#39;NUT_CHLA&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-103"><a href="automated-assessment-analysis.html#cb77-103" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">NUT_CHLA_STAT =</span> <span class="cn">NA</span>) } <span class="co"># don&#39;t show a real assessment decision</span></span>
<span id="cb77-104"><a href="automated-assessment-analysis.html#cb77-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-105"><a href="automated-assessment-analysis.html#cb77-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run DO Daily Avg for everyone!</span></span>
<span id="cb77-106"><a href="automated-assessment-analysis.html#cb77-106" aria-hidden="true" tabindex="-1"></a>      DO_Daily_Avg_STAT <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;DO_Daily_Avg_STAT: &#39;</span>, </span>
<span id="cb77-107"><a href="automated-assessment-analysis.html#cb77-107" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">DO_Assessment_DailyAvg</span>(stationData) <span class="sc">%&gt;%</span> </span>
<span id="cb77-108"><a href="automated-assessment-analysis.html#cb77-108" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">quickStats</span>(<span class="st">&#39;DO_Daily_Avg&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-109"><a href="automated-assessment-analysis.html#cb77-109" aria-hidden="true" tabindex="-1"></a>                                         dplyr<span class="sc">::</span><span class="fu">select</span>(DO_Daily_Avg_STAT) <span class="sc">%&gt;%</span> <span class="fu">pull</span>())<span class="co">#}</span></span>
<span id="cb77-110"><a href="automated-assessment-analysis.html#cb77-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-111"><a href="automated-assessment-analysis.html#cb77-111" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb77-112"><a href="automated-assessment-analysis.html#cb77-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">StationTableStartingData</span>(stationData),</span>
<span id="cb77-113"><a href="automated-assessment-analysis.html#cb77-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tempExceedances</span>(stationData) <span class="sc">%&gt;%</span> <span class="fu">quickStats</span>(<span class="st">&#39;TEMP&#39;</span>),</span>
<span id="cb77-114"><a href="automated-assessment-analysis.html#cb77-114" aria-hidden="true" tabindex="-1"></a>      <span class="fu">DOExceedances_Min</span>(stationData) <span class="sc">%&gt;%</span> <span class="fu">quickStats</span>(<span class="st">&#39;DO&#39;</span>), </span>
<span id="cb77-115"><a href="automated-assessment-analysis.html#cb77-115" aria-hidden="true" tabindex="-1"></a>      <span class="co"># this will be removed for lake stations later since it does not apply</span></span>
<span id="cb77-116"><a href="automated-assessment-analysis.html#cb77-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pHExceedances</span>(stationData) <span class="sc">%&gt;%</span> <span class="fu">quickStats</span>(<span class="st">&#39;PH&#39;</span>),</span>
<span id="cb77-117"><a href="automated-assessment-analysis.html#cb77-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bacteriaAssessmentDecisionClass</span>( <span class="co"># NEW for IR2024, bacteria only assessed in two most recent years of assessment period</span></span>
<span id="cb77-118"><a href="automated-assessment-analysis.html#cb77-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(stationData, <span class="fu">between</span>(FDT_DATE_TIME, assessmentPeriod[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">4</span>), assessmentPeriod[<span class="dv">2</span>])),</span>
<span id="cb77-119"><a href="automated-assessment-analysis.html#cb77-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">uniqueStationName =</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>FDT_STA_ID)),</span>
<span id="cb77-120"><a href="automated-assessment-analysis.html#cb77-120" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb77-121"><a href="automated-assessment-analysis.html#cb77-121" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Ammonia </span></span>
<span id="cb77-122"><a href="automated-assessment-analysis.html#cb77-122" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rollingWindowSummary</span>(</span>
<span id="cb77-123"><a href="automated-assessment-analysis.html#cb77-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annualRollingExceedanceSummary</span>(</span>
<span id="cb77-124"><a href="automated-assessment-analysis.html#cb77-124" aria-hidden="true" tabindex="-1"></a>          <span class="fu">annualRollingExceedanceAnalysis</span>(ammoniaAnalysisStation, <span class="at">yearsToRoll =</span> <span class="dv">3</span>, <span class="at">aquaticLifeUse =</span> <span class="cn">FALSE</span>)), </span>
<span id="cb77-125"><a href="automated-assessment-analysis.html#cb77-125" aria-hidden="true" tabindex="-1"></a>        <span class="at">parameterAbbreviation =</span> <span class="st">&quot;AMMONIA&quot;</span>),</span>
<span id="cb77-126"><a href="automated-assessment-analysis.html#cb77-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-127"><a href="automated-assessment-analysis.html#cb77-127" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Flag for whether or not metals data exists</span></span>
<span id="cb77-128"><a href="automated-assessment-analysis.html#cb77-128" aria-hidden="true" tabindex="-1"></a>      <span class="fu">metalsData</span>(<span class="fu">filter</span>(WCmetals, Station_Id <span class="sc">%in%</span> stationData<span class="sc">$</span>FDT_STA_ID), <span class="st">&#39;WAT_MET&#39;</span>),</span>
<span id="cb77-129"><a href="automated-assessment-analysis.html#cb77-129" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb77-130"><a href="automated-assessment-analysis.html#cb77-130" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Mark&#39;s water column PCB results, flagged</span></span>
<span id="cb77-131"><a href="automated-assessment-analysis.html#cb77-131" aria-hidden="true" tabindex="-1"></a>      WCtoxics, <span class="co"># from above, adds in PWS and water column PCB information</span></span>
<span id="cb77-132"><a href="automated-assessment-analysis.html#cb77-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-133"><a href="automated-assessment-analysis.html#cb77-133" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Roger&#39;s sediment metals analysis, transcribed</span></span>
<span id="cb77-134"><a href="automated-assessment-analysis.html#cb77-134" aria-hidden="true" tabindex="-1"></a>      <span class="fu">metalsData</span>(<span class="fu">filter</span>(Smetals, Station_Id <span class="sc">%in%</span> stationData<span class="sc">$</span>FDT_STA_ID), <span class="st">&#39;SED_MET&#39;</span>),</span>
<span id="cb77-135"><a href="automated-assessment-analysis.html#cb77-135" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-136"><a href="automated-assessment-analysis.html#cb77-136" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Mark&#39;s sediment PCB results, flagged</span></span>
<span id="cb77-137"><a href="automated-assessment-analysis.html#cb77-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">PCBmetalsDataExists</span>(<span class="fu">filter</span>(markPCB, <span class="fu">str_detect</span>(SampleMedia, <span class="st">&#39;Sediment&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-138"><a href="automated-assessment-analysis.html#cb77-138" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">filter</span>(StationID <span class="sc">%in%</span> stationData<span class="sc">$</span>FDT_STA_ID), <span class="st">&#39;SED_TOX&#39;</span>),</span>
<span id="cb77-139"><a href="automated-assessment-analysis.html#cb77-139" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-140"><a href="automated-assessment-analysis.html#cb77-140" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Gabe&#39;s fish metals results, flagged</span></span>
<span id="cb77-141"><a href="automated-assessment-analysis.html#cb77-141" aria-hidden="true" tabindex="-1"></a>      <span class="fu">PCBmetalsDataExists</span>(<span class="fu">filter</span>(fishMetals, Station_ID <span class="sc">%in%</span> stationData<span class="sc">$</span>FDT_STA_ID), <span class="st">&#39;FISH_MET&#39;</span>),</span>
<span id="cb77-142"><a href="automated-assessment-analysis.html#cb77-142" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-143"><a href="automated-assessment-analysis.html#cb77-143" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Gabe&#39;s fish PCB results, flagged</span></span>
<span id="cb77-144"><a href="automated-assessment-analysis.html#cb77-144" aria-hidden="true" tabindex="-1"></a>      <span class="fu">PCBmetalsDataExists</span>(<span class="fu">filter</span>(fishPCB, <span class="st">`</span><span class="at">DEQ rivermile</span><span class="st">`</span> <span class="sc">%in%</span>  stationData<span class="sc">$</span>FDT_STA_ID), <span class="st">&#39;FISH_TOX&#39;</span>),</span>
<span id="cb77-145"><a href="automated-assessment-analysis.html#cb77-145" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-146"><a href="automated-assessment-analysis.html#cb77-146" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Benthics </span></span>
<span id="cb77-147"><a href="automated-assessment-analysis.html#cb77-147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">benthicAssessment</span>(stationData, VSCIresults),</span>
<span id="cb77-148"><a href="automated-assessment-analysis.html#cb77-148" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-149"><a href="automated-assessment-analysis.html#cb77-149" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Nutrient Assessment done above by waterbody type</span></span>
<span id="cb77-150"><a href="automated-assessment-analysis.html#cb77-150" aria-hidden="true" tabindex="-1"></a>      TP,</span>
<span id="cb77-151"><a href="automated-assessment-analysis.html#cb77-151" aria-hidden="true" tabindex="-1"></a>      chla) <span class="sc">%&gt;%</span></span>
<span id="cb77-152"><a href="automated-assessment-analysis.html#cb77-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-153"><a href="automated-assessment-analysis.html#cb77-153" aria-hidden="true" tabindex="-1"></a>      <span class="co"># COMMENTS</span></span>
<span id="cb77-154"><a href="automated-assessment-analysis.html#cb77-154" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">COMMENTS =</span> <span class="fu">paste0</span>(DO_Daily_Avg_STAT) ) <span class="sc">%&gt;%</span> </span>
<span id="cb77-155"><a href="automated-assessment-analysis.html#cb77-155" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(comments, <span class="at">by =</span> <span class="st">&#39;STATION_ID&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-156"><a href="automated-assessment-analysis.html#cb77-156" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(lowFlowSummary, <span class="at">by =</span> <span class="st">&#39;STATION_ID&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-157"><a href="automated-assessment-analysis.html#cb77-157" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="fu">c</span>(<span class="st">&#39;exceedanceRate&#39;</span>, <span class="st">&#39;VERBOSE&#39;</span>, <span class="st">&#39;Assessment Decision&#39;</span>, <span class="st">&#39;StationID&#39;</span>))) <span class="sc">%&gt;%</span>  <span class="co"># to match Bulk Upload template but helpful to keep visible til now for testing</span></span>
<span id="cb77-158"><a href="automated-assessment-analysis.html#cb77-158" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Date Last Sampled</span><span class="st">`</span> <span class="ot">=</span> dateLastSampled)</span>
<span id="cb77-159"><a href="automated-assessment-analysis.html#cb77-159" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {<span class="co"># pull what you can from last cycle and flag as carry over</span></span>
<span id="cb77-160"><a href="automated-assessment-analysis.html#cb77-160" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">filter</span>(stationTable, STATION_ID <span class="sc">==</span> stationTable<span class="sc">$</span>STATION_ID[i]) <span class="sc">%&gt;%</span></span>
<span id="cb77-161"><a href="automated-assessment-analysis.html#cb77-161" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(STATION_ID<span class="sc">:</span>VAHU6, COMMENTS) <span class="sc">%&gt;%</span></span>
<span id="cb77-162"><a href="automated-assessment-analysis.html#cb77-162" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">COMMENTS =</span> <span class="st">&#39;This station has no data in current window but was carried over due to IM in one of the 2020IR status fields or the 2020 stations table reports the station was carried over from a previous cycle.&#39;</span>) <span class="sc">%&gt;%</span><span class="co">#,</span></span>
<span id="cb77-163"><a href="automated-assessment-analysis.html#cb77-163" aria-hidden="true" tabindex="-1"></a>             <span class="co">#BACTERIA_COMMENTS = NA) %&gt;%</span></span>
<span id="cb77-164"><a href="automated-assessment-analysis.html#cb77-164" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(comments, <span class="at">by =</span> <span class="st">&#39;STATION_ID&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-165"><a href="automated-assessment-analysis.html#cb77-165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Date Last Sampled</span><span class="st">`</span> <span class="ot">=</span> dateLastSampled)</span>
<span id="cb77-166"><a href="automated-assessment-analysis.html#cb77-166" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-167"><a href="automated-assessment-analysis.html#cb77-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-168"><a href="automated-assessment-analysis.html#cb77-168" aria-hidden="true" tabindex="-1"></a>  stationTableResults <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(stationTableResults,results)</span>
<span id="cb77-169"><a href="automated-assessment-analysis.html#cb77-169" aria-hidden="true" tabindex="-1"></a>  ammoniaAnalysis <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ammoniaAnalysis, <span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>FDT_STA_ID), <span class="at">AmmoniaAnalysis =</span> <span class="fu">list</span>(ammoniaAnalysisStation)))</span>
<span id="cb77-170"><a href="automated-assessment-analysis.html#cb77-170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-171"><a href="automated-assessment-analysis.html#cb77-171" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-172"><a href="automated-assessment-analysis.html#cb77-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-173"><a href="automated-assessment-analysis.html#cb77-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-174"><a href="automated-assessment-analysis.html#cb77-174" aria-hidden="true" tabindex="-1"></a>stationTableResults <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(stationsTemplate, stationTableResults) <span class="sc">%&gt;%</span></span>
<span id="cb77-175"><a href="automated-assessment-analysis.html#cb77-175" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for now bc bacteria needs help still</span></span>
<span id="cb77-176"><a href="automated-assessment-analysis.html#cb77-176" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(STATION_ID<span class="sc">:</span><span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>)</span>
<span id="cb77-177"><a href="automated-assessment-analysis.html#cb77-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-178"><a href="automated-assessment-analysis.html#cb77-178" aria-hidden="true" tabindex="-1"></a>timeDiff <span class="ot">=</span> <span class="fu">Sys.time</span>()<span class="sc">-</span> startTime</span></code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="automated-assessment.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="individual-parameter-analyses.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": null
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
