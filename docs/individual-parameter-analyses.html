<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.5 Individual Parameter Analyses | DEQ Water Quality Automated Assessment User Guide</title>
  <meta name="description" content="A companion document describing the WQA automated assessment methodology." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3.5 Individual Parameter Analyses | DEQ Water Quality Automated Assessment User Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A companion document describing the WQA automated assessment methodology." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.5 Individual Parameter Analyses | DEQ Water Quality Automated Assessment User Guide" />
  
  <meta name="twitter:description" content="A companion document describing the WQA automated assessment methodology." />
  

<meta name="author" content="DEQ Automated Assessment Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="automated-assessment-analysis.html"/>
<link rel="next" href="automated-output.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="assets/book.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DEQ Water Quality Automated Assessment User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="HowToUseDocument.html"><a href="HowToUseDocument.html"><i class="fa fa-check"></i><b>1.1</b> How to Use Document</a></li>
<li class="chapter" data-level="1.2" data-path="ProjectHistory.html"><a href="ProjectHistory.html"><i class="fa fa-check"></i><b>1.2</b> Project History</a></li>
<li class="chapter" data-level="1.3" data-path="wqa-technical-support-team.html"><a href="wqa-technical-support-team.html"><i class="fa fa-check"></i><b>1.3</b> WQA Technical Support Team</a></li>
<li class="chapter" data-level="1.4" data-path="Acknowledgements.html"><a href="Acknowledgements.html"><i class="fa fa-check"></i><b>1.4</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-organization.html"><a href="data-organization.html"><i class="fa fa-check"></i><b>2</b> Data Organization</a>
<ul>
<li class="chapter" data-level="2.1" data-path="conventionals-data.html"><a href="conventionals-data.html"><i class="fa fa-check"></i><b>2.1</b> Conventionals Data</a></li>
<li class="chapter" data-level="2.2" data-path="water-column-metals.html"><a href="water-column-metals.html"><i class="fa fa-check"></i><b>2.2</b> Water Column Metals</a></li>
<li class="chapter" data-level="2.3" data-path="sediment-metals.html"><a href="sediment-metals.html"><i class="fa fa-check"></i><b>2.3</b> Sediment Metals</a></li>
<li class="chapter" data-level="2.4" data-path="fish-tissue-data.html"><a href="fish-tissue-data.html"><i class="fa fa-check"></i><b>2.4</b> Fish Tissue Data</a></li>
<li class="chapter" data-level="2.5" data-path="pcb-data.html"><a href="pcb-data.html"><i class="fa fa-check"></i><b>2.5</b> PCB Data</a></li>
<li class="chapter" data-level="2.6" data-path="vdh-data.html"><a href="vdh-data.html"><i class="fa fa-check"></i><b>2.6</b> VDH Data</a></li>
<li class="chapter" data-level="2.7" data-path="citizen-monitoring-data.html"><a href="citizen-monitoring-data.html"><i class="fa fa-check"></i><b>2.7</b> Citizen Monitoring Data</a></li>
<li class="chapter" data-level="2.8" data-path="station-metadata.html"><a href="station-metadata.html"><i class="fa fa-check"></i><b>2.8</b> Station Metadata</a></li>
<li class="chapter" data-level="2.9" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html"><i class="fa fa-check"></i><b>2.9</b> Low Flow (7Q10) Data</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#q10-method"><i class="fa fa-check"></i><b>2.9.1</b> 7Q10 Method</a></li>
<li class="chapter" data-level="2.9.2" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#usgs-site-data-gathering"><i class="fa fa-check"></i><b>2.9.2</b> USGS Site Data Gathering</a></li>
<li class="chapter" data-level="2.9.3" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#important-7q10-calculation-notes"><i class="fa fa-check"></i><b>2.9.3</b> Important 7Q10 Calculation Notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="automated-assessment-methods.html"><a href="automated-assessment-methods.html"><i class="fa fa-check"></i><b>3</b> Automated Assessment Methods</a>
<ul>
<li class="chapter" data-level="3.1" data-path="metadata-attribution.html"><a href="metadata-attribution.html"><i class="fa fa-check"></i><b>3.1</b> Metadata Attribution</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="metadata-attribution.html"><a href="metadata-attribution.html#distinct-sites"><i class="fa fa-check"></i><b>3.1.1</b> Distinct Sites</a></li>
<li class="chapter" data-level="3.1.2" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-assessment-region-and-subbasin-information"><i class="fa fa-check"></i><b>3.1.2</b> Join Assessment Region and Subbasin Information</a></li>
<li class="chapter" data-level="3.1.3" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-stations-to-wqs"><i class="fa fa-check"></i><b>3.1.3</b> Join Stations to WQS</a></li>
<li class="chapter" data-level="3.1.4" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-stations-to-aus"><i class="fa fa-check"></i><b>3.1.4</b> Join Stations to AUs</a></li>
<li class="chapter" data-level="3.1.5" data-path="metadata-attribution.html"><a href="metadata-attribution.html#where-does-this-information-go"><i class="fa fa-check"></i><b>3.1.5</b> Where does this information go?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="organize-metadata.html"><a href="organize-metadata.html"><i class="fa fa-check"></i><b>3.2</b> Organize Metadata</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="organize-metadata.html"><a href="organize-metadata.html#reorganize-conventionals-dataset"><i class="fa fa-check"></i><b>3.2.1</b> Reorganize Conventionals Dataset</a></li>
<li class="chapter" data-level="3.2.2" data-path="organize-metadata.html"><a href="organize-metadata.html#adding-secchi-depth-to-conventionals-dataset"><i class="fa fa-check"></i><b>3.2.2</b> Adding Secchi Depth to conventionals dataset</a></li>
<li class="chapter" data-level="3.2.3" data-path="organize-metadata.html"><a href="organize-metadata.html#add-citizen-monitoring-data-to-conventionals"><i class="fa fa-check"></i><b>3.2.3</b> Add Citizen Monitoring Data to conventionals</a></li>
<li class="chapter" data-level="3.2.4" data-path="organize-metadata.html"><a href="organize-metadata.html#ensure-all-stations-have-necessary-wqs-and-au-information"><i class="fa fa-check"></i><b>3.2.4</b> Ensure all stations have necessary WQS and AU information</a></li>
<li class="chapter" data-level="3.2.5" data-path="organize-metadata.html"><a href="organize-metadata.html#clean-up-pcb-dataset"><i class="fa fa-check"></i><b>3.2.5</b> Clean up PCB dataset</a></li>
<li class="chapter" data-level="3.2.6" data-path="organize-metadata.html"><a href="organize-metadata.html#clean-up-fish-tissue-dataset"><i class="fa fa-check"></i><b>3.2.6</b> Clean up Fish Tissue dataset</a></li>
<li class="chapter" data-level="3.2.7" data-path="organize-metadata.html"><a href="organize-metadata.html#pin-official-clean-ir-data-to-r-server"><i class="fa fa-check"></i><b>3.2.7</b> Pin Official Clean IR data to R server</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="automated-assessment.html"><a href="automated-assessment.html"><i class="fa fa-check"></i><b>3.3</b> Automated Assessment</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="automated-assessment.html"><a href="automated-assessment.html#bring-in-required-datasets"><i class="fa fa-check"></i><b>3.3.1</b> Bring in required datasets</a></li>
<li class="chapter" data-level="3.3.2" data-path="automated-assessment.html"><a href="automated-assessment.html#attach-wqs-information"><i class="fa fa-check"></i><b>3.3.2</b> Attach WQS information</a></li>
<li class="chapter" data-level="3.3.3" data-path="automated-assessment.html"><a href="automated-assessment.html#identify-station-type"><i class="fa fa-check"></i><b>3.3.3</b> Identify Station Type</a></li>
<li class="chapter" data-level="3.3.4" data-path="automated-assessment.html"><a href="automated-assessment.html#bring-in-low-flow-information"><i class="fa fa-check"></i><b>3.3.4</b> Bring in Low Flow Information</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="automated-assessment-analysis.html"><a href="automated-assessment-analysis.html"><i class="fa fa-check"></i><b>3.4</b> Automated Assessment Analysis</a></li>
<li class="chapter" data-level="3.5" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html"><i class="fa fa-check"></i><b>3.5</b> Individual Parameter Analyses</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#how-to-test-individual-parameter-functions"><i class="fa fa-check"></i><b>3.5.1</b> How to Test Individual Parameter Functions</a></li>
<li class="chapter" data-level="3.5.2" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#temperature"><i class="fa fa-check"></i><b>3.5.2</b> Temperature</a></li>
<li class="chapter" data-level="3.5.3" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#dissolved-oxygen"><i class="fa fa-check"></i><b>3.5.3</b> Dissolved Oxygen</a></li>
<li class="chapter" data-level="3.5.4" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#ph"><i class="fa fa-check"></i><b>3.5.4</b> pH</a></li>
<li class="chapter" data-level="3.5.5" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#bacteria"><i class="fa fa-check"></i><b>3.5.5</b> Bacteria</a></li>
<li class="chapter" data-level="3.5.6" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#nutrients"><i class="fa fa-check"></i><b>3.5.6</b> Nutrients</a></li>
<li class="chapter" data-level="3.5.7" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#ammonia"><i class="fa fa-check"></i><b>3.5.7</b> Ammonia</a></li>
<li class="chapter" data-level="3.5.8" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#pcb"><i class="fa fa-check"></i><b>3.5.8</b> PCB</a></li>
<li class="chapter" data-level="3.5.9" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#metals"><i class="fa fa-check"></i><b>3.5.9</b> Metals</a></li>
<li class="chapter" data-level="3.5.10" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#fish-tissue"><i class="fa fa-check"></i><b>3.5.10</b> Fish Tissue</a></li>
<li class="chapter" data-level="3.5.11" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#benthics"><i class="fa fa-check"></i><b>3.5.11</b> Benthics</a></li>
<li class="chapter" data-level="3.5.12" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#additional-automated-functions"><i class="fa fa-check"></i><b>3.5.12</b> Additional Automated Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="automated-output.html"><a href="automated-output.html"><i class="fa fa-check"></i><b>3.6</b> Automated Output</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regional-metadata-validation-tool-how-to.html"><a href="regional-metadata-validation-tool-how-to.html"><i class="fa fa-check"></i><b>4</b> Regional Metadata Validation <br>Tool How To</a>
<ul>
<li class="chapter" data-level="4.1" data-path="application-orientation.html"><a href="application-orientation.html"><i class="fa fa-check"></i><b>4.1</b> Application Orientation</a></li>
<li class="chapter" data-level="4.2" data-path="application-use-water-quality-standards-qa-watershed-selection-tab.html"><a href="application-use-water-quality-standards-qa-watershed-selection-tab.html"><i class="fa fa-check"></i><b>4.2</b> Application Use: <br>Water Quality Standards QA- <br>Watershed Selection Tab</a></li>
<li class="chapter" data-level="4.3" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html"><i class="fa fa-check"></i><b>4.3</b> Application Use: <br>Water Quality Standards QA- <br>Manual Review Tab</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#map-orientation"><i class="fa fa-check"></i><b>4.3.1</b> Map Orientation</a></li>
<li class="chapter" data-level="4.3.2" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#what-do-the-buttons-do"><i class="fa fa-check"></i><b>4.3.2</b> What do the buttons do?</a></li>
<li class="chapter" data-level="4.3.3" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation"><i class="fa fa-check"></i><b>4.3.3</b> Application Operation</a></li>
<li class="chapter" data-level="4.3.4" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-1-wqs-segment"><i class="fa fa-check"></i><b>4.3.4</b> Application Operation: <br>Station that Snapped to 1 WQS Segment</a></li>
<li class="chapter" data-level="4.3.5" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-1-wqs-segment-1"><i class="fa fa-check"></i><b>4.3.5</b> Application Operation: <br>Station that Snapped to &gt;1 WQS Segment</a></li>
<li class="chapter" data-level="4.3.6" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-0-wqs-segments"><i class="fa fa-check"></i><b>4.3.6</b> Application Operation: <br>Station that Snapped to 0 WQS Segments</a></li>
<li class="chapter" data-level="4.3.7" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-there-are-no-more-stations-to-attribute"><i class="fa fa-check"></i><b>4.3.7</b> Application Operation: <br>There are no more stations to attribute</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="having-problems.html"><a href="having-problems.html"><i class="fa fa-check"></i><b>4.4</b> Having problems?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="riverine-application-how-to.html"><a href="riverine-application-how-to.html"><i class="fa fa-check"></i><b>5</b> Riverine Application How To</a></li>
<li class="chapter" data-level="6" data-path="lacustrine-application-how-to.html"><a href="lacustrine-application-how-to.html"><i class="fa fa-check"></i><b>6</b> Lacustrine Application How To</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DEQ Water Quality Automated Assessment User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="individual-parameter-analyses" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Individual Parameter Analyses</h2>
<p>The functions detailed in this section are called in either the <a href="https://github.com/EmmaVJones/IR2024/blob/main/3.automatedAssessment/HowToRunAutomatedAssessmentIR2024.Rmd" target="_blank">automated assessment workflow report</a> or by waterbody-specific shiny applications that unpack the output of the <a href="https://github.com/EmmaVJones/IR2024/blob/main/3.automatedAssessment/HowToRunAutomatedAssessmentIR2024.Rmd" target="_blank">automated assessment workflow report</a>. All the automated assessment functions are stored in a single .R file that is shared amongst the shiny applications and Rmarkdown report to minimize labor involved in maintaining these critical functions. One day, these functions will be published as an R package, but until then, you can access the latest version of this script <a href="https://github.com/EmmaVJones/IR2024/blob/main/3.automatedAssessment/automatedAssessmentFunctions.R" target="_blank">here</a>.</p>
<div id="how-to-test-individual-parameter-functions" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> How to Test Individual Parameter Functions</h3>
<p>The following code snippet will allow you to generate the appropriate <code>stationData</code> required for most function arguments. The below snippet will only run if you have run all the required data gathering and manipulation steps identified in the <a href="automated-assessment-analysis.html#automated-assessment-analysis">Automated Assessment Analysis</a> section. The chunk below is set up such that you can easily change test stations by updating your <code>station</code> object.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="individual-parameter-analyses.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># any station included in the stationTable object can be specified here, whether or not there is data for the station</span></span>
<span id="cb78-2"><a href="individual-parameter-analyses.html#cb78-2" aria-hidden="true" tabindex="-1"></a>station <span class="ot">&lt;-</span> <span class="st">&#39;1AACO014.57&#39;</span> <span class="co"># other potential examples: &#39;2-JKS023.61&#39;, &#39;1ABAR037.84&#39;</span></span>
<span id="cb78-3"><a href="individual-parameter-analyses.html#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="individual-parameter-analyses.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set up stationData object to run through individual parameter functions</span></span>
<span id="cb78-5"><a href="individual-parameter-analyses.html#cb78-5" aria-hidden="true" tabindex="-1"></a>stationData <span class="ot">&lt;-</span> <span class="fu">filter</span>(conventionals, FDT_STA_ID <span class="sc">%in%</span> station)<span class="sc">%&gt;%</span></span>
<span id="cb78-6"><a href="individual-parameter-analyses.html#cb78-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(stationTable, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;FDT_STA_ID&#39;</span> <span class="ot">=</span> <span class="st">&#39;STATION_ID&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-7"><a href="individual-parameter-analyses.html#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Special Standards Correction step. This is done on the actual data bc some special standards have temporal components</span></span>
<span id="cb78-8"><a href="individual-parameter-analyses.html#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pHSpecialStandardsCorrection</span>() <span class="sc">%&gt;%</span> <span class="co"># correct pH to special standards where necessary</span></span>
<span id="cb78-9"><a href="individual-parameter-analyses.html#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">temperatureSpecialStandardsCorrection</span>() <span class="sc">%&gt;%</span> <span class="co"># correct temperature special standards where necessary</span></span>
<span id="cb78-10"><a href="individual-parameter-analyses.html#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special lake steps</span></span>
<span id="cb78-11"><a href="individual-parameter-analyses.html#cb78-11" aria-hidden="true" tabindex="-1"></a>  {<span class="cf">if</span>(station <span class="sc">%in%</span> lakeStations<span class="sc">$</span>STATION_ID)</span>
<span id="cb78-12"><a href="individual-parameter-analyses.html#cb78-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>(</span>
<span id="cb78-13"><a href="individual-parameter-analyses.html#cb78-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(., <span class="at">lakeStation =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-14"><a href="individual-parameter-analyses.html#cb78-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">thermoclineDepth</span>())) <span class="co"># adds thermocline information and SampleDate</span></span>
<span id="cb78-15"><a href="individual-parameter-analyses.html#cb78-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="fu">mutate</span>(., <span class="at">lakeStation =</span> <span class="cn">FALSE</span>) }</span></code></pre></div>
<div id="why-would-you-want-to-test-individual-functions" class="section level4" number="3.5.1.1">
<h4><span class="header-section-number">3.5.1.1</span> Why would you want to test individual functions?</h4>
<p>New for the IR2024 cycle, all data, methods, and results are available for regional assessment staff (or any DEQ staff) to interrogate, for riverine and lacustrine waterbody types and some estuarine methods (stay tuned on improvements on this waterbody type). The agency has been working through technology hurdles to achieve full transparency for assessment processes for a number of years, and while we aren’t fully there yet, we are getting closer. This bookdown is written as an accompanying handbook to all automated assessment processes to decipher the process for beginner R users.</p>
<p>One of the goals of the WQA program is that anyone with access to the assessment data and analytical scripts can run the automated assessment processes and come to the same results. By consistently applying the same rules and logic to assessment data, we can ensure the assessment decisions are universally applied across the state.</p>
<p>Lastly, while we hope the next section containing plain English, narrative descriptions of the automated assessment functions provide sufficient explanation as to what and why analytical steps were taken, should you run into a question, the chunk above and the functions below will allow any user to dig into any function to fully understand each process. We encourage you to investigate these functions in a stepwise manner. Should you run into problems, please reach out to the <a href="#wqa-techical-support-team">WQA Technical Support Team</a>.</p>
</div>
</div>
<div id="temperature" class="section level3" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Temperature</h3>
<p>A maximum temperature criteria applies to stations depending on their <a href="https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section50/">associated WQS</a>{target = ’_blank’}. The <code>tempExceedances()</code> function identifies any temperature exceedances of the <code>Max Temperature (C)</code> field for each sample provided. The function removes all Level I and Level II data and missing data before rounding measure to even and comparing against the provided criteria. An internal <code>7Q10 Flag</code> is passed through this function for use in the <code>quickStats()</code> function should a user adjust the default <code>drop7Q10</code> argument.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="individual-parameter-analyses.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Max Temperature Exceedance Function</span></span>
<span id="cb79-2"><a href="individual-parameter-analyses.html#cb79-2" aria-hidden="true" tabindex="-1"></a>tempExceedances <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData){</span>
<span id="cb79-3"><a href="individual-parameter-analyses.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_DATE_TIME, FDT_DEPTH, tidyselect<span class="sc">::</span><span class="fu">contains</span>(<span class="st">&#39;TEMP_CELCIUS&#39;</span>), <span class="st">`</span><span class="at">Max Temperature (C)</span><span class="st">`</span>, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="co"># Just get relevant columns </span></span>
<span id="cb79-4"><a href="individual-parameter-analyses.html#cb79-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span> (LEVEL_FDT_TEMP_CELCIUS <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Level II&#39;</span>, <span class="st">&#39;Level I&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># get lower levels out</span></span>
<span id="cb79-5"><a href="individual-parameter-analyses.html#cb79-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">is.na</span>(FDT_TEMP_CELCIUS)) <span class="sc">%&gt;%</span> <span class="co"># get rid of NA&#39;s</span></span>
<span id="cb79-6"><a href="individual-parameter-analyses.html#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rename columns to make exceedance analyses easier to apply</span></span>
<span id="cb79-7"><a href="individual-parameter-analyses.html#cb79-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">parameter =</span> <span class="sc">!!</span> <span class="fu">names</span>(.[<span class="dv">3</span>]),</span>
<span id="cb79-8"><a href="individual-parameter-analyses.html#cb79-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">limit =</span> <span class="sc">!!</span> <span class="fu">names</span>(.[<span class="dv">6</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb79-9"><a href="individual-parameter-analyses.html#cb79-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply Round to Even Rule before testing for exceedances</span></span>
<span id="cb79-10"><a href="individual-parameter-analyses.html#cb79-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameterRound =</span> <span class="fu">signif</span>(parameter, <span class="at">digits =</span> <span class="dv">2</span>), <span class="co"># two significant figures based on WQS https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section50/</span></span>
<span id="cb79-11"><a href="individual-parameter-analyses.html#cb79-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">exceeds =</span> <span class="fu">case_when</span>(parameterRound <span class="sc">&gt;</span> limit <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co"># Identify where above max Temperature, </span></span>
<span id="cb79-12"><a href="individual-parameter-analyses.html#cb79-12" aria-hidden="true" tabindex="-1"></a>                                      parameterRound <span class="sc">&lt;=</span> limit <span class="sc">~</span> <span class="cn">FALSE</span>, <span class="co"># no exceedance</span></span>
<span id="cb79-13"><a href="individual-parameter-analyses.html#cb79-13" aria-hidden="true" tabindex="-1"></a>                                      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>))</span>
<span id="cb79-14"><a href="individual-parameter-analyses.html#cb79-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-15"><a href="individual-parameter-analyses.html#cb79-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-16"><a href="individual-parameter-analyses.html#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb79-17"><a href="individual-parameter-analyses.html#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb79-18"><a href="individual-parameter-analyses.html#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tempExceedances(stationData) </span></span>
<span id="cb79-19"><a href="individual-parameter-analyses.html#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="co"># tempExceedances(stationData) %&gt;%</span></span>
<span id="cb79-20"><a href="individual-parameter-analyses.html#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  quickStats(&#39;TEMP&#39;) # pass results to quickStats() to consolidate results</span></span></code></pre></div>
</div>
<div id="dissolved-oxygen" class="section level3" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Dissolved Oxygen</h3>
<p>There are two general dissolved oxygen (DO) criteria that may apply to stations, depending on their <a href="https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section50/">associated WQS</a>{target = ’_blank’}. The minimum DO criteria are evaluated against the provided <code>Dissolved Oxygen Min (mg/L)</code> using the <code>DOExceedances_Min()</code> function. This function handles lake stations differently than other waterbody types. If a station is in a <a href="https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section187/">Section 187 lake</a>{target = ’_blank’}, then only the epilimnion and unstratified samples are evaluated. Regardless of the waterbody type, all Level I and Level II data and missing data are removed before measures are rounded to even and compared against the provided criteria. An internal <code>7Q10 Flag</code> is passed through this function for use in the <code>quickStats()</code> function should a user adjust the default <code>drop7Q10</code> argument.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="individual-parameter-analyses.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimum DO Exceedance function</span></span>
<span id="cb80-2"><a href="individual-parameter-analyses.html#cb80-2" aria-hidden="true" tabindex="-1"></a>DOExceedances_Min <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData){</span>
<span id="cb80-3"><a href="individual-parameter-analyses.html#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special step for lake stations, remove samples based on lake assessment guidance </span></span>
<span id="cb80-4"><a href="individual-parameter-analyses.html#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>lakeStation) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb80-5"><a href="individual-parameter-analyses.html#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>Lakes_187B)) <span class="sc">&amp;</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>Lakes_187B) <span class="sc">==</span> <span class="st">&#39;y&#39;</span>){</span>
<span id="cb80-6"><a href="individual-parameter-analyses.html#cb80-6" aria-hidden="true" tabindex="-1"></a>      DOdata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(stationData, LakeStratification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Epilimnion&quot;</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> <span class="co"># only use epilimnion or unstratified samples for analysis</span></span>
<span id="cb80-7"><a href="individual-parameter-analyses.html#cb80-7" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, DO_mg_L, RMK_DO, LEVEL_DO, </span>
<span id="cb80-8"><a href="individual-parameter-analyses.html#cb80-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">Dissolved Oxygen Min (mg/L)</span><span class="st">`</span>, LakeStratification, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) <span class="co"># Just get relevant columns,</span></span>
<span id="cb80-9"><a href="individual-parameter-analyses.html#cb80-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb80-10"><a href="individual-parameter-analyses.html#cb80-10" aria-hidden="true" tabindex="-1"></a>      DOdata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, DO_mg_L, RMK_DO, LEVEL_DO,</span>
<span id="cb80-11"><a href="individual-parameter-analyses.html#cb80-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">Dissolved Oxygen Min (mg/L)</span><span class="st">`</span>, LakeStratification, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) }<span class="co"># Just get relevant columns,</span></span>
<span id="cb80-12"><a href="individual-parameter-analyses.html#cb80-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb80-13"><a href="individual-parameter-analyses.html#cb80-13" aria-hidden="true" tabindex="-1"></a>    DOdata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, DO_mg_L, RMK_DO, LEVEL_DO, </span>
<span id="cb80-14"><a href="individual-parameter-analyses.html#cb80-14" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">Dissolved Oxygen Min (mg/L)</span><span class="st">`</span>, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) <span class="co"># Just get relevant columns, </span></span>
<span id="cb80-15"><a href="individual-parameter-analyses.html#cb80-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-16"><a href="individual-parameter-analyses.html#cb80-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-17"><a href="individual-parameter-analyses.html#cb80-17" aria-hidden="true" tabindex="-1"></a>  DOdata <span class="sc">%&gt;%</span></span>
<span id="cb80-18"><a href="individual-parameter-analyses.html#cb80-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(LEVEL_DO <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Level II&#39;</span>, <span class="st">&#39;Level I&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># get lower levels out</span></span>
<span id="cb80-19"><a href="individual-parameter-analyses.html#cb80-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(DO_mg_L)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-20"><a href="individual-parameter-analyses.html#cb80-20" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">parameter =</span> <span class="sc">!!</span><span class="fu">names</span>(.[<span class="dv">4</span>]), <span class="at">limit =</span> <span class="sc">!!</span><span class="fu">names</span>(.[<span class="dv">7</span>])) <span class="sc">%&gt;%</span> <span class="co"># rename columns to make functions easier to apply</span></span>
<span id="cb80-21"><a href="individual-parameter-analyses.html#cb80-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Round to Even Rule</span></span>
<span id="cb80-22"><a href="individual-parameter-analyses.html#cb80-22" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">parameterRound =</span> <span class="fu">signif</span>(parameter, <span class="at">digits =</span> <span class="dv">2</span>), <span class="co"># two significant figures based on  https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section50/</span></span>
<span id="cb80-23"><a href="individual-parameter-analyses.html#cb80-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">exceeds =</span> <span class="fu">case_when</span>(parameterRound <span class="sc">&lt;</span> limit <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co"># Identify where below min DO </span></span>
<span id="cb80-24"><a href="individual-parameter-analyses.html#cb80-24" aria-hidden="true" tabindex="-1"></a>                                      parameterRound <span class="sc">&gt;=</span> limit <span class="sc">~</span> <span class="cn">FALSE</span>, <span class="co"># no exceedance</span></span>
<span id="cb80-25"><a href="individual-parameter-analyses.html#cb80-25" aria-hidden="true" tabindex="-1"></a>                                      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>))</span>
<span id="cb80-26"><a href="individual-parameter-analyses.html#cb80-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-27"><a href="individual-parameter-analyses.html#cb80-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-28"><a href="individual-parameter-analyses.html#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb80-29"><a href="individual-parameter-analyses.html#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb80-30"><a href="individual-parameter-analyses.html#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="co"># DOExceedances_Min(stationData) </span></span>
<span id="cb80-31"><a href="individual-parameter-analyses.html#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="co"># DOExceedances_Min(stationData) %&gt;% </span></span>
<span id="cb80-32"><a href="individual-parameter-analyses.html#cb80-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   quickStats(&#39;DO&#39;) # pass results to quickStats() to consolidate results</span></span></code></pre></div>
<p>A separate function called <code>DO_Assessment_DailyAvg()</code> evaluates whether or not a station exceeds the DO daily average criteria, provided in the <code>Dissolved Oxygen Daily Avg (mg/L)</code> field. This analysis is only run if the number of samples for a station in a given date are greater than one. This function handles lake stations differently than other waterbody types. If a station is in a <a href="https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section187/">Section 187 lake</a>{target = ’_blank’}, then only the epilimnion and unstratified samples are evaluated. Regardless of the waterbody type, all Level I and Level II data and missing data are removed before measures are rounded to even and compared against the provided criteria. An internal <code>7Q10 Flag</code> is passed through this function for use in the <code>quickStats()</code> function should a user adjust the default <code>drop7Q10</code> argument.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="individual-parameter-analyses.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily Average exceedance function</span></span>
<span id="cb81-2"><a href="individual-parameter-analyses.html#cb81-2" aria-hidden="true" tabindex="-1"></a>DO_Assessment_DailyAvg <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData){ </span>
<span id="cb81-3"><a href="individual-parameter-analyses.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special step for lake stations, remove samples based on lake assessment guidance </span></span>
<span id="cb81-4"><a href="individual-parameter-analyses.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>lakeStation) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb81-5"><a href="individual-parameter-analyses.html#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>Lakes_187B)) <span class="sc">&amp;</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>Lakes_187B) <span class="sc">==</span> <span class="st">&#39;y&#39;</span>){</span>
<span id="cb81-6"><a href="individual-parameter-analyses.html#cb81-6" aria-hidden="true" tabindex="-1"></a>      DOdata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(stationData, LakeStratification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Epilimnion&quot;</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> <span class="co"># only use epilimnion or unstratified samples for analysis</span></span>
<span id="cb81-7"><a href="individual-parameter-analyses.html#cb81-7" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, DO_mg_L, RMK_DO, LEVEL_DO, </span>
<span id="cb81-8"><a href="individual-parameter-analyses.html#cb81-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">Dissolved Oxygen Daily Avg (mg/L)</span><span class="st">`</span>, LakeStratification, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) <span class="co"># Just get relevant columns,</span></span>
<span id="cb81-9"><a href="individual-parameter-analyses.html#cb81-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb81-10"><a href="individual-parameter-analyses.html#cb81-10" aria-hidden="true" tabindex="-1"></a>      DOdata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, DO_mg_L, RMK_DO, LEVEL_DO,</span>
<span id="cb81-11"><a href="individual-parameter-analyses.html#cb81-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">Dissolved Oxygen Daily Avg (mg/L)</span><span class="st">`</span>, LakeStratification, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) }<span class="co"># Just get relevant columns,</span></span>
<span id="cb81-12"><a href="individual-parameter-analyses.html#cb81-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb81-13"><a href="individual-parameter-analyses.html#cb81-13" aria-hidden="true" tabindex="-1"></a>    DOdata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, DO_mg_L, RMK_DO, LEVEL_DO, </span>
<span id="cb81-14"><a href="individual-parameter-analyses.html#cb81-14" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">Dissolved Oxygen Daily Avg (mg/L)</span><span class="st">`</span>, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) <span class="co"># Just get relevant columns, </span></span>
<span id="cb81-15"><a href="individual-parameter-analyses.html#cb81-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-16"><a href="individual-parameter-analyses.html#cb81-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-17"><a href="individual-parameter-analyses.html#cb81-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-18"><a href="individual-parameter-analyses.html#cb81-18" aria-hidden="true" tabindex="-1"></a>  DOdata <span class="sc">%&gt;%</span> </span>
<span id="cb81-19"><a href="individual-parameter-analyses.html#cb81-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(LEVEL_DO <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Level II&#39;</span>, <span class="st">&#39;Level I&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># get lower levels out</span></span>
<span id="cb81-20"><a href="individual-parameter-analyses.html#cb81-20" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(DO_mg_L)) <span class="sc">%&gt;%</span> <span class="co">#get rid of NA&#39;s</span></span>
<span id="cb81-21"><a href="individual-parameter-analyses.html#cb81-21" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(FDT_DATE_TIME, <span class="at">format=</span><span class="st">&quot;%m/%d/%Y&quot;</span>), </span>
<span id="cb81-22"><a href="individual-parameter-analyses.html#cb81-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">limit =</span> <span class="st">`</span><span class="at">Dissolved Oxygen Daily Avg (mg/L)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-23"><a href="individual-parameter-analyses.html#cb81-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb81-24"><a href="individual-parameter-analyses.html#cb81-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n_Samples_Daily =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># how many samples per day?</span></span>
<span id="cb81-25"><a href="individual-parameter-analyses.html#cb81-25" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(n_Samples_Daily <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-26"><a href="individual-parameter-analyses.html#cb81-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Daily average with average rounded to even</span></span>
<span id="cb81-27"><a href="individual-parameter-analyses.html#cb81-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DO_DailyAverage =</span> <span class="fu">signif</span>(<span class="fu">mean</span>(DO_mg_L), <span class="at">digits =</span> <span class="dv">2</span>),  <span class="co"># two significant figures based on  https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section50/</span></span>
<span id="cb81-28"><a href="individual-parameter-analyses.html#cb81-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">exceeds =</span>  <span class="fu">case_when</span>(DO_DailyAverage <span class="sc">&lt;</span> limit <span class="sc">&amp;</span> <span class="fu">is.na</span>(<span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co"># exceedance if above limit and no 7Q10 Flag</span></span>
<span id="cb81-29"><a href="individual-parameter-analyses.html#cb81-29" aria-hidden="true" tabindex="-1"></a>                                       DO_DailyAverage <span class="sc">&lt;</span> limit <span class="sc">&amp;</span> <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;7Q10 Flag&quot;</span> <span class="sc">~</span> <span class="cn">FALSE</span>,  <span class="co"># exceedance if above limit and 7Q10 Flag</span></span>
<span id="cb81-30"><a href="individual-parameter-analyses.html#cb81-30" aria-hidden="true" tabindex="-1"></a>                                       DO_DailyAverage <span class="sc">&gt;=</span> limit <span class="sc">~</span> <span class="cn">FALSE</span>, <span class="co"># no exceedance</span></span>
<span id="cb81-31"><a href="individual-parameter-analyses.html#cb81-31" aria-hidden="true" tabindex="-1"></a>                                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-32"><a href="individual-parameter-analyses.html#cb81-32" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#ifelse(DO_DailyAverage &lt; `Dissolved Oxygen Daily Avg (mg/L)`,T,F)) %&gt;% </span></span>
<span id="cb81-33"><a href="individual-parameter-analyses.html#cb81-33" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-34"><a href="individual-parameter-analyses.html#cb81-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(date, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb81-35"><a href="individual-parameter-analyses.html#cb81-35" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(FDT_DATE_TIME)) </span>
<span id="cb81-36"><a href="individual-parameter-analyses.html#cb81-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-37"><a href="individual-parameter-analyses.html#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="individual-parameter-analyses.html#cb81-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb81-39"><a href="individual-parameter-analyses.html#cb81-39" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb81-40"><a href="individual-parameter-analyses.html#cb81-40" aria-hidden="true" tabindex="-1"></a><span class="co"># DO_Assessment_DailyAvg(stationData)</span></span>
<span id="cb81-41"><a href="individual-parameter-analyses.html#cb81-41" aria-hidden="true" tabindex="-1"></a><span class="co"># DO_Assessment_DailyAvg(stationData) %&gt;% </span></span>
<span id="cb81-42"><a href="individual-parameter-analyses.html#cb81-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   quickStats(&#39;DO_Daily_Avg&#39;)  # pass results to quickStats() to consolidate results</span></span></code></pre></div>
</div>
<div id="ph" class="section level3" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> pH</h3>
<p>A pH range criteria applies to stations depending on their <a href="https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section50/">associated WQS</a>{target = ’_blank’}. The <code>pHExceedances()</code> function identifies any pH values outside of the range specified in the associated <code>pH Min</code> and <code>pH Max</code> fields. This function handles lake stations differently than other waterbody types. If a station is in a <a href="https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section187/">Section 187 lake</a>{target = ’_blank’}, then only the epilimnion and unstratified samples are evaluated. Regardless of the waterbody type, the function removes all Level I and Level II data and missing data before rounding measures to even and comparing against the provided criteria. An internal <code>7Q10 Flag</code> is passed through this function for use in the <code>quickStats()</code> function should a user adjust the default <code>drop7Q10</code> argument.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="individual-parameter-analyses.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pH range Exceedance Function</span></span>
<span id="cb82-2"><a href="individual-parameter-analyses.html#cb82-2" aria-hidden="true" tabindex="-1"></a>pHExceedances <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData){</span>
<span id="cb82-3"><a href="individual-parameter-analyses.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># special step for lake stations, remove samples based on lake assessment guidance </span></span>
<span id="cb82-4"><a href="individual-parameter-analyses.html#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>lakeStation) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb82-5"><a href="individual-parameter-analyses.html#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>Lakes_187B)) <span class="sc">&amp;</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>Lakes_187B) <span class="sc">==</span> <span class="st">&#39;y&#39;</span>){</span>
<span id="cb82-6"><a href="individual-parameter-analyses.html#cb82-6" aria-hidden="true" tabindex="-1"></a>      pHdata <span class="ot">&lt;-</span> <span class="fu">filter</span>(stationData, LakeStratification <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Epilimnion&quot;</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> <span class="co"># only use epilimnion or unstratified samples for analysis</span></span>
<span id="cb82-7"><a href="individual-parameter-analyses.html#cb82-7" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, FDT_FIELD_PH, RMK_FDT_FIELD_PH, LEVEL_FDT_FIELD_PH, </span>
<span id="cb82-8"><a href="individual-parameter-analyses.html#cb82-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">pH Min</span><span class="st">`</span>, <span class="st">`</span><span class="at">pH Max</span><span class="st">`</span>, LakeStratification, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) <span class="co"># Just get relevant columns,</span></span>
<span id="cb82-9"><a href="individual-parameter-analyses.html#cb82-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb82-10"><a href="individual-parameter-analyses.html#cb82-10" aria-hidden="true" tabindex="-1"></a>      pHdata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, FDT_FIELD_PH, RMK_FDT_FIELD_PH, LEVEL_FDT_FIELD_PH,</span>
<span id="cb82-11"><a href="individual-parameter-analyses.html#cb82-11" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">pH Min</span><span class="st">`</span>, <span class="st">`</span><span class="at">pH Max</span><span class="st">`</span>, LakeStratification, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) }<span class="co"># Just get relevant columns,</span></span>
<span id="cb82-12"><a href="individual-parameter-analyses.html#cb82-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb82-13"><a href="individual-parameter-analyses.html#cb82-13" aria-hidden="true" tabindex="-1"></a>    pHdata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_STA_ID, FDT_DATE_TIME, FDT_DEPTH, FDT_FIELD_PH, RMK_FDT_FIELD_PH, LEVEL_FDT_FIELD_PH, </span>
<span id="cb82-14"><a href="individual-parameter-analyses.html#cb82-14" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">pH Min</span><span class="st">`</span>, <span class="st">`</span><span class="at">pH Max</span><span class="st">`</span>, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) }<span class="co"># Just get relevant columns, </span></span>
<span id="cb82-15"><a href="individual-parameter-analyses.html#cb82-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-16"><a href="individual-parameter-analyses.html#cb82-16" aria-hidden="true" tabindex="-1"></a>  pHdata <span class="ot">&lt;-</span> <span class="fu">filter</span>(pHdata, <span class="sc">!</span>(LEVEL_FDT_FIELD_PH <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Level II&#39;</span>, <span class="st">&#39;Level I&#39;</span>))) <span class="sc">%&gt;%</span> <span class="co"># get lower levels out</span></span>
<span id="cb82-17"><a href="individual-parameter-analyses.html#cb82-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(FDT_FIELD_PH)) <span class="co">#get rid of NA&#39;s</span></span>
<span id="cb82-18"><a href="individual-parameter-analyses.html#cb82-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-19"><a href="individual-parameter-analyses.html#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only run analysis if WQS exist for station</span></span>
<span id="cb82-20"><a href="individual-parameter-analyses.html#cb82-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(pHdata<span class="sc">$</span><span class="st">`</span><span class="at">pH Min</span><span class="st">`</span>)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(pHdata<span class="sc">$</span><span class="st">`</span><span class="at">pH Max</span><span class="st">`</span>))){</span>
<span id="cb82-21"><a href="individual-parameter-analyses.html#cb82-21" aria-hidden="true" tabindex="-1"></a>      pH <span class="ot">&lt;-</span> <span class="fu">mutate</span>(pHdata, <span class="at">interval =</span> <span class="dv">1</span>, <span class="at">exceeds =</span> <span class="cn">FALSE</span>, <span class="at">limit =</span> <span class="st">`</span><span class="at">pH Min</span><span class="st">`</span>) <span class="co"># placeholder to run quickStats() without any WQS</span></span>
<span id="cb82-22"><a href="individual-parameter-analyses.html#cb82-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb82-23"><a href="individual-parameter-analyses.html#cb82-23" aria-hidden="true" tabindex="-1"></a>        pH <span class="ot">&lt;-</span> pHdata <span class="sc">%&gt;%</span></span>
<span id="cb82-24"><a href="individual-parameter-analyses.html#cb82-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb82-25"><a href="individual-parameter-analyses.html#cb82-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Round to Even Rule</span></span>
<span id="cb82-26"><a href="individual-parameter-analyses.html#cb82-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">parameterRound =</span> <span class="fu">signif</span>(FDT_FIELD_PH, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="co"># two significant figures based on WQS https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section50/</span></span>
<span id="cb82-27"><a href="individual-parameter-analyses.html#cb82-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">interval=</span><span class="fu">findInterval</span>(parameterRound,<span class="fu">c</span>(<span class="st">`</span><span class="at">pH Min</span><span class="st">`</span>,<span class="st">`</span><span class="at">pH Max</span><span class="st">`</span>), <span class="at">left.open=</span><span class="cn">TRUE</span>, <span class="at">rightmost.closed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="co"># Identify where pH outside of assessment range with round to even</span></span>
<span id="cb82-28"><a href="individual-parameter-analyses.html#cb82-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb82-29"><a href="individual-parameter-analyses.html#cb82-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">exceeds =</span> <span class="fu">case_when</span>(interval <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co">#  Highlight where pH doesn&#39;t fall into criteria range</span></span>
<span id="cb82-30"><a href="individual-parameter-analyses.html#cb82-30" aria-hidden="true" tabindex="-1"></a>                                   interval <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="cn">FALSE</span>,  <span class="co"># no exceedance if inside limit</span></span>
<span id="cb82-31"><a href="individual-parameter-analyses.html#cb82-31" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>),</span>
<span id="cb82-32"><a href="individual-parameter-analyses.html#cb82-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">limit =</span> <span class="st">`</span><span class="at">pH Min</span><span class="st">`</span>)</span>
<span id="cb82-33"><a href="individual-parameter-analyses.html#cb82-33" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb82-34"><a href="individual-parameter-analyses.html#cb82-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pH)</span>
<span id="cb82-35"><a href="individual-parameter-analyses.html#cb82-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-36"><a href="individual-parameter-analyses.html#cb82-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-37"><a href="individual-parameter-analyses.html#cb82-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb82-38"><a href="individual-parameter-analyses.html#cb82-38" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb82-39"><a href="individual-parameter-analyses.html#cb82-39" aria-hidden="true" tabindex="-1"></a><span class="co"># pHExceedances(stationData) </span></span>
<span id="cb82-40"><a href="individual-parameter-analyses.html#cb82-40" aria-hidden="true" tabindex="-1"></a><span class="co"># pHExceedances(stationData) %&gt;% </span></span>
<span id="cb82-41"><a href="individual-parameter-analyses.html#cb82-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   quickStats(&#39;PH&#39;)  # pass results to quickStats() to consolidate results</span></span></code></pre></div>
</div>
<div id="bacteria" class="section level3" number="3.5.5">
<h3><span class="header-section-number">3.5.5</span> Bacteria</h3>
<p><a href="https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section170/">Recreational bacteria</a>{target = ’_blank’} is a more complicated standard to apply to monitoring data due to the unique rolling windows. To standardize the logic across <em>E.coli</em> and enterococci data, the nested function architecture that evaluates the bacteria data is programmed to handle either <em>E.coli</em> or enterococci data. The four functions required to calculate the bacteria criteria are detailed below.</p>
<div id="bacteriaexceedances_new" class="section level4" number="3.5.5.1">
<h4><span class="header-section-number">3.5.5.1</span> bacteriaExceedances_NEW</h4>
<p>The <code>bacteriaExceedances_NEW()</code> function is the innermost function in the nested bacteria function logic. This is the analytical function that applies the bacteria criteria logic. This function takes in all station data, the designated <code>bacteriaField</code> and <code>bacteriaRemark</code> field arguments to tell the function which type of bacteria to assess (<em>E.coli</em> or enterococci), a <code>sampleRequirement</code> argument (minimum n samples in 90 day window needed to apply geomean), a <code>STV</code> argument (threshold for <em>E.coli</em> or enterococci), and a <code>geomeanCriteria</code> argument (threshold for <em>E.coli</em> or enterococci). The function is applied inside the <code>bacteriaAssessmentDecision()</code> function to calculate unique 90 day data windows, apply STV and geomean criteria where appropriate, and report out the results of this analysis for summarization and language standardization by <code>bacteriaAssessmentDecision()</code>. To ease later data visualization steps, a listcolumn named <code>associatedData</code> is included in the function output that contains the raw data that falls within each 90 day window the user can unpack to see all data associated with each 90 day window.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="individual-parameter-analyses.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to assess on 90 day windows across input dataset</span></span>
<span id="cb83-2"><a href="individual-parameter-analyses.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># really just a building block, one probably wouldn&#39;t run this function independently</span></span>
<span id="cb83-3"><a href="individual-parameter-analyses.html#cb83-3" aria-hidden="true" tabindex="-1"></a>bacteriaExceedances_NEW <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData, <span class="co"># input dataframe with bacteria data</span></span>
<span id="cb83-4"><a href="individual-parameter-analyses.html#cb83-4" aria-hidden="true" tabindex="-1"></a>                                    bacteriaField, <span class="co"># name of bacteria field data</span></span>
<span id="cb83-5"><a href="individual-parameter-analyses.html#cb83-5" aria-hidden="true" tabindex="-1"></a>                                    bacteriaRemark, <span class="co"># name of bacteria comment field</span></span>
<span id="cb83-6"><a href="individual-parameter-analyses.html#cb83-6" aria-hidden="true" tabindex="-1"></a>                                    sampleRequirement, <span class="co"># minimum n samples in 90 day window needed to apply geomean</span></span>
<span id="cb83-7"><a href="individual-parameter-analyses.html#cb83-7" aria-hidden="true" tabindex="-1"></a>                                    STV, <span class="co"># unique for ecoli/enter</span></span>
<span id="cb83-8"><a href="individual-parameter-analyses.html#cb83-8" aria-hidden="true" tabindex="-1"></a>                                    geomeanCriteria <span class="co"># unique for ecoli/enter</span></span>
<span id="cb83-9"><a href="individual-parameter-analyses.html#cb83-9" aria-hidden="true" tabindex="-1"></a>                                    ){</span>
<span id="cb83-10"><a href="individual-parameter-analyses.html#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Output tibble to organize results, need list object to save associate data</span></span>
<span id="cb83-11"><a href="individual-parameter-analyses.html#cb83-11" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">`</span><span class="at">StationID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb83-12"><a href="individual-parameter-analyses.html#cb83-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Date Window Starts</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="cn">NA</span>), </span>
<span id="cb83-13"><a href="individual-parameter-analyses.html#cb83-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Date Window Ends</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="cn">NA</span>), </span>
<span id="cb83-14"><a href="individual-parameter-analyses.html#cb83-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Last Sample Date in Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="cn">NA</span>), </span>
<span id="cb83-15"><a href="individual-parameter-analyses.html#cb83-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Samples in 90 Day Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), </span>
<span id="cb83-16"><a href="individual-parameter-analyses.html#cb83-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">STV Exceedances In Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), </span>
<span id="cb83-17"><a href="individual-parameter-analyses.html#cb83-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">STV Exceedance Rate</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), </span>
<span id="cb83-18"><a href="individual-parameter-analyses.html#cb83-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">STV Assessment</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb83-19"><a href="individual-parameter-analyses.html#cb83-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb83-20"><a href="individual-parameter-analyses.html#cb83-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Geomean Assessment</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb83-21"><a href="individual-parameter-analyses.html#cb83-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">associatedData =</span> <span class="fu">list</span>())</span>
<span id="cb83-22"><a href="individual-parameter-analyses.html#cb83-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-23"><a href="individual-parameter-analyses.html#cb83-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data reorg to enable both types of bacteria assessment from a single function</span></span>
<span id="cb83-24"><a href="individual-parameter-analyses.html#cb83-24" aria-hidden="true" tabindex="-1"></a>  stationData2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_STA_ID, FDT_DATE_TIME, <span class="sc">!!</span> bacteriaField, <span class="sc">!!</span> bacteriaRemark) <span class="sc">%&gt;%</span></span>
<span id="cb83-25"><a href="individual-parameter-analyses.html#cb83-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Value =</span> bacteriaField, <span class="at">LEVEL_Value =</span> bacteriaRemark) <span class="sc">%&gt;%</span></span>
<span id="cb83-26"><a href="individual-parameter-analyses.html#cb83-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span> LEVEL_Value <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Level II&#39;</span>, <span class="st">&#39;Level I&#39;</span>)) <span class="sc">%&gt;%</span> <span class="co"># get lower levels out</span></span>
<span id="cb83-27"><a href="individual-parameter-analyses.html#cb83-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Value))</span>
<span id="cb83-28"><a href="individual-parameter-analyses.html#cb83-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-29"><a href="individual-parameter-analyses.html#cb83-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(stationData2) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb83-30"><a href="individual-parameter-analyses.html#cb83-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each row of input df to test 90 day windows against assessment criteria</span></span>
<span id="cb83-31"><a href="individual-parameter-analyses.html#cb83-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(stationData2)){</span>
<span id="cb83-32"><a href="individual-parameter-analyses.html#cb83-32" aria-hidden="true" tabindex="-1"></a>      time1 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(stationData2<span class="sc">$</span>FDT_DATE_TIME[i])</span>
<span id="cb83-33"><a href="individual-parameter-analyses.html#cb83-33" aria-hidden="true" tabindex="-1"></a>      timePlus89 <span class="ot">&lt;-</span> time1 <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">89</span>) </span>
<span id="cb83-34"><a href="individual-parameter-analyses.html#cb83-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-35"><a href="individual-parameter-analyses.html#cb83-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Organize prerequisites to decision process</span></span>
<span id="cb83-36"><a href="individual-parameter-analyses.html#cb83-36" aria-hidden="true" tabindex="-1"></a>      windowData <span class="ot">&lt;-</span> <span class="fu">filter</span>(stationData2, <span class="fu">as.Date</span>(FDT_DATE_TIME) <span class="sc">&gt;=</span> time1 <span class="sc">&amp;</span> <span class="fu">as.Date</span>(FDT_DATE_TIME) <span class="sc">&lt;=</span> timePlus89) <span class="sc">%&gt;%</span> </span>
<span id="cb83-37"><a href="individual-parameter-analyses.html#cb83-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">nSamples =</span> <span class="fu">n</span>(), <span class="co"># count number of samples in 90 day window</span></span>
<span id="cb83-38"><a href="individual-parameter-analyses.html#cb83-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">STVhit =</span> <span class="fu">ifelse</span>(Value <span class="sc">&gt;</span> STV, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="co"># test values in window against STV</span></span>
<span id="cb83-39"><a href="individual-parameter-analyses.html#cb83-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">geomean =</span> <span class="fu">ifelse</span>(nSamples <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="co"># calculate geomean of samples if nSamples&gt;1</span></span>
<span id="cb83-40"><a href="individual-parameter-analyses.html#cb83-40" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">as.numeric</span>(round<span class="sc">::</span><span class="fu">roundAll</span>(EnvStats<span class="sc">::</span><span class="fu">geoMean</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">digits=</span><span class="dv">0</span>, <span class="st">&quot;r0.C&quot;</span>)), <span class="co"># round to nearest whole number per Memo to Standardize Rounding for Assessment Guidance</span></span>
<span id="cb83-41"><a href="individual-parameter-analyses.html#cb83-41" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">NA</span>), </span>
<span id="cb83-42"><a href="individual-parameter-analyses.html#cb83-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">geomeanCriteriaHit =</span> <span class="fu">ifelse</span>(geomean <span class="sc">&gt;</span> geomeanCriteria, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="co"># test round to even geomean against geomean Criteria</span></span>
<span id="cb83-43"><a href="individual-parameter-analyses.html#cb83-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-44"><a href="individual-parameter-analyses.html#cb83-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># First level of testing: any STV hits in dataset? Want this information for all scenarios</span></span>
<span id="cb83-45"><a href="individual-parameter-analyses.html#cb83-45" aria-hidden="true" tabindex="-1"></a>      nSTVhitsInWindow <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">filter</span>(windowData, STVhit <span class="sc">==</span> <span class="cn">TRUE</span>))</span>
<span id="cb83-46"><a href="individual-parameter-analyses.html#cb83-46" aria-hidden="true" tabindex="-1"></a>      <span class="co"># STV exceedance rate calculation with round to even math</span></span>
<span id="cb83-47"><a href="individual-parameter-analyses.html#cb83-47" aria-hidden="true" tabindex="-1"></a>      STVexceedanceRate <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">unique</span>(windowData<span class="sc">$</span>nSamples) <span class="sc">&gt;=</span> <span class="dv">10</span>, </span>
<span id="cb83-48"><a href="individual-parameter-analyses.html#cb83-48" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">as.numeric</span>(round<span class="sc">::</span><span class="fu">roundAll</span>((nSTVhitsInWindow <span class="sc">/</span> <span class="fu">unique</span>(windowData<span class="sc">$</span>nSamples)) <span class="sc">*</span> <span class="dv">100</span>,<span class="at">digits=</span><span class="dv">0</span>, <span class="st">&quot;r0.C&quot;</span>)), <span class="co"># round to nearest whole number per Memo to Standardize Rounding for Assessment Guidance</span></span>
<span id="cb83-49"><a href="individual-parameter-analyses.html#cb83-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">NA</span>) <span class="co"># no STV exceedance rate if &lt; 10 samples</span></span>
<span id="cb83-50"><a href="individual-parameter-analyses.html#cb83-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(nSTVhitsInWindow <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb83-51"><a href="individual-parameter-analyses.html#cb83-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">STV Assessment</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="st">&#39;No STV violations within 90 day window&#39;</span> } </span>
<span id="cb83-52"><a href="individual-parameter-analyses.html#cb83-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(nSTVhitsInWindow <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb83-53"><a href="individual-parameter-analyses.html#cb83-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">STV Assessment</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">paste</span>(nSTVhitsInWindow, <span class="st">&#39; STV violation(s) with &#39;</span>, <span class="fu">format</span>(STVexceedanceRate, <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb83-54"><a href="individual-parameter-analyses.html#cb83-54" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&#39;% exceedance rate in 90 day window | Insufficient Information (Prioritize for follow up monitoring)&#39;</span>,<span class="at">sep=</span><span class="st">&#39;&#39;</span>)}</span>
<span id="cb83-55"><a href="individual-parameter-analyses.html#cb83-55" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(nSTVhitsInWindow <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb83-56"><a href="individual-parameter-analyses.html#cb83-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">STV Assessment</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">paste</span>(nSTVhitsInWindow, <span class="st">&#39; STV violation(s) with &#39;</span>, <span class="fu">format</span>(STVexceedanceRate, <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb83-57"><a href="individual-parameter-analyses.html#cb83-57" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&#39;% exceedance rate in 90 day window | Impaired: &#39;</span>, nSTVhitsInWindow,<span class="st">&#39; hits in the same 90-day period&#39;</span>,<span class="at">sep=</span><span class="st">&#39;&#39;</span>) }</span>
<span id="cb83-58"><a href="individual-parameter-analyses.html#cb83-58" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-59"><a href="individual-parameter-analyses.html#cb83-59" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-60"><a href="individual-parameter-analyses.html#cb83-60" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Second level of testing: only if minimum geomean sampling requirements met in 90 day period</span></span>
<span id="cb83-61"><a href="individual-parameter-analyses.html#cb83-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">unique</span>(windowData<span class="sc">$</span>nSamples) <span class="sc">&gt;=</span> sampleRequirement){</span>
<span id="cb83-62"><a href="individual-parameter-analyses.html#cb83-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Geomean Hit</span></span>
<span id="cb83-63"><a href="individual-parameter-analyses.html#cb83-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">unique</span>(windowData<span class="sc">$</span>geomeanCriteriaHit) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb83-64"><a href="individual-parameter-analyses.html#cb83-64" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Geomean Assessment</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&#39;Geomean: &#39;</span>, <span class="fu">format</span>(<span class="fu">unique</span>(windowData<span class="sc">$</span>geomean), <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb83-65"><a href="individual-parameter-analyses.html#cb83-65" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39; | Impaired: geomean exceeds criteria in the 90-day period&#39;</span>, <span class="at">sep=</span><span class="st">&#39;&#39;</span>)  </span>
<span id="cb83-66"><a href="individual-parameter-analyses.html#cb83-66" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb83-67"><a href="individual-parameter-analyses.html#cb83-67" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Geomean Assessment</span><span class="st">`</span> <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="st">&#39;Geomean: &#39;</span>, <span class="fu">format</span>(<span class="fu">unique</span>(windowData<span class="sc">$</span>geomean), <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb83-68"><a href="individual-parameter-analyses.html#cb83-68" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39; | Geomean criteria met, hold assessment decision for further testing&#39;</span>, <span class="at">sep=</span> <span class="st">&#39;&#39;</span>)} </span>
<span id="cb83-69"><a href="individual-parameter-analyses.html#cb83-69" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { <span class="co"># minimum geomean sampling requirements NOT met in 90 day period</span></span>
<span id="cb83-70"><a href="individual-parameter-analyses.html#cb83-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Geomean Assessment</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="st">&#39;Insufficient Information: geomean sampling criteria not met&#39;</span>  }</span>
<span id="cb83-71"><a href="individual-parameter-analyses.html#cb83-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-72"><a href="individual-parameter-analyses.html#cb83-72" aria-hidden="true" tabindex="-1"></a>      out[i,] <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="st">`</span><span class="at">StationID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">unique</span>(stationData2<span class="sc">$</span>FDT_STA_ID),</span>
<span id="cb83-73"><a href="individual-parameter-analyses.html#cb83-73" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">Date Window Starts</span><span class="st">`</span> <span class="ot">=</span> time1, </span>
<span id="cb83-74"><a href="individual-parameter-analyses.html#cb83-74" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">Date Window Ends</span><span class="st">`</span> <span class="ot">=</span> timePlus89, </span>
<span id="cb83-75"><a href="individual-parameter-analyses.html#cb83-75" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">Last Sample Date in Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">max</span>(windowData<span class="sc">$</span>FDT_DATE_TIME),</span>
<span id="cb83-76"><a href="individual-parameter-analyses.html#cb83-76" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">Samples in 90 Day Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">unique</span>(windowData<span class="sc">$</span>nSamples), </span>
<span id="cb83-77"><a href="individual-parameter-analyses.html#cb83-77" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">STV Exceedances In Window</span><span class="st">`</span> <span class="ot">=</span> nSTVhitsInWindow, </span>
<span id="cb83-78"><a href="individual-parameter-analyses.html#cb83-78" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">STV Exceedance Rate</span><span class="st">`</span> <span class="ot">=</span> STVexceedanceRate,</span>
<span id="cb83-79"><a href="individual-parameter-analyses.html#cb83-79" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">STV Assessment</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">STV Assessment</span><span class="st">`</span>,</span>
<span id="cb83-80"><a href="individual-parameter-analyses.html#cb83-80" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unique</span>(windowData<span class="sc">$</span>nSamples) <span class="sc">&gt;=</span> sampleRequirement, <span class="fu">unique</span>(windowData<span class="sc">$</span>geomean), <span class="cn">NA</span>), <span class="co"># avoid excitement, only give geomean result if 10+ samples</span></span>
<span id="cb83-81"><a href="individual-parameter-analyses.html#cb83-81" aria-hidden="true" tabindex="-1"></a>                         <span class="st">`</span><span class="at">Geomean Assessment</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Geomean Assessment</span><span class="st">`</span>,</span>
<span id="cb83-82"><a href="individual-parameter-analyses.html#cb83-82" aria-hidden="true" tabindex="-1"></a>                         <span class="at">associatedData =</span> <span class="fu">list</span>(windowData)) </span>
<span id="cb83-83"><a href="individual-parameter-analyses.html#cb83-83" aria-hidden="true" tabindex="-1"></a>    } <span class="co">#end for loop</span></span>
<span id="cb83-84"><a href="individual-parameter-analyses.html#cb83-84" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb83-85"><a href="individual-parameter-analyses.html#cb83-85" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">`</span><span class="at">StationID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>FDT_STA_ID),</span>
<span id="cb83-86"><a href="individual-parameter-analyses.html#cb83-86" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Date Window Starts</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="cn">NA</span>), </span>
<span id="cb83-87"><a href="individual-parameter-analyses.html#cb83-87" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Date Window Ends</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="cn">NA</span>), </span>
<span id="cb83-88"><a href="individual-parameter-analyses.html#cb83-88" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Last Sample Date in Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="cn">NA</span>), </span>
<span id="cb83-89"><a href="individual-parameter-analyses.html#cb83-89" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Samples in 90 Day Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), </span>
<span id="cb83-90"><a href="individual-parameter-analyses.html#cb83-90" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">STV Exceedances In Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), </span>
<span id="cb83-91"><a href="individual-parameter-analyses.html#cb83-91" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">STV Exceedance Rate</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), </span>
<span id="cb83-92"><a href="individual-parameter-analyses.html#cb83-92" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">STV Assessment</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb83-93"><a href="individual-parameter-analyses.html#cb83-93" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb83-94"><a href="individual-parameter-analyses.html#cb83-94" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Geomean Assessment</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb83-95"><a href="individual-parameter-analyses.html#cb83-95" aria-hidden="true" tabindex="-1"></a>                  <span class="at">associatedData =</span> <span class="fu">list</span>(<span class="cn">NA</span>))</span>
<span id="cb83-96"><a href="individual-parameter-analyses.html#cb83-96" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-97"><a href="individual-parameter-analyses.html#cb83-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-98"><a href="individual-parameter-analyses.html#cb83-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For IR2024, we only want to make assessment decisions on data windows with unique datasets. Running distinct() on `Last Sample Date in Window`</span></span>
<span id="cb83-99"><a href="individual-parameter-analyses.html#cb83-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># will keep only the rows with the first occurrence of any given sample date, allowing us to remove rolled windows that contain duplicated </span></span>
<span id="cb83-100"><a href="individual-parameter-analyses.html#cb83-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># datasets. Joining this result back to the out dataset allows us to flag `Valid Assessment Window` appropriately. Since this function</span></span>
<span id="cb83-101"><a href="individual-parameter-analyses.html#cb83-101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># feeds the app, we want to keep all records and only at later functions that make assessment decisions do we want to filter out </span></span>
<span id="cb83-102"><a href="individual-parameter-analyses.html#cb83-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># non-unique windows.</span></span>
<span id="cb83-103"><a href="individual-parameter-analyses.html#cb83-103" aria-hidden="true" tabindex="-1"></a>  distinctWindows <span class="ot">&lt;-</span> <span class="fu">distinct</span>(out, <span class="st">`</span><span class="at">Last Sample Date in Window</span><span class="st">`</span>, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb83-104"><a href="individual-parameter-analyses.html#cb83-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Valid Assessment Window</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-105"><a href="individual-parameter-analyses.html#cb83-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-106"><a href="individual-parameter-analyses.html#cb83-106" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">left_join</span>(out, distinctWindows,</span>
<span id="cb83-107"><a href="individual-parameter-analyses.html#cb83-107" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;StationID&quot;</span>, <span class="st">&quot;Date Window Starts&quot;</span>, <span class="st">&quot;Date Window Ends&quot;</span>, <span class="st">&quot;Last Sample Date in Window&quot;</span>, </span>
<span id="cb83-108"><a href="individual-parameter-analyses.html#cb83-108" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Samples in 90 Day Window&quot;</span>, <span class="st">&quot;STV Exceedances In Window&quot;</span>, <span class="st">&quot;STV Exceedance Rate&quot;</span>, </span>
<span id="cb83-109"><a href="individual-parameter-analyses.html#cb83-109" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;STV Assessment&quot;</span>, <span class="st">&quot;Geomean In Window&quot;</span>, <span class="st">&quot;Geomean Assessment&quot;</span>, <span class="st">&quot;associatedData&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># join by everything to be safe</span></span>
<span id="cb83-110"><a href="individual-parameter-analyses.html#cb83-110" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(StationID<span class="sc">:</span><span class="st">`</span><span class="at">Last Sample Date in Window</span><span class="st">`</span>, <span class="st">`</span><span class="at">Valid Assessment Window</span><span class="st">`</span>, <span class="fu">everything</span>())</span>
<span id="cb83-111"><a href="individual-parameter-analyses.html#cb83-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-112"><a href="individual-parameter-analyses.html#cb83-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out) </span>
<span id="cb83-113"><a href="individual-parameter-analyses.html#cb83-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-114"><a href="individual-parameter-analyses.html#cb83-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-115"><a href="individual-parameter-analyses.html#cb83-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb83-116"><a href="individual-parameter-analyses.html#cb83-116" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb83-117"><a href="individual-parameter-analyses.html#cb83-117" aria-hidden="true" tabindex="-1"></a><span class="co">#bacteriaExceedances_NEW(stationData, &#39;ECOLI&#39;, &#39;LEVEL_ECOLI&#39;, 10, 410, 126)</span></span>
<span id="cb83-118"><a href="individual-parameter-analyses.html#cb83-118" aria-hidden="true" tabindex="-1"></a><span class="co">#bacteriaExceedances_NEW(stationData, &#39;ENTEROCOCCI&#39;, &#39;LEVEL_ENTEROCOCCI&#39;, 10, 130, 35) </span></span>
<span id="cb83-119"><a href="individual-parameter-analyses.html#cb83-119" aria-hidden="true" tabindex="-1"></a><span class="co"># How to unpack raw data from inside each unqiue 90 day window</span></span>
<span id="cb83-120"><a href="individual-parameter-analyses.html#cb83-120" aria-hidden="true" tabindex="-1"></a><span class="co"># y &lt;- bacteriaExceedances_NEW(stationData, &#39;ECOLI&#39;, &#39;LEVEL_ECOLI&#39;, 10, 410, 126)</span></span>
<span id="cb83-121"><a href="individual-parameter-analyses.html#cb83-121" aria-hidden="true" tabindex="-1"></a><span class="co"># View(y) # look at this data structure</span></span>
<span id="cb83-122"><a href="individual-parameter-analyses.html#cb83-122" aria-hidden="true" tabindex="-1"></a><span class="co"># y$associatedData[1] # look at first 90 day window associated data</span></span></code></pre></div>
</div>
<div id="bacteriaassessmentdecision" class="section level4" number="3.5.5.2">
<h4><span class="header-section-number">3.5.5.2</span> bacteriaAssessmentDecision</h4>
<p>The <code>bacteriaAssessmentDecision()</code> function is the workhorse of the bacteria assessment logic, summarizing bacteria assessment results into decisions. This function passes through the provided arguments to the <code>bacteriaExceedances_NEW()</code> function to perform the bacteria criteria analysis. The function is applied inside the <code>bacteriaAssessmentDecisionClass()</code> function to summarize and report out the results of the <code>bacteriaExceedances_NEW()</code> analysis. To ease later data visualization steps, a listcolumn named <code>associatedDecisionData</code> is included in the function output that the user can unpack to see all data associated with each 90 day window.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="individual-parameter-analyses.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to summarize bacteria assessment results into decisions</span></span>
<span id="cb84-2"><a href="individual-parameter-analyses.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This function returns all potential issues with priory on geomean results IF there</span></span>
<span id="cb84-3"><a href="individual-parameter-analyses.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># are enough samples to run geomean</span></span>
<span id="cb84-4"><a href="individual-parameter-analyses.html#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Round to even rules are applied</span></span>
<span id="cb84-5"><a href="individual-parameter-analyses.html#cb84-5" aria-hidden="true" tabindex="-1"></a>bacteriaAssessmentDecision <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData, <span class="co"># input dataframe with bacteria data</span></span>
<span id="cb84-6"><a href="individual-parameter-analyses.html#cb84-6" aria-hidden="true" tabindex="-1"></a>                                       bacteriaField, <span class="co"># name of bacteria field data</span></span>
<span id="cb84-7"><a href="individual-parameter-analyses.html#cb84-7" aria-hidden="true" tabindex="-1"></a>                                       bacteriaRemark, <span class="co"># name of bacteria comment field</span></span>
<span id="cb84-8"><a href="individual-parameter-analyses.html#cb84-8" aria-hidden="true" tabindex="-1"></a>                                       sampleRequirement, <span class="co"># minimum n samples in 90 day window needed to apply geomean</span></span>
<span id="cb84-9"><a href="individual-parameter-analyses.html#cb84-9" aria-hidden="true" tabindex="-1"></a>                                       STV, <span class="co"># unique for ecoli/enter</span></span>
<span id="cb84-10"><a href="individual-parameter-analyses.html#cb84-10" aria-hidden="true" tabindex="-1"></a>                                       geomeanCriteria <span class="co"># unique for ecoli/enter</span></span>
<span id="cb84-11"><a href="individual-parameter-analyses.html#cb84-11" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb84-12"><a href="individual-parameter-analyses.html#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename output columns based on station table template</span></span>
<span id="cb84-13"><a href="individual-parameter-analyses.html#cb84-13" aria-hidden="true" tabindex="-1"></a>    stationTableName <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(bacteriaField <span class="sc">==</span> <span class="st">&#39;ECOLI&#39;</span>, <span class="st">&quot;ECOLI&quot;</span>, <span class="st">&quot;ENTER&quot;</span>)</span>
<span id="cb84-14"><a href="individual-parameter-analyses.html#cb84-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-15"><a href="individual-parameter-analyses.html#cb84-15" aria-hidden="true" tabindex="-1"></a>    nSamples <span class="ot">&lt;-</span> <span class="fu">select</span>(stationData,  <span class="at">Value =</span> {{ bacteriaField }} ) <span class="sc">%&gt;%</span> </span>
<span id="cb84-16"><a href="individual-parameter-analyses.html#cb84-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Value)) <span class="co"># total n samples taken in assessment window</span></span>
<span id="cb84-17"><a href="individual-parameter-analyses.html#cb84-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-18"><a href="individual-parameter-analyses.html#cb84-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-19"><a href="individual-parameter-analyses.html#cb84-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(nSamples) <span class="sc">&gt;</span> <span class="dv">0</span>){ <span class="co"># only proceed through decisions if there is data to be analyzed</span></span>
<span id="cb84-20"><a href="individual-parameter-analyses.html#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="individual-parameter-analyses.html#cb84-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run assessment function</span></span>
<span id="cb84-22"><a href="individual-parameter-analyses.html#cb84-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make two objects here because we want to base all decisions only on valid data, but we also want to output all associated data from </span></span>
<span id="cb84-23"><a href="individual-parameter-analyses.html#cb84-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># this function, so we create a rawAnalysisForOutput to be saved in a list column for unpacking later</span></span>
<span id="cb84-24"><a href="individual-parameter-analyses.html#cb84-24" aria-hidden="true" tabindex="-1"></a>    rawAnalysisForOutput <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">bacteriaExceedances_NEW</span>(stationData, bacteriaField, bacteriaRemark, sampleRequirement, STV, geomeanCriteria)   )</span>
<span id="cb84-25"><a href="individual-parameter-analyses.html#cb84-25" aria-hidden="true" tabindex="-1"></a>    validForAssessment <span class="ot">&lt;-</span> rawAnalysisForOutput <span class="sc">%&gt;%</span> </span>
<span id="cb84-26"><a href="individual-parameter-analyses.html#cb84-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="st">`</span><span class="at">Valid Assessment Window</span><span class="st">`</span> <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-27"><a href="individual-parameter-analyses.html#cb84-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-28"><a href="individual-parameter-analyses.html#cb84-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bail out if no data to analyze bc all Level II or Level I, OR (new for IR2024) no valid windows for assessment</span></span>
<span id="cb84-29"><a href="individual-parameter-analyses.html#cb84-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(<span class="fu">filter</span>(validForAssessment, <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Date Window Starts</span><span class="st">`</span>))) <span class="sc">==</span> <span class="dv">0</span> ){</span>
<span id="cb84-30"><a href="individual-parameter-analyses.html#cb84-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>FDT_STA_ID),</span>
<span id="cb84-31"><a href="individual-parameter-analyses.html#cb84-31" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-32"><a href="individual-parameter-analyses.html#cb84-32" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#`_IMPAIREDWINDOWS` = NA,</span></span>
<span id="cb84-33"><a href="individual-parameter-analyses.html#cb84-33" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>, </span>
<span id="cb84-34"><a href="individual-parameter-analyses.html#cb84-34" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb84-35"><a href="individual-parameter-analyses.html#cb84-35" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb84-36"><a href="individual-parameter-analyses.html#cb84-36" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="co"># is this the right code???</span></span>
<span id="cb84-37"><a href="individual-parameter-analyses.html#cb84-37" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>, </span>
<span id="cb84-38"><a href="individual-parameter-analyses.html#cb84-38" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb84-39"><a href="individual-parameter-analyses.html#cb84-39" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb84-40"><a href="individual-parameter-analyses.html#cb84-40" aria-hidden="true" tabindex="-1"></a>                    <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(<span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb84-41"><a href="individual-parameter-analyses.html#cb84-41" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-42"><a href="individual-parameter-analyses.html#cb84-42" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-43"><a href="individual-parameter-analyses.html#cb84-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-44"><a href="individual-parameter-analyses.html#cb84-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-45"><a href="individual-parameter-analyses.html#cb84-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># number of STV exceedances, reported in bacteria_EXC field in stations table and useful for logic testing</span></span>
<span id="cb84-46"><a href="individual-parameter-analyses.html#cb84-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># don&#39;t want to do this analysis on validForAssessment bc sum(validForAssessment$`STV Exceedances In Window`) will overshoot real n</span></span>
<span id="cb84-47"><a href="individual-parameter-analyses.html#cb84-47" aria-hidden="true" tabindex="-1"></a>    exceedSTVn <span class="ot">&lt;-</span> <span class="fu">select</span>(stationData,  <span class="at">Value =</span> {{ bacteriaField }} ) <span class="sc">%&gt;%</span></span>
<span id="cb84-48"><a href="individual-parameter-analyses.html#cb84-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(Value <span class="sc">&gt;</span> STV) <span class="co"># total STV exceedances in dataset</span></span>
<span id="cb84-49"><a href="individual-parameter-analyses.html#cb84-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Windows with &gt; 10% STV rate, these can only be calculated on windows with 10 or more samples</span></span>
<span id="cb84-50"><a href="individual-parameter-analyses.html#cb84-50" aria-hidden="true" tabindex="-1"></a>    exceedSTVrate <span class="ot">&lt;-</span> <span class="fu">filter</span>(validForAssessment, <span class="st">`</span><span class="at">STV Exceedance Rate</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">10</span>)</span>
<span id="cb84-51"><a href="individual-parameter-analyses.html#cb84-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># windows with geomean exceedances, these can only be calculated on windows with 10 or more samples</span></span>
<span id="cb84-52"><a href="individual-parameter-analyses.html#cb84-52" aria-hidden="true" tabindex="-1"></a>    exceedGeomean <span class="ot">&lt;-</span> <span class="fu">filter</span>(validForAssessment, <span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span> <span class="sc">&gt;</span> geomeanCriteria)</span>
<span id="cb84-53"><a href="individual-parameter-analyses.html#cb84-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-54"><a href="individual-parameter-analyses.html#cb84-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decision logic time, work through geomean first and if there is no appropriate geomean data (no windows with 10+ samples)</span></span>
<span id="cb84-55"><a href="individual-parameter-analyses.html#cb84-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   then go to STV assessment</span></span>
<span id="cb84-56"><a href="individual-parameter-analyses.html#cb84-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-57"><a href="individual-parameter-analyses.html#cb84-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Were at least 10 samples taken within any 90-day period of the assessment window?</span></span>
<span id="cb84-58"><a href="individual-parameter-analyses.html#cb84-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( <span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(validForAssessment<span class="sc">$</span><span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span>)) ){ <span class="co"># Were at least 10 samples taken within any 90-day period of the assessment window? - Yes</span></span>
<span id="cb84-59"><a href="individual-parameter-analyses.html#cb84-59" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Do the geometric means calculated for the 90-day periods represented by 10+ samples meet the GM criterion?</span></span>
<span id="cb84-60"><a href="individual-parameter-analyses.html#cb84-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>( <span class="fu">nrow</span>(exceedGeomean) <span class="sc">==</span> <span class="dv">0</span>){ <span class="co"># Do the geometric means calculated for the 90-day periods represented by 10+ samples meet the GM criterion? - Yes</span></span>
<span id="cb84-61"><a href="individual-parameter-analyses.html#cb84-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Do any of the 90-day periods of the assessment window represented in the dataset exceed the 10% STV Exceedance Rate?</span></span>
<span id="cb84-62"><a href="individual-parameter-analyses.html#cb84-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>( <span class="fu">nrow</span>(exceedSTVn) <span class="sc">&gt;</span> <span class="dv">0</span>){ <span class="co"># Do any of the 90-day periods of the assessment window represented in the dataset exceed the 10% STV Exceedance Rate? - Yes</span></span>
<span id="cb84-63"><a href="individual-parameter-analyses.html#cb84-63" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb84-64"><a href="individual-parameter-analyses.html#cb84-64" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Yes, in a 90-day period represented by 10+ samples</span></span>
<span id="cb84-65"><a href="individual-parameter-analyses.html#cb84-65" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">nrow</span>(<span class="fu">filter</span>(exceedSTVrate, <span class="st">`</span><span class="at">Samples in 90 Day Window</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">STV Exceedance Rate</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">10</span>)) <span class="sc">&gt;</span> <span class="dv">0</span>){ <span class="co"># STV exceedances in a 90-day period represented by &gt;= 10 samples</span></span>
<span id="cb84-66"><a href="individual-parameter-analyses.html#cb84-66" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-67"><a href="individual-parameter-analyses.html#cb84-67" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-68"><a href="individual-parameter-analyses.html#cb84-68" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-69"><a href="individual-parameter-analyses.html#cb84-69" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedGeomean),</span>
<span id="cb84-70"><a href="individual-parameter-analyses.html#cb84-70" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(<span class="fu">filter</span>(validForAssessment, <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span>))),</span>
<span id="cb84-71"><a href="individual-parameter-analyses.html#cb84-71" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;IM&quot;</span>,</span>
<span id="cb84-72"><a href="individual-parameter-analyses.html#cb84-72" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Impaired - 2 or more STV exceedances in the same 90-day period represented by 10+ samples, no geomean exceedances.&quot;</span>,<span class="co">#STV exceedances in a 90-day period represented by &gt;= 10 samples after verifying geomean passes where applicable.&quot;,</span></span>
<span id="cb84-73"><a href="individual-parameter-analyses.html#cb84-73" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-74"><a href="individual-parameter-analyses.html#cb84-74" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-75"><a href="individual-parameter-analyses.html#cb84-75" aria-hidden="true" tabindex="-1"></a>                          <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-76"><a href="individual-parameter-analyses.html#cb84-76" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-77"><a href="individual-parameter-analyses.html#cb84-77" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-78"><a href="individual-parameter-analyses.html#cb84-78" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb84-79"><a href="individual-parameter-analyses.html#cb84-79" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {  <span class="co"># STV exceedances in a 90-day period represented by &lt; 10 samples</span></span>
<span id="cb84-80"><a href="individual-parameter-analyses.html#cb84-80" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb84-81"><a href="individual-parameter-analyses.html#cb84-81" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 2 or more hits in the same 90-day period?</span></span>
<span id="cb84-82"><a href="individual-parameter-analyses.html#cb84-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">any</span>(validForAssessment<span class="sc">$</span><span class="st">`</span><span class="at">STV Exceedances In Window</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">2</span>) ){</span>
<span id="cb84-83"><a href="individual-parameter-analyses.html#cb84-83" aria-hidden="true" tabindex="-1"></a>              <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-84"><a href="individual-parameter-analyses.html#cb84-84" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-85"><a href="individual-parameter-analyses.html#cb84-85" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-86"><a href="individual-parameter-analyses.html#cb84-86" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedGeomean),</span>
<span id="cb84-87"><a href="individual-parameter-analyses.html#cb84-87" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(<span class="fu">filter</span>(validForAssessment, <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span>))),</span>
<span id="cb84-88"><a href="individual-parameter-analyses.html#cb84-88" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;IM&quot;</span>,</span>
<span id="cb84-89"><a href="individual-parameter-analyses.html#cb84-89" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Impaired- 2 or more STV exceedances in the same 90-day period with &lt; 10 samples, no geomean exceedances.&quot;</span>, <span class="co">#2 or more STV hits in the same 90-day period with &lt; 10 samples after verifying geomean passes where applicable.&quot;,</span></span>
<span id="cb84-90"><a href="individual-parameter-analyses.html#cb84-90" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-91"><a href="individual-parameter-analyses.html#cb84-91" aria-hidden="true" tabindex="-1"></a>                            <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-92"><a href="individual-parameter-analyses.html#cb84-92" aria-hidden="true" tabindex="-1"></a>                            <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-93"><a href="individual-parameter-analyses.html#cb84-93" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-94"><a href="individual-parameter-analyses.html#cb84-94" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-95"><a href="individual-parameter-analyses.html#cb84-95" aria-hidden="true" tabindex="-1"></a>              } <span class="cf">else</span> { </span>
<span id="cb84-96"><a href="individual-parameter-analyses.html#cb84-96" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb84-97"><a href="individual-parameter-analyses.html#cb84-97" aria-hidden="true" tabindex="-1"></a>                <span class="co"># did the STV exceedance(s) occur in windows with 10+ samples?</span></span>
<span id="cb84-98"><a href="individual-parameter-analyses.html#cb84-98" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span>(<span class="fu">all</span>(<span class="fu">filter</span>(validForAssessment, <span class="st">`</span><span class="at">STV Exceedances In Window</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>)<span class="sc">$</span><span class="st">`</span><span class="at">Samples in 90 Day Window</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">10</span>)){</span>
<span id="cb84-99"><a href="individual-parameter-analyses.html#cb84-99" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-100"><a href="individual-parameter-analyses.html#cb84-100" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-101"><a href="individual-parameter-analyses.html#cb84-101" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-102"><a href="individual-parameter-analyses.html#cb84-102" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedGeomean),</span>
<span id="cb84-103"><a href="individual-parameter-analyses.html#cb84-103" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(<span class="fu">filter</span>(validForAssessment, <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span>))),</span>
<span id="cb84-104"><a href="individual-parameter-analyses.html#cb84-104" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;S&quot;</span>,</span>
<span id="cb84-105"><a href="individual-parameter-analyses.html#cb84-105" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Fully Supporting - No STV exceedance rates &gt;10% or geomean exceedances in any 90-day period represented by 10+ samples.&quot;</span>,<span class="co"># No geomean exceedances and STV exceedance(s) in one or multiple 90-day periods represented by 10+ samples.&quot;, # previous language: 1 STV hit in one or multiple 90-day periods with &lt; 10 samples after verifying geomean passes where applicable.&quot;,</span></span>
<span id="cb84-106"><a href="individual-parameter-analyses.html#cb84-106" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-107"><a href="individual-parameter-analyses.html#cb84-107" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-108"><a href="individual-parameter-analyses.html#cb84-108" aria-hidden="true" tabindex="-1"></a>                                <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-109"><a href="individual-parameter-analyses.html#cb84-109" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-110"><a href="individual-parameter-analyses.html#cb84-110" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-111"><a href="individual-parameter-analyses.html#cb84-111" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb84-112"><a href="individual-parameter-analyses.html#cb84-112" aria-hidden="true" tabindex="-1"></a>                } <span class="cf">else</span> {<span class="co"># STV exceedance(s) occured in windows with &lt; 10 samples</span></span>
<span id="cb84-113"><a href="individual-parameter-analyses.html#cb84-113" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb84-114"><a href="individual-parameter-analyses.html#cb84-114" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 1 hit in one or multiple 90-day periods after verifying geomean passes where applicable</span></span>
<span id="cb84-115"><a href="individual-parameter-analyses.html#cb84-115" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-116"><a href="individual-parameter-analyses.html#cb84-116" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-117"><a href="individual-parameter-analyses.html#cb84-117" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-118"><a href="individual-parameter-analyses.html#cb84-118" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedGeomean),</span>
<span id="cb84-119"><a href="individual-parameter-analyses.html#cb84-119" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(<span class="fu">filter</span>(validForAssessment, <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span>))),</span>
<span id="cb84-120"><a href="individual-parameter-analyses.html#cb84-120" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;O&quot;</span>,</span>
<span id="cb84-121"><a href="individual-parameter-analyses.html#cb84-121" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Fully Supporting - No geomean exceedances and only 1 STV exceedance in one or multiple 90-day periods represented by &lt; 10 samples.&quot;</span>, <span class="co"># previous language: 1 STV hit in one or multiple 90-day periods with &lt; 10 samples after verifying geomean passes where applicable.&quot;,</span></span>
<span id="cb84-122"><a href="individual-parameter-analyses.html#cb84-122" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-123"><a href="individual-parameter-analyses.html#cb84-123" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-124"><a href="individual-parameter-analyses.html#cb84-124" aria-hidden="true" tabindex="-1"></a>                              <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-125"><a href="individual-parameter-analyses.html#cb84-125" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-126"><a href="individual-parameter-analyses.html#cb84-126" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-127"><a href="individual-parameter-analyses.html#cb84-127" aria-hidden="true" tabindex="-1"></a>                } </span>
<span id="cb84-128"><a href="individual-parameter-analyses.html#cb84-128" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb84-129"><a href="individual-parameter-analyses.html#cb84-129" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb84-130"><a href="individual-parameter-analyses.html#cb84-130" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb84-131"><a href="individual-parameter-analyses.html#cb84-131" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {  <span class="co"># Do any of the 90-day periods of the assessment window represented in the dataset exceed the 10% STV Exceedance Rate? - No</span></span>
<span id="cb84-132"><a href="individual-parameter-analyses.html#cb84-132" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-133"><a href="individual-parameter-analyses.html#cb84-133" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-134"><a href="individual-parameter-analyses.html#cb84-134" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-135"><a href="individual-parameter-analyses.html#cb84-135" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedGeomean),</span>
<span id="cb84-136"><a href="individual-parameter-analyses.html#cb84-136" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(<span class="fu">filter</span>(validForAssessment, <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span>))),</span>
<span id="cb84-137"><a href="individual-parameter-analyses.html#cb84-137" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;S&quot;</span>,</span>
<span id="cb84-138"><a href="individual-parameter-analyses.html#cb84-138" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Fully Supporting - No STV exceedance rates &gt;10% or geomean exceedances in any 90-day period represented by 10+ samples.&quot;</span>, <span class="co">#No STV exceedances or geomean exceedances in any 90-day period.&quot;,</span></span>
<span id="cb84-139"><a href="individual-parameter-analyses.html#cb84-139" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-140"><a href="individual-parameter-analyses.html#cb84-140" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-141"><a href="individual-parameter-analyses.html#cb84-141" aria-hidden="true" tabindex="-1"></a>                        <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-142"><a href="individual-parameter-analyses.html#cb84-142" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-143"><a href="individual-parameter-analyses.html#cb84-143" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-144"><a href="individual-parameter-analyses.html#cb84-144" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb84-145"><a href="individual-parameter-analyses.html#cb84-145" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-146"><a href="individual-parameter-analyses.html#cb84-146" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> { <span class="co"># Do the geometric means calculated for the 90-day periods represented by 10+ samples meet the GM criterion? - No</span></span>
<span id="cb84-147"><a href="individual-parameter-analyses.html#cb84-147" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-148"><a href="individual-parameter-analyses.html#cb84-148" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-149"><a href="individual-parameter-analyses.html#cb84-149" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-150"><a href="individual-parameter-analyses.html#cb84-150" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedGeomean),</span>
<span id="cb84-151"><a href="individual-parameter-analyses.html#cb84-151" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(<span class="fu">filter</span>(validForAssessment, <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Geomean In Window</span><span class="st">`</span>))),</span>
<span id="cb84-152"><a href="individual-parameter-analyses.html#cb84-152" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;IM&quot;</span>,</span>
<span id="cb84-153"><a href="individual-parameter-analyses.html#cb84-153" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Impaired- geomean exceedance in any 90-day period.&quot;</span>, <span class="co">#geomean exceedance(s) in any 90-day period with &gt;= 10 samples.&quot;,</span></span>
<span id="cb84-154"><a href="individual-parameter-analyses.html#cb84-154" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-155"><a href="individual-parameter-analyses.html#cb84-155" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-156"><a href="individual-parameter-analyses.html#cb84-156" aria-hidden="true" tabindex="-1"></a>                      <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-157"><a href="individual-parameter-analyses.html#cb84-157" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-158"><a href="individual-parameter-analyses.html#cb84-158" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-159"><a href="individual-parameter-analyses.html#cb84-159" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb84-160"><a href="individual-parameter-analyses.html#cb84-160" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb84-161"><a href="individual-parameter-analyses.html#cb84-161" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { <span class="co"># Were at least 10 samples taken within any 90-day period of the assessment window? - No</span></span>
<span id="cb84-162"><a href="individual-parameter-analyses.html#cb84-162" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Were there any hits of the STV during the dataset?</span></span>
<span id="cb84-163"><a href="individual-parameter-analyses.html#cb84-163" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>( <span class="fu">nrow</span>(exceedSTVn) <span class="sc">==</span> <span class="dv">0</span>){ <span class="co"># Were there any hits of the STV during the dataset? - No</span></span>
<span id="cb84-164"><a href="individual-parameter-analyses.html#cb84-164" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-165"><a href="individual-parameter-analyses.html#cb84-165" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-166"><a href="individual-parameter-analyses.html#cb84-166" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-167"><a href="individual-parameter-analyses.html#cb84-167" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="co">#nrow(exceedGeomean), # Data Entry manual updated to require NA instead of 0 if &lt; 10 samples per 90 day window</span></span>
<span id="cb84-168"><a href="individual-parameter-analyses.html#cb84-168" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="co">#nrow(filter(validForAssessment, !is.na(`Geomean In Window`))), # Data Entry manual updated to require NA instead of 0 if &lt; 10 samples per 90 day window</span></span>
<span id="cb84-169"><a href="individual-parameter-analyses.html#cb84-169" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;IN&quot;</span>, </span>
<span id="cb84-170"><a href="individual-parameter-analyses.html#cb84-170" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Insufficient Information (Prioritize for follow up monitoring)- No STV exceedances but insufficient data to analyze geomean.&quot;</span>, <span class="co">#0 STV hits but insufficient data to analyze geomean.&quot;,</span></span>
<span id="cb84-171"><a href="individual-parameter-analyses.html#cb84-171" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-172"><a href="individual-parameter-analyses.html#cb84-172" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-173"><a href="individual-parameter-analyses.html#cb84-173" aria-hidden="true" tabindex="-1"></a>                      <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-174"><a href="individual-parameter-analyses.html#cb84-174" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>))<span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-175"><a href="individual-parameter-analyses.html#cb84-175" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-176"><a href="individual-parameter-analyses.html#cb84-176" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> { <span class="co"># Were there any hits of the STV during the dataset? - Yes</span></span>
<span id="cb84-177"><a href="individual-parameter-analyses.html#cb84-177" aria-hidden="true" tabindex="-1"></a>          <span class="co"># 2 or more hits in the same 90-day period</span></span>
<span id="cb84-178"><a href="individual-parameter-analyses.html#cb84-178" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">any</span>(validForAssessment<span class="sc">$</span><span class="st">`</span><span class="at">STV Exceedances In Window</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">2</span>) ){</span>
<span id="cb84-179"><a href="individual-parameter-analyses.html#cb84-179" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-180"><a href="individual-parameter-analyses.html#cb84-180" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># not quite right yet</span></span>
<span id="cb84-181"><a href="individual-parameter-analyses.html#cb84-181" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the number of STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-182"><a href="individual-parameter-analyses.html#cb84-182" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-183"><a href="individual-parameter-analyses.html#cb84-183" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="co">#nrow(exceedGeomean), # Data Entry manual updated to require NA instead of 0 if &lt; 10 samples per 90 day window</span></span>
<span id="cb84-184"><a href="individual-parameter-analyses.html#cb84-184" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="co">#nrow(filter(validForAssessment, !is.na(`Geomean In Window`))), # Data Entry manual updated to require NA instead of 0 if &lt; 10 samples per 90 day window</span></span>
<span id="cb84-185"><a href="individual-parameter-analyses.html#cb84-185" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;IM&quot;</span>, </span>
<span id="cb84-186"><a href="individual-parameter-analyses.html#cb84-186" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Impaired - 2 or more STV hits in the same 90-day period with &lt; 10 samples.&quot;</span>,</span>
<span id="cb84-187"><a href="individual-parameter-analyses.html#cb84-187" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-188"><a href="individual-parameter-analyses.html#cb84-188" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-189"><a href="individual-parameter-analyses.html#cb84-189" aria-hidden="true" tabindex="-1"></a>                          <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-190"><a href="individual-parameter-analyses.html#cb84-190" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>))<span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-191"><a href="individual-parameter-analyses.html#cb84-191" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-192"><a href="individual-parameter-analyses.html#cb84-192" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> { </span>
<span id="cb84-193"><a href="individual-parameter-analyses.html#cb84-193" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 1 hit in one or multiple 90-day periods</span></span>
<span id="cb84-194"><a href="individual-parameter-analyses.html#cb84-194" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(validForAssessment<span class="sc">$</span>StationID),</span>
<span id="cb84-195"><a href="individual-parameter-analyses.html#cb84-195" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(exceedSTVn), <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-196"><a href="individual-parameter-analyses.html#cb84-196" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">nrow</span>(nSamples), </span>
<span id="cb84-197"><a href="individual-parameter-analyses.html#cb84-197" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="co">#nrow(exceedGeomean), # Data Entry manual updated to require NA instead of 0 if &lt; 10 samples per 90 day window</span></span>
<span id="cb84-198"><a href="individual-parameter-analyses.html#cb84-198" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="co">#nrow(filter(validForAssessment, !is.na(`Geomean In Window`))), # Data Entry manual updated to require NA instead of 0 if &lt; 10 samples per 90 day window</span></span>
<span id="cb84-199"><a href="individual-parameter-analyses.html#cb84-199" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;IN&quot;</span>,</span>
<span id="cb84-200"><a href="individual-parameter-analyses.html#cb84-200" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Insufficient Information (Prioritize for follow up monitoring)- One STV exceedance in one or multiple 90-day periods but insufficient data to analyze geomean.&quot;</span>,<span class="co">#1 STV hit in one or multiple 90-day periods but insufficient data to analyze geomean.&quot;,</span></span>
<span id="cb84-201"><a href="individual-parameter-analyses.html#cb84-201" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: &quot;</span>,<span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span>),</span>
<span id="cb84-202"><a href="individual-parameter-analyses.html#cb84-202" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste0</span>(stationTableName, <span class="st">&quot;: Number of 90 day windows with &gt; 10% STV exceedance rate: &quot;</span>, <span class="fu">nrow</span>(exceedSTVrate)),</span>
<span id="cb84-203"><a href="individual-parameter-analyses.html#cb84-203" aria-hidden="true" tabindex="-1"></a>                          <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(rawAnalysisForOutput) ) <span class="sc">%&gt;%</span></span>
<span id="cb84-204"><a href="individual-parameter-analyses.html#cb84-204" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-205"><a href="individual-parameter-analyses.html#cb84-205" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-206"><a href="individual-parameter-analyses.html#cb84-206" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb84-207"><a href="individual-parameter-analyses.html#cb84-207" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb84-208"><a href="individual-parameter-analyses.html#cb84-208" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb84-209"><a href="individual-parameter-analyses.html#cb84-209" aria-hidden="true" tabindex="-1"></a>    <span class="co"># No bacteria data to analyze</span></span>
<span id="cb84-210"><a href="individual-parameter-analyses.html#cb84-210" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb84-211"><a href="individual-parameter-analyses.html#cb84-211" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>FDT_STA_ID),</span>
<span id="cb84-212"><a href="individual-parameter-analyses.html#cb84-212" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="co"># right now this is set to # total STV exceedances, not the # STV exceedances in a 90-day period with 10+ samples</span></span>
<span id="cb84-213"><a href="individual-parameter-analyses.html#cb84-213" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>, </span>
<span id="cb84-214"><a href="individual-parameter-analyses.html#cb84-214" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_GM.EXC</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb84-215"><a href="individual-parameter-analyses.html#cb84-215" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_GM.SAMP</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb84-216"><a href="individual-parameter-analyses.html#cb84-216" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_STAT</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="co"># is this the right code???</span></span>
<span id="cb84-217"><a href="individual-parameter-analyses.html#cb84-217" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">_STAT_VERBOSE</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>, </span>
<span id="cb84-218"><a href="individual-parameter-analyses.html#cb84-218" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">BACTERIADECISION</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb84-219"><a href="individual-parameter-analyses.html#cb84-219" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">BACTERIASTATS</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb84-220"><a href="individual-parameter-analyses.html#cb84-220" aria-hidden="true" tabindex="-1"></a>                    <span class="at">associatedDecisionData =</span> <span class="fu">list</span>(<span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb84-221"><a href="individual-parameter-analyses.html#cb84-221" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="fu">paste0</span>(stationTableName,<span class="st">&quot;_&quot;</span>), .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>  <span class="co"># fix names to match station table format</span></span>
<span id="cb84-222"><a href="individual-parameter-analyses.html#cb84-222" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename_with</span>( <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;_&quot;</span>, .x, <span class="at">fixed =</span> <span class="cn">TRUE</span>)) ) <span class="co"># special step to get around accidentally replacing _GM with station table name</span></span>
<span id="cb84-223"><a href="individual-parameter-analyses.html#cb84-223" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-224"><a href="individual-parameter-analyses.html#cb84-224" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-225"><a href="individual-parameter-analyses.html#cb84-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-226"><a href="individual-parameter-analyses.html#cb84-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb84-227"><a href="individual-parameter-analyses.html#cb84-227" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData object is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb84-228"><a href="individual-parameter-analyses.html#cb84-228" aria-hidden="true" tabindex="-1"></a><span class="co"># bacteriaAssessmentDecision(stationData, &#39;ECOLI&#39;, &#39;LEVEL_ECOLI&#39;, 10, 410, 126)</span></span>
<span id="cb84-229"><a href="individual-parameter-analyses.html#cb84-229" aria-hidden="true" tabindex="-1"></a><span class="co"># bacteriaAssessmentDecision(stationData, &#39;ENTEROCOCCI&#39;, &#39;LEVEL_ENTEROCOCCI&#39;, 10, 130, 35)</span></span>
<span id="cb84-230"><a href="individual-parameter-analyses.html#cb84-230" aria-hidden="true" tabindex="-1"></a><span class="co"># To get just info for station table  </span></span>
<span id="cb84-231"><a href="individual-parameter-analyses.html#cb84-231" aria-hidden="true" tabindex="-1"></a><span class="co">#bacteriaAssessmentDecision(stationData, &#39;ECOLI&#39;, &#39;LEVEL_ECOLI&#39;, 10, 410, 126) %&gt;%</span></span>
<span id="cb84-232"><a href="individual-parameter-analyses.html#cb84-232" aria-hidden="true" tabindex="-1"></a><span class="co">#  dplyr::select(StationID:ECOLI_STAT)</span></span>
<span id="cb84-233"><a href="individual-parameter-analyses.html#cb84-233" aria-hidden="true" tabindex="-1"></a><span class="co">#bacteriaAssessmentDecision(stationData, &#39;ENTEROCOCCI&#39;, &#39;LEVEL_ENTEROCOCCI&#39;, 10, 130, 35) %&gt;%</span></span>
<span id="cb84-234"><a href="individual-parameter-analyses.html#cb84-234" aria-hidden="true" tabindex="-1"></a><span class="co">#  dplyr::select(StationID:ENTER_STAT)</span></span>
<span id="cb84-235"><a href="individual-parameter-analyses.html#cb84-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-236"><a href="individual-parameter-analyses.html#cb84-236" aria-hidden="true" tabindex="-1"></a><span class="co"># How to unpack analyzed data from a single site</span></span>
<span id="cb84-237"><a href="individual-parameter-analyses.html#cb84-237" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- bacteriaAssessmentDecision(stationData, &#39;ENTEROCOCCI&#39;, &#39;LEVEL_ENTEROCOCCI&#39;, 10, 130, 35)</span></span>
<span id="cb84-238"><a href="individual-parameter-analyses.html#cb84-238" aria-hidden="true" tabindex="-1"></a><span class="co"># View(x) # look at this data structure</span></span>
<span id="cb84-239"><a href="individual-parameter-analyses.html#cb84-239" aria-hidden="true" tabindex="-1"></a><span class="co"># x$associatedDecisionData[1] # look at each 90 day window used to make the assessment decision</span></span></code></pre></div>
</div>
<div id="bacteriaassessmentdecisionclass" class="section level4" number="3.5.5.3">
<h4><span class="header-section-number">3.5.5.3</span> bacteriaAssessmentDecisionClass</h4>
<p>The <code>bacteriaAssessmentDecisionClass()</code> is the outermost function to assess bacteria data. The function takes in all data for a single station as well as a StationID (to provide adequate output information in case no bacteria data exist for said station). Based on the WQS class, <em>E.coli</em> is analyzed if the site is freshwater or <em>E.coli</em> and Enterococci are analyzed if the site is saltwater or transitional. It is up to the regional assessor to determine which bacteria analysis best represents these transitional sites. Regardless of the waterbody type, all Level I and Level II data and missing data are removed before measures are rounded to even and compared against the provided criteria. The output of this function includes all the bacteria columns required in the Station Table for CEDS bulk data upload as well as a verbose comment that is provided to the assessor for standardized inclusion in CEDS WQA.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="individual-parameter-analyses.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="do">## outermost function to decide which bacteria should be assessed based on WQS Class</span></span>
<span id="cb85-2"><a href="individual-parameter-analyses.html#cb85-2" aria-hidden="true" tabindex="-1"></a>bacteriaAssessmentDecisionClass <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData, <span class="co"># input dataframe with bacteria data</span></span>
<span id="cb85-3"><a href="individual-parameter-analyses.html#cb85-3" aria-hidden="true" tabindex="-1"></a>                                            uniqueStationName <span class="co"># stationID for output in case no data come into function</span></span>
<span id="cb85-4"><a href="individual-parameter-analyses.html#cb85-4" aria-hidden="true" tabindex="-1"></a>                                            ){</span>
<span id="cb85-5"><a href="individual-parameter-analyses.html#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="individual-parameter-analyses.html#cb85-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb85-7"><a href="individual-parameter-analyses.html#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stop everything if no data to analyze in stationData</span></span>
<span id="cb85-8"><a href="individual-parameter-analyses.html#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(stationData) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb85-9"><a href="individual-parameter-analyses.html#cb85-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb85-10"><a href="individual-parameter-analyses.html#cb85-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(<span class="at">StationID =</span> uniqueStationName, <span class="at">ECOLI_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ECOLI_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ECOLI_GM_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ECOLI_GM_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb85-11"><a href="individual-parameter-analyses.html#cb85-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">ECOLI_STAT =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>), <span class="at">ECOLI_STATECOLI_VERBOSE =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb85-12"><a href="individual-parameter-analyses.html#cb85-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">ENTER_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_GM_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_GM_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb85-13"><a href="individual-parameter-analyses.html#cb85-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">ENTER_STAT =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>), <span class="at">ENTER_STATENTER_VERBOSE =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)) )}</span>
<span id="cb85-14"><a href="individual-parameter-analyses.html#cb85-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb85-15"><a href="individual-parameter-analyses.html#cb85-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lake stations should only be surface sample</span></span>
<span id="cb85-16"><a href="individual-parameter-analyses.html#cb85-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>lakeStation) <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb85-17"><a href="individual-parameter-analyses.html#cb85-17" aria-hidden="true" tabindex="-1"></a>    stationData <span class="ot">&lt;-</span> <span class="fu">filter</span>(stationData, FDT_DEPTH <span class="sc">&lt;=</span> <span class="fl">0.3</span>) }</span>
<span id="cb85-18"><a href="individual-parameter-analyses.html#cb85-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb85-19"><a href="individual-parameter-analyses.html#cb85-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(stationData) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb85-20"><a href="individual-parameter-analyses.html#cb85-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">unique</span>(stationData<span class="sc">$</span>CLASS) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;I&#39;</span>, <span class="st">&#39;II&#39;</span>)){</span>
<span id="cb85-21"><a href="individual-parameter-analyses.html#cb85-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># previously this was programmed to only output enterococci results for these classes, but assessors requested both outputs to be conservative</span></span>
<span id="cb85-22"><a href="individual-parameter-analyses.html#cb85-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(</span>
<span id="cb85-23"><a href="individual-parameter-analyses.html#cb85-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">left_join</span>(<span class="fu">bacteriaAssessmentDecision</span>(stationData, <span class="st">&#39;ECOLI&#39;</span>, <span class="st">&#39;LEVEL_ECOLI&#39;</span>, <span class="dv">10</span>, <span class="dv">410</span>, <span class="dv">126</span>),</span>
<span id="cb85-24"><a href="individual-parameter-analyses.html#cb85-24" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">bacteriaAssessmentDecision</span>(stationData, <span class="st">&#39;ENTEROCOCCI&#39;</span>, <span class="st">&#39;LEVEL_ENTEROCOCCI&#39;</span>, <span class="dv">10</span>, <span class="dv">130</span>, <span class="dv">35</span>),</span>
<span id="cb85-25"><a href="individual-parameter-analyses.html#cb85-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">by =</span> <span class="st">&#39;StationID&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-26"><a href="individual-parameter-analyses.html#cb85-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">BACTERIADECISION =</span> <span class="fu">paste0</span>(BACTERIADECISION.x, <span class="st">&#39; | &#39;</span>, BACTERIADECISION.y),</span>
<span id="cb85-27"><a href="individual-parameter-analyses.html#cb85-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">BACTERIASTATS =</span> <span class="fu">paste0</span>(BACTERIASTATS.x, <span class="st">&#39; | &#39;</span>, BACTERIASTATS.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-28"><a href="individual-parameter-analyses.html#cb85-28" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(BACTERIADECISION.x, BACTERIADECISION.y, BACTERIASTATS.x, BACTERIASTATS.y,</span>
<span id="cb85-29"><a href="individual-parameter-analyses.html#cb85-29" aria-hidden="true" tabindex="-1"></a>                           associatedDecisionData.x, associatedDecisionData.y)) )</span>
<span id="cb85-30"><a href="individual-parameter-analyses.html#cb85-30" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb85-31"><a href="individual-parameter-analyses.html#cb85-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(</span>
<span id="cb85-32"><a href="individual-parameter-analyses.html#cb85-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bacteriaAssessmentDecision</span>(stationData, <span class="st">&#39;ECOLI&#39;</span>, <span class="st">&#39;LEVEL_ECOLI&#39;</span>, <span class="dv">10</span>, <span class="dv">410</span>, <span class="dv">126</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-33"><a href="individual-parameter-analyses.html#cb85-33" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(StationID<span class="sc">:</span>BACTERIASTATS) <span class="sc">%&gt;%</span> <span class="co">#ECOLI_STATECOLI_VERBOSE) %&gt;%</span></span>
<span id="cb85-34"><a href="individual-parameter-analyses.html#cb85-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">ENTER_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_GM_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_GM_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb85-35"><a href="individual-parameter-analyses.html#cb85-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ENTER_STAT =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>), <span class="at">ENTER_STATENTER_VERBOSE =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)) ) }</span>
<span id="cb85-36"><a href="individual-parameter-analyses.html#cb85-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb85-37"><a href="individual-parameter-analyses.html#cb85-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb85-38"><a href="individual-parameter-analyses.html#cb85-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(<span class="at">StationID =</span> uniqueStationName, <span class="at">ECOLI_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ECOLI_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ECOLI_GM_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ECOLI_GM_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb85-39"><a href="individual-parameter-analyses.html#cb85-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">ECOLI_STAT =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>), <span class="at">ECOLI_STATECOLI_VERBOSE =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb85-40"><a href="individual-parameter-analyses.html#cb85-40" aria-hidden="true" tabindex="-1"></a>             <span class="at">ENTER_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_GM_EXC =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">ENTER_GM_SAMP =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb85-41"><a href="individual-parameter-analyses.html#cb85-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">ENTER_STAT =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>), <span class="at">ENTER_STATENTER_VERBOSE =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)) )}</span>
<span id="cb85-42"><a href="individual-parameter-analyses.html#cb85-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-43"><a href="individual-parameter-analyses.html#cb85-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-44"><a href="individual-parameter-analyses.html#cb85-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb85-45"><a href="individual-parameter-analyses.html#cb85-45" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData object is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb85-46"><a href="individual-parameter-analyses.html#cb85-46" aria-hidden="true" tabindex="-1"></a><span class="co"># bacteriaAssessmentDecisionClass(stationData)</span></span></code></pre></div>
</div>
</div>
<div id="nutrients" class="section level3" number="3.5.6">
<h3><span class="header-section-number">3.5.6</span> Nutrients</h3>
</div>
<div id="ammonia" class="section level3" number="3.5.7">
<h3><span class="header-section-number">3.5.7</span> Ammonia</h3>
</div>
<div id="pcb" class="section level3" number="3.5.8">
<h3><span class="header-section-number">3.5.8</span> PCB</h3>
<p>The <code>PCBmetalsDataExists()</code> function is used primarily for flagging whether or not certain data exist when building the Station Table. Most stations evaluated during an assessment period do not have metals or toxics data, so it is important to flag when data require review. This particular function can be used to flag when data exist across water column PCB, sediment PCB, fish tissue metals, and fish tissue PCB data. When data exists for these toxics parameters, regional assessment staff may investigate them against applicable thresholds inside the waterbody-specific shiny assessment application.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="individual-parameter-analyses.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Identify if further review needs to happen for PCB or metals data </span></span>
<span id="cb86-2"><a href="individual-parameter-analyses.html#cb86-2" aria-hidden="true" tabindex="-1"></a>PCBmetalsDataExists <span class="ot">&lt;-</span> <span class="cf">function</span>(datasetType, <span class="co"># any of the preorganized PCB or fish tissue datasets</span></span>
<span id="cb86-3"><a href="individual-parameter-analyses.html#cb86-3" aria-hidden="true" tabindex="-1"></a>                                parameterType <span class="co"># field name to pass through to Station Table output</span></span>
<span id="cb86-4"><a href="individual-parameter-analyses.html#cb86-4" aria-hidden="true" tabindex="-1"></a>                                ){</span>
<span id="cb86-5"><a href="individual-parameter-analyses.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if any data given to function</span></span>
<span id="cb86-6"><a href="individual-parameter-analyses.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(datasetType) <span class="sc">&gt;</span> <span class="dv">0</span>){ </span>
<span id="cb86-7"><a href="individual-parameter-analyses.html#cb86-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">EXC =</span> <span class="cn">NA</span>, <span class="at">STAT =</span> <span class="st">&#39;Review&#39;</span>)</span>
<span id="cb86-8"><a href="individual-parameter-analyses.html#cb86-8" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> {</span>
<span id="cb86-9"><a href="individual-parameter-analyses.html#cb86-9" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">EXC =</span> <span class="cn">NA</span>, <span class="at">STAT =</span> <span class="cn">NA</span>) }</span>
<span id="cb86-10"><a href="individual-parameter-analyses.html#cb86-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb86-11"><a href="individual-parameter-analyses.html#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(x) <span class="ot">&lt;-</span> <span class="fu">paste</span>(parameterType, <span class="fu">names</span>(x), <span class="at">sep=</span><span class="st">&#39;_&#39;</span>)</span>
<span id="cb86-12"><a href="individual-parameter-analyses.html#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb86-13"><a href="individual-parameter-analyses.html#cb86-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-14"><a href="individual-parameter-analyses.html#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="individual-parameter-analyses.html#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb86-16"><a href="individual-parameter-analyses.html#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="co"># where markPCB, fishMetals, fishPCB objects are already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb86-17"><a href="individual-parameter-analyses.html#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="co"># PCBmetalsDataExists(filter(markPCB, str_detect(SampleMedia, &#39;Water&#39;)) %&gt;%</span></span>
<span id="cb86-18"><a href="individual-parameter-analyses.html#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                       filter(StationID %in% &#39;2-JKS023.61&#39;), &#39;WAT_TOX&#39;)</span></span>
<span id="cb86-19"><a href="individual-parameter-analyses.html#cb86-19" aria-hidden="true" tabindex="-1"></a><span class="co"># PCBmetalsDataExists(filter(markPCB, str_detect(SampleMedia, &#39;Sediment&#39;)) %&gt;%</span></span>
<span id="cb86-20"><a href="individual-parameter-analyses.html#cb86-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                       filter(StationID %in% &#39;2-JKS023.61&#39;), &#39;SED_TOX&#39;)</span></span>
<span id="cb86-21"><a href="individual-parameter-analyses.html#cb86-21" aria-hidden="true" tabindex="-1"></a><span class="co"># PCBmetalsDataExists(filter(fishMetals, Station_ID %in% &#39;2-JKS023.61&#39;), &#39;FISH_MET&#39;)</span></span>
<span id="cb86-22"><a href="individual-parameter-analyses.html#cb86-22" aria-hidden="true" tabindex="-1"></a><span class="co"># PCBmetalsDataExists(filter(fishPCB, `DEQ rivermile` %in%  &#39;2-JKS023.61&#39;), &#39;FISH_TOX&#39;)</span></span></code></pre></div>
</div>
<div id="metals" class="section level3" number="3.5.9">
<h3><span class="header-section-number">3.5.9</span> Metals</h3>
<p>For a general flag provided to the Station Table to determine whether metals data do/do not exist, please see <a href="individual-parameter-analyses.html#pcb">PCB</a> above. When data exists for these sediment or water column metals parameters, regional assessment staff may investigate them against applicable thresholds inside the waterbody-specific shiny assessment application.</p>
<p><strong>Hang tight til Joe’s update</strong></p>
</div>
<div id="fish-tissue" class="section level3" number="3.5.10">
<h3><span class="header-section-number">3.5.10</span> Fish Tissue</h3>
<p>For a general flag provided to the Station Table to determine whether fish tissue data do/do not exist, please see <a href="individual-parameter-analyses.html#pcb">PCB</a> above. When data exists for these fish tissue metals or PCB data, regional assessment staff may investigate them against applicable thresholds inside the waterbody-specific shiny assessment application.</p>
</div>
<div id="benthics" class="section level3" number="3.5.11">
<h3><span class="header-section-number">3.5.11</span> Benthics</h3>
<p>The <code>benthicAssessment()</code> function is used primarily for flagging whether or benthic data exist when building the Station Table. Most stations evaluated during an assessment period do not have benthic macroinvertebrate data, so it is important to flag when data require review.</p>
<p>Benthic assessments are completed by regional biologists to ensure the appropriate SCI and professional judgment are used for assessments. The biological staff review all samples within a given assessment period using the <a href="https://rconnect.deq.virginia.gov/IR2022BioassessmentDashboard/">Bioassessment Dashboard</a>{target = ’_blank’} and complete a bioassessment for submission via the <a href="https://rconnect.deq.virginia.gov/BenthicAssessmentFactSheet/">Bioassessment Fact Sheet Generator</a>{target = ’_blank’}. This information is archived for future biological, assessment, and TMDL staff as well as provided seamlessly within the <a href="https://rconnect.deq.virginia.gov/IR2022riverineAssessmentApplication/">Riverine Assessment Application</a>{target = ’_blank’}.</p>
<p>The regional assessment staff know to look for bioassessment information based on the ‘Review’ flag that the <code>benthicAssessment()</code> function provides to the Station Table output.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="individual-parameter-analyses.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Benthic Data flag</span></span>
<span id="cb87-2"><a href="individual-parameter-analyses.html#cb87-2" aria-hidden="true" tabindex="-1"></a>benthicAssessment <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData,</span>
<span id="cb87-3"><a href="individual-parameter-analyses.html#cb87-3" aria-hidden="true" tabindex="-1"></a>                              VSCIresults <span class="co"># pinned dataset with all BenSamps run against just VSCI</span></span>
<span id="cb87-4"><a href="individual-parameter-analyses.html#cb87-4" aria-hidden="true" tabindex="-1"></a>                              ){</span>
<span id="cb87-5"><a href="individual-parameter-analyses.html#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this works because the all SCI options are run on all data, so if there is a VSCI result </span></span>
<span id="cb87-6"><a href="individual-parameter-analyses.html#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (even if in real life that is not the correct SCI to use), then benthic data exists for</span></span>
<span id="cb87-7"><a href="individual-parameter-analyses.html#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a given station</span></span>
<span id="cb87-8"><a href="individual-parameter-analyses.html#cb87-8" aria-hidden="true" tabindex="-1"></a>  benthicDataExist <span class="ot">&lt;-</span> <span class="fu">filter</span>(VSCIresults, StationID <span class="sc">%in%</span> <span class="fu">unique</span>(stationData<span class="sc">$</span>FDT_STA_ID))</span>
<span id="cb87-9"><a href="individual-parameter-analyses.html#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(benthicDataExist) <span class="sc">&gt;</span> <span class="dv">0</span>){<span class="fu">tibble</span>(<span class="at">BENTHIC_STAT =</span> <span class="st">&#39;Review&#39;</span>)</span>
<span id="cb87-10"><a href="individual-parameter-analyses.html#cb87-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="fu">tibble</span>(<span class="at">BENTHIC_STAT =</span> <span class="cn">NA</span>)}</span>
<span id="cb87-11"><a href="individual-parameter-analyses.html#cb87-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-12"><a href="individual-parameter-analyses.html#cb87-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-13"><a href="individual-parameter-analyses.html#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb87-14"><a href="individual-parameter-analyses.html#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData and VSCIresults objects are already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb87-15"><a href="individual-parameter-analyses.html#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="co"># benthicAssessment(stationData, VSCIresults)</span></span></code></pre></div>
</div>
<div id="additional-automated-functions" class="section level3" number="3.5.12">
<h3><span class="header-section-number">3.5.12</span> Additional Automated Functions</h3>
<p>The functions below are helper functions but do not take a starring role in the automated assessment process; however, without these functions, one could not perform an automated assessment. Each function is detailed below.</p>
<div id="assessmentperiod" class="section level4" number="3.5.12.1">
<h4><span class="header-section-number">3.5.12.1</span> assessmentPeriod</h4>
<p>The <code>assessmentPeriod</code> and <code>assessmentCycle</code> objects are not functions but incredibly useful vectors. These objects hold assessment window and cycle name information that allow for significantly easier updates from cycle to cycle. By sourcing this information throughout multiple dependent arguments and functions, one can easily make cycle changes when a new cycle is ready for assessment.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="individual-parameter-analyses.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Establish Assessment Period, update each cycle</span></span>
<span id="cb88-2"><a href="individual-parameter-analyses.html#cb88-2" aria-hidden="true" tabindex="-1"></a>assessmentPeriod <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>( <span class="fu">c</span>(<span class="st">&quot;2017-01-01 00:00:00 UTC&quot;</span>, <span class="st">&quot;2022-12-31 23:59:59 UTC&quot;</span>), <span class="at">tz=</span><span class="st">&#39;UTC&#39;</span>)</span>
<span id="cb88-3"><a href="individual-parameter-analyses.html#cb88-3" aria-hidden="true" tabindex="-1"></a>assessmentCycle <span class="ot">&lt;-</span> <span class="st">&#39;2024&#39;</span></span>
<span id="cb88-4"><a href="individual-parameter-analyses.html#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="individual-parameter-analyses.html#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb88-6"><a href="individual-parameter-analyses.html#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># pin_get(&quot;ejones/VSCIresults&quot;, board = &quot;rsconnect&quot;) %&gt;%</span></span>
<span id="cb88-7"><a href="individual-parameter-analyses.html#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter( between(`Collection Date`, assessmentPeriod[1], assessmentPeriod[2]) )</span></span></code></pre></div>
</div>
<div id="wqsvalues" class="section level4" number="3.5.12.2">
<h4><span class="header-section-number">3.5.12.2</span> WQSvalues</h4>
<p>The <code>WQSvalues</code> object is a tibble that allows for easy WQS updates should these values change over time. This data is joined to individual station data by WQS Class information to easily link measured parameters to appropriate criteria. Follow up functions refine the criteria information should a station’s WQS specify any special standards.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="individual-parameter-analyses.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># WQS information for functions</span></span>
<span id="cb89-2"><a href="individual-parameter-analyses.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># From: 9VAC25-260-50. Numerical Criteria for Dissolved Oxygen, Ph, and Maximum Temperature</span></span>
<span id="cb89-3"><a href="individual-parameter-analyses.html#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section50/</span></span>
<span id="cb89-4"><a href="individual-parameter-analyses.html#cb89-4" aria-hidden="true" tabindex="-1"></a>WQSvalues <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">CLASS_BASIN =</span> <span class="fu">c</span>(<span class="st">&#39;I&#39;</span>,<span class="st">&quot;II&quot;</span>,<span class="st">&quot;II_7&quot;</span>,<span class="st">&quot;III&quot;</span>,<span class="st">&quot;IV&quot;</span>,<span class="st">&quot;V&quot;</span>,<span class="st">&quot;VI&quot;</span>,<span class="st">&quot;VII&quot;</span>),</span>
<span id="cb89-5"><a href="individual-parameter-analyses.html#cb89-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">CLASS =</span> <span class="fu">c</span>(<span class="st">&#39;I&#39;</span>,<span class="st">&quot;II&quot;</span>,<span class="st">&quot;II&quot;</span>,<span class="st">&quot;III&quot;</span>,<span class="st">&quot;IV&quot;</span>,<span class="st">&quot;V&quot;</span>,<span class="st">&quot;VI&quot;</span>,<span class="st">&quot;VII&quot;</span>),</span>
<span id="cb89-6"><a href="individual-parameter-analyses.html#cb89-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">Description Of Waters</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;Open Ocean&#39;</span>, <span class="st">&#39;Tidal Waters in the Chowan Basin and the Atlantic Ocean Basin&#39;</span>,</span>
<span id="cb89-7"><a href="individual-parameter-analyses.html#cb89-7" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">&#39;Tidal Waters in the Chesapeake Bay and its tidal tributaries&#39;</span>,</span>
<span id="cb89-8"><a href="individual-parameter-analyses.html#cb89-8" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">&#39;Nontidal Waters (Coastal and Piedmont Zone)&#39;</span>,<span class="st">&#39;Mountainous Zone Waters&#39;</span>,</span>
<span id="cb89-9"><a href="individual-parameter-analyses.html#cb89-9" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">&#39;Stockable Trout Waters&#39;</span>,<span class="st">&#39;Natural Trout Waters&#39;</span>,<span class="st">&#39;Swamp Waters&#39;</span>),</span>
<span id="cb89-10"><a href="individual-parameter-analyses.html#cb89-10" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">Dissolved Oxygen Min (mg/L)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="cn">NA</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="cn">NA</span>),</span>
<span id="cb89-11"><a href="individual-parameter-analyses.html#cb89-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">Dissolved Oxygen Daily Avg (mg/L)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">5</span>,<span class="cn">NA</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="cn">NA</span>),</span>
<span id="cb89-12"><a href="individual-parameter-analyses.html#cb89-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">pH Min</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="fl">6.0</span>,<span class="fl">6.0</span>,<span class="fl">6.0</span>,<span class="fl">6.0</span>,<span class="fl">6.0</span>,<span class="fl">3.7</span>),</span>
<span id="cb89-13"><a href="individual-parameter-analyses.html#cb89-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">pH Max</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">9.0</span>,<span class="fl">9.0</span>,<span class="fl">9.0</span>,<span class="fl">9.0</span>,<span class="fl">9.0</span>,<span class="fl">9.0</span>,<span class="fl">9.0</span>,<span class="fl">8.0</span>),</span>
<span id="cb89-14"><a href="individual-parameter-analyses.html#cb89-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">Max Temperature (C)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">32</span>, <span class="dv">31</span>, <span class="dv">21</span>, <span class="dv">20</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-15"><a href="individual-parameter-analyses.html#cb89-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CLASS_DESCRIPTION =</span> <span class="fu">paste0</span>(CLASS, <span class="st">&quot; | &quot;</span>, <span class="st">`</span><span class="at">Description Of Waters</span><span class="st">`</span>))</span>
<span id="cb89-16"><a href="individual-parameter-analyses.html#cb89-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-17"><a href="individual-parameter-analyses.html#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb89-18"><a href="individual-parameter-analyses.html#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationTable is already joined to citmonWQS and WQSlookup, see Automated Assessment for environment set up help</span></span>
<span id="cb89-19"><a href="individual-parameter-analyses.html#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="co"># stationTable %&gt;%</span></span>
<span id="cb89-20"><a href="individual-parameter-analyses.html#cb89-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Fix for Class II Tidal Waters in Chesapeake (bc complicated DO/temp/etc standard)</span></span>
<span id="cb89-21"><a href="individual-parameter-analyses.html#cb89-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(CLASS_BASIN = paste(CLASS,substr(BASIN, 1,1), sep=&quot;_&quot;)) %&gt;% # (2)</span></span>
<span id="cb89-22"><a href="individual-parameter-analyses.html#cb89-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(CLASS_BASIN = ifelse(CLASS_BASIN == &#39;II_7&#39;, &quot;II_7&quot;, as.character(CLASS))) %&gt;% # (2)</span></span>
<span id="cb89-23"><a href="individual-parameter-analyses.html#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Join actual WQS criteria to each StationID</span></span>
<span id="cb89-24"><a href="individual-parameter-analyses.html#cb89-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(WQSvalues, by = &#39;CLASS_BASIN&#39;)</span></span></code></pre></div>
</div>
<div id="lakenamestandardization" class="section level4" number="3.5.12.3">
<h4><span class="header-section-number">3.5.12.3</span> lakeNameStandardization</h4>
<p>This helper function allows for easier lake name cleanup to allow for joins on lake name fields between disparate data types. By storing this crosswalk information in a single function, it can be easily updated if lake names change and applied to multiple scripts easily.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="individual-parameter-analyses.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lake name standardization</span></span>
<span id="cb90-2"><a href="individual-parameter-analyses.html#cb90-2" aria-hidden="true" tabindex="-1"></a>lakeNameStandardization <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb90-3"><a href="individual-parameter-analyses.html#cb90-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">%&gt;%</span> </span>
<span id="cb90-4"><a href="individual-parameter-analyses.html#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Lake_Name =</span> <span class="fu">case_when</span>(WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Abel Lake Reservoir (Long Branch)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Abel Lake&#39;</span>,</span>
<span id="cb90-5"><a href="individual-parameter-analyses.html#cb90-5" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Big Cherry Reservior&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Big Cherry Lake&#39;</span>,</span>
<span id="cb90-6"><a href="individual-parameter-analyses.html#cb90-6" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Dan River&#39;</span>,<span class="st">&#39;Buffalo Creek&#39;</span>,<span class="st">&#39;Bluestone Creek&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Kerr Reservoir&#39;</span>,</span>
<span id="cb90-7"><a href="individual-parameter-analyses.html#cb90-7" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Smith Lake (Aquia Reservoir)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Aquia Reservoir (Smith Lake)&#39;</span>,</span>
<span id="cb90-8"><a href="individual-parameter-analyses.html#cb90-8" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Claytor Lake (New River)&#39;</span>, <span class="st">&#39;Claytor Lake (Peak Creek)&#39;</span>,</span>
<span id="cb90-9"><a href="individual-parameter-analyses.html#cb90-9" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&#39;Claytor Lake Lower (New River)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Claytor Lake&#39;</span>,</span>
<span id="cb90-10"><a href="individual-parameter-analyses.html#cb90-10" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Fairystone Lake (Goblin Town Creek)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Fairystone Lake&#39;</span>, </span>
<span id="cb90-11"><a href="individual-parameter-analyses.html#cb90-11" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Harwood Mill Reservoir (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Harwood Mills Reservoir&#39;</span>,</span>
<span id="cb90-12"><a href="individual-parameter-analyses.html#cb90-12" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Goose Creek&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Goose Creek Reservoir&#39;</span>,</span>
<span id="cb90-13"><a href="individual-parameter-analyses.html#cb90-13" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Anna&#39;</span>, <span class="st">&#39;Lake Anna/Contrary Creek&#39;</span>, <span class="st">&#39;Lake Anna/Freshwater Creek&#39;</span>, </span>
<span id="cb90-14"><a href="individual-parameter-analyses.html#cb90-14" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&#39;Lake Anna/Gold Mine Creek&#39;</span>, <span class="st">&#39;Lake Anna/Pamunkey Creek&#39;</span>, </span>
<span id="cb90-15"><a href="individual-parameter-analyses.html#cb90-15" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&#39;Lake Anna/Plentiful Creek&#39;</span>, <span class="st">&#39;Terrys Run/Lake Anna&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Anna&#39;</span>,</span>
<span id="cb90-16"><a href="individual-parameter-analyses.html#cb90-16" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Cohoon (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Cohoon&#39;</span>,     </span>
<span id="cb90-17"><a href="individual-parameter-analyses.html#cb90-17" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Conner Lake&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Conner&#39;</span>,</span>
<span id="cb90-18"><a href="individual-parameter-analyses.html#cb90-18" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Kilby (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Kilby&#39;</span>,</span>
<span id="cb90-19"><a href="individual-parameter-analyses.html#cb90-19" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Meade (PWS)&#39;</span>,<span class="st">&#39;Pitch Kettle Creek - Lake (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Meade&#39;</span>,</span>
<span id="cb90-20"><a href="individual-parameter-analyses.html#cb90-20" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Moomaw (Jackson River)&#39;</span>,<span class="st">&#39;Lake Moomaw Middle (Jackson River)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Moomaw&#39;</span>,</span>
<span id="cb90-21"><a href="individual-parameter-analyses.html#cb90-21" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Prince - Reservoir (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Prince&#39;</span>,</span>
<span id="cb90-22"><a href="individual-parameter-analyses.html#cb90-22" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Shenandoah&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Shenandoah Lake&#39;</span>,</span>
<span id="cb90-23"><a href="individual-parameter-analyses.html#cb90-23" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Smith (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Smith&#39;</span>,</span>
<span id="cb90-24"><a href="individual-parameter-analyses.html#cb90-24" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Whitehurst (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Whitehurst&#39;</span>,</span>
<span id="cb90-25"><a href="individual-parameter-analyses.html#cb90-25" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Leesville Lake&#39;</span>, <span class="st">&#39;Leesville Lake (Pigg R.)&#39;</span>, </span>
<span id="cb90-26"><a href="individual-parameter-analyses.html#cb90-26" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&#39;Leesville Lake Middle (Roanoke R.)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Leesville Lake&#39;</span>,</span>
<span id="cb90-27"><a href="individual-parameter-analyses.html#cb90-27" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lee Hall Reservoir- Upper, Middle&#39;</span>,<span class="st">&#39;Lee Hall Reservoir-Lower&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lee Hall Reservoir&#39;</span>,</span>
<span id="cb90-28"><a href="individual-parameter-analyses.html#cb90-28" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Little Creek Reservoir - (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Little Creek Reservoir (VBC)&#39;</span>,</span>
<span id="cb90-29"><a href="individual-parameter-analyses.html#cb90-29" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Little Creek Reservoir (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Little Creek Reservoir (JCC)&#39;</span>,</span>
<span id="cb90-30"><a href="individual-parameter-analyses.html#cb90-30" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lonestar Lake F (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lone Star Lake F (Crystal Lake)&#39;</span>, </span>
<span id="cb90-31"><a href="individual-parameter-analyses.html#cb90-31" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lone Star Lake G (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lone Star Lake G (Crane Lake)&#39;</span>, </span>
<span id="cb90-32"><a href="individual-parameter-analyses.html#cb90-32" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lone Star Lake I (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lone Star Lake I (Butler Lake)&#39;</span>, </span>
<span id="cb90-33"><a href="individual-parameter-analyses.html#cb90-33" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Martinsville (Beaver Creek) Reservoir&#39;</span>,</span>
<span id="cb90-34"><a href="individual-parameter-analyses.html#cb90-34" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&#39;Martinsville Reservoir&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Martinsville Reservoir (Beaver Creek Reservoir)&#39;</span>,</span>
<span id="cb90-35"><a href="individual-parameter-analyses.html#cb90-35" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Moormans River&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Sugar Hollow Reservoir&#39;</span>,</span>
<span id="cb90-36"><a href="individual-parameter-analyses.html#cb90-36" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;North River&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Staunton Dam Lake&#39;</span>,</span>
<span id="cb90-37"><a href="individual-parameter-analyses.html#cb90-37" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Philpott Reservoir (Goblin Town Creek)&#39;</span>, <span class="st">&#39;Philpott Reservoir Lower (Smith River)&#39;</span>,</span>
<span id="cb90-38"><a href="individual-parameter-analyses.html#cb90-38" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&#39;Philpott Reservoir (Smith River)&#39;</span>) <span class="sc">~</span> <span class="st">&quot;Philpott Reservoir&quot;</span>,</span>
<span id="cb90-39"><a href="individual-parameter-analyses.html#cb90-39" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Roanoke River&#39;</span>,<span class="st">&#39;Lake Gaston&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Gaston&#39;</span>,     </span>
<span id="cb90-40"><a href="individual-parameter-analyses.html#cb90-40" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Roaring Fork Reservoir&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Roaring Fork&#39;</span>,</span>
<span id="cb90-41"><a href="individual-parameter-analyses.html#cb90-41" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;S F Rivanna River Reservoir&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Rivanna Reservoir (South Fork Rivanna Reservoir)&#39;</span>,</span>
<span id="cb90-42"><a href="individual-parameter-analyses.html#cb90-42" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">str_detect</span>(WATER_NAME, <span class="st">&#39;Smith Mtn. Lake&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Smith Mountain Lake&#39;</span>, </span>
<span id="cb90-43"><a href="individual-parameter-analyses.html#cb90-43" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Speights Run - Lake (PWS)&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Speights Run Lake&#39;</span>,</span>
<span id="cb90-44"><a href="individual-parameter-analyses.html#cb90-44" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Troublesome Reservoir&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Troublesome Creek Reservoir&#39;</span>,</span>
<span id="cb90-45"><a href="individual-parameter-analyses.html#cb90-45" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Waller Mill Reservoir [PWS]&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Waller Mill Reservoir&#39;</span>,</span>
<span id="cb90-46"><a href="individual-parameter-analyses.html#cb90-46" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Unnamed pond near Tanyard Swamp&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Tanyard Swamp&#39;</span>,</span>
<span id="cb90-47"><a href="individual-parameter-analyses.html#cb90-47" aria-hidden="true" tabindex="-1"></a>                                 WATER_NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Unsegmented lakes in G03&#39;</span>) <span class="sc">~</span> <span class="st">&#39;West Run&#39;</span>,</span>
<span id="cb90-48"><a href="individual-parameter-analyses.html#cb90-48" aria-hidden="true" tabindex="-1"></a>                                 <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(WATER_NAME))) </span>
<span id="cb90-49"><a href="individual-parameter-analyses.html#cb90-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-50"><a href="individual-parameter-analyses.html#cb90-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-51"><a href="individual-parameter-analyses.html#cb90-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb90-52"><a href="individual-parameter-analyses.html#cb90-52" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationTable is already joined to citmonWQS, WQSlookup, WQSvalues, and WQMstationFull, see Automated Assessment for environment set up help</span></span>
<span id="cb90-53"><a href="individual-parameter-analyses.html#cb90-53" aria-hidden="true" tabindex="-1"></a><span class="co"># stationTable %&gt;% </span></span>
<span id="cb90-54"><a href="individual-parameter-analyses.html#cb90-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   lakeNameStandardization()  </span></span></code></pre></div>
</div>
<div id="quickstats" class="section level4" number="3.5.12.4">
<h4><span class="header-section-number">3.5.12.4</span> quickStats</h4>
<p>This helper function is essential to the automated assessment process. The function takes in parameter data with exceedances identified and sample counts and simplifies the data into a suggested assessment decision, where appropriate. The <code>parameter</code> argument allows users to pass through a character string they want to be included in the Stations Table field naming format. The <code>drop7Q10</code> argument is default set to false for automated assessment purposes, but the shiny applications use this feature to quickly rerun the exceedance math should a user decide that the 7Q10 flag should be used to remove data for a station and parameter combination.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="individual-parameter-analyses.html#cb91-1" aria-hidden="true" tabindex="-1"></a>quickStats <span class="ot">&lt;-</span> <span class="cf">function</span>(parameterDataset, <span class="co"># dataset from one station that has been run through a parameter exceedance analysis function </span></span>
<span id="cb91-2"><a href="individual-parameter-analyses.html#cb91-2" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#                  (e.g. tempExceedances(), DOExceedances_Min(), pHexceedances())</span></span>
<span id="cb91-3"><a href="individual-parameter-analyses.html#cb91-3" aria-hidden="true" tabindex="-1"></a>                       parameter, <span class="co"># the name of the parameter as you want it to appear in final stations table output</span></span>
<span id="cb91-4"><a href="individual-parameter-analyses.html#cb91-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">drop7Q10 =</span> <span class="cn">FALSE</span> <span class="co"># drop any records from this analysis with a 7Q10 flag, default is false but can be overridden in apps</span></span>
<span id="cb91-5"><a href="individual-parameter-analyses.html#cb91-5" aria-hidden="true" tabindex="-1"></a>                       ){</span>
<span id="cb91-6"><a href="individual-parameter-analyses.html#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop any 7Q10 flagged data from exceedance analyses for appropriate parameters</span></span>
<span id="cb91-7"><a href="individual-parameter-analyses.html#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(drop7Q10 <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span></span>
<span id="cb91-8"><a href="individual-parameter-analyses.html#cb91-8" aria-hidden="true" tabindex="-1"></a>     parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;TEMP&quot;</span>, <span class="st">&quot;DO&quot;</span>, <span class="st">&quot;DO_Daily_Avg&quot;</span>, <span class="st">&quot;PH&quot;</span>)){</span>
<span id="cb91-9"><a href="individual-parameter-analyses.html#cb91-9" aria-hidden="true" tabindex="-1"></a>    parameterDataset <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(parameterDataset, <span class="fu">is.na</span>(<span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>)) <span class="co"># only assess on assessable dataset</span></span>
<span id="cb91-10"><a href="individual-parameter-analyses.html#cb91-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-11"><a href="individual-parameter-analyses.html#cb91-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-12"><a href="individual-parameter-analyses.html#cb91-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(parameterDataset) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(parameterDataset<span class="sc">$</span>limit))){</span>
<span id="cb91-13"><a href="individual-parameter-analyses.html#cb91-13" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">EXC =</span> <span class="fu">nrow</span>(dplyr<span class="sc">::</span><span class="fu">filter</span>(parameterDataset, exceeds <span class="sc">==</span> <span class="cn">TRUE</span>)),</span>
<span id="cb91-14"><a href="individual-parameter-analyses.html#cb91-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SAMP =</span> <span class="fu">nrow</span>(parameterDataset)) <span class="sc">%&gt;%</span></span>
<span id="cb91-15"><a href="individual-parameter-analyses.html#cb91-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Implement Round to Even on Exceedance Frequency</span></span>
<span id="cb91-16"><a href="individual-parameter-analyses.html#cb91-16" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">exceedanceRate =</span> <span class="fu">as.numeric</span>(round<span class="sc">::</span><span class="fu">roundAll</span>((EXC<span class="sc">/</span>SAMP)<span class="sc">*</span><span class="dv">100</span>,<span class="at">digits=</span><span class="dv">0</span>, <span class="st">&quot;r0.C&quot;</span>))) <span class="co"># round to nearest whole number per Memo to Standardize Rounding for Assessment Guidance</span></span>
<span id="cb91-17"><a href="individual-parameter-analyses.html#cb91-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-18"><a href="individual-parameter-analyses.html#cb91-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results<span class="sc">$</span>EXC <span class="sc">&gt;=</span> <span class="dv">1</span>){outcome <span class="ot">&lt;-</span> <span class="st">&#39;Review&#39;</span>} <span class="co"># for Mary</span></span>
<span id="cb91-19"><a href="individual-parameter-analyses.html#cb91-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results<span class="sc">$</span>EXC <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> results<span class="sc">$</span>exceedanceRate <span class="sc">&lt;</span> <span class="fl">10.5</span>){outcome <span class="ot">&lt;-</span> <span class="st">&#39;Review&#39;</span>}</span>
<span id="cb91-20"><a href="individual-parameter-analyses.html#cb91-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results<span class="sc">$</span>exceedanceRate <span class="sc">&gt;</span> <span class="fl">10.5</span> <span class="sc">&amp;</span> results<span class="sc">$</span>EXC <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> results<span class="sc">$</span>SAMP <span class="sc">&gt;</span> <span class="dv">10</span>){outcome <span class="ot">&lt;-</span> <span class="st">&#39;10.5% Exceedance&#39;</span>}</span>
<span id="cb91-21"><a href="individual-parameter-analyses.html#cb91-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results<span class="sc">$</span>EXC <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span>results<span class="sc">$</span>exceedanceRate <span class="sc">&lt;</span> <span class="fl">10.5</span> <span class="sc">&amp;</span> results<span class="sc">$</span>SAMP <span class="sc">&gt;</span> <span class="dv">10</span>){outcome <span class="ot">&lt;-</span> <span class="st">&#39;S&#39;</span>}</span>
<span id="cb91-22"><a href="individual-parameter-analyses.html#cb91-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results<span class="sc">$</span>EXC <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> results<span class="sc">$</span>SAMP <span class="sc">&lt;=</span> <span class="dv">10</span>){outcome <span class="ot">&lt;-</span> <span class="st">&#39;Review&#39;</span>}</span>
<span id="cb91-23"><a href="individual-parameter-analyses.html#cb91-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results<span class="sc">$</span>EXC <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> results<span class="sc">$</span>SAMP <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> results<span class="sc">$</span>SAMP <span class="sc">&gt;</span> <span class="dv">1</span>){outcome <span class="ot">&lt;-</span> <span class="st">&#39;S&#39;</span>} <span class="co"># &amp; results$SAMP &gt;1 new 12/21/2020 can&#39;t say supporting on 1 sample</span></span>
<span id="cb91-24"><a href="individual-parameter-analyses.html#cb91-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(results<span class="sc">$</span>EXC <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> results<span class="sc">$</span>SAMP <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> results<span class="sc">$</span>SAMP <span class="sc">==</span> <span class="dv">1</span>){outcome <span class="ot">&lt;-</span> <span class="st">&#39;Review&#39;</span>} <span class="co"># &amp; results$SAMP &gt;1 new 12/21/2020 can&#39;t say supporting on 1 sample</span></span>
<span id="cb91-25"><a href="individual-parameter-analyses.html#cb91-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-26"><a href="individual-parameter-analyses.html#cb91-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-27"><a href="individual-parameter-analyses.html#cb91-27" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(results, <span class="at">STAT =</span> outcome)</span>
<span id="cb91-28"><a href="individual-parameter-analyses.html#cb91-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(parameter,<span class="fu">names</span>(results)[<span class="dv">1</span>], <span class="at">sep =</span> <span class="st">&#39;_&#39;</span>),</span>
<span id="cb91-29"><a href="individual-parameter-analyses.html#cb91-29" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(parameter,<span class="fu">names</span>(results)[<span class="dv">2</span>], <span class="at">sep =</span> <span class="st">&#39;_&#39;</span>),</span>
<span id="cb91-30"><a href="individual-parameter-analyses.html#cb91-30" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(parameter,<span class="fu">names</span>(results)[<span class="dv">3</span>], <span class="at">sep =</span> <span class="st">&#39;_&#39;</span>),</span>
<span id="cb91-31"><a href="individual-parameter-analyses.html#cb91-31" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste</span>(parameter,<span class="fu">names</span>(results)[<span class="dv">4</span>], <span class="at">sep =</span> <span class="st">&#39;_&#39;</span>))</span>
<span id="cb91-32"><a href="individual-parameter-analyses.html#cb91-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">#rename based on parameter entered</span></span>
<span id="cb91-33"><a href="individual-parameter-analyses.html#cb91-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(results)</span>
<span id="cb91-34"><a href="individual-parameter-analyses.html#cb91-34" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb91-35"><a href="individual-parameter-analyses.html#cb91-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(parameterDataset) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb91-36"><a href="individual-parameter-analyses.html#cb91-36" aria-hidden="true" tabindex="-1"></a>      z <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">EXC =</span> <span class="cn">NA</span>, <span class="at">SAMP=</span> <span class="fu">nrow</span>(parameterDataset), <span class="at">exceedanceRate=</span> <span class="cn">NA</span>, <span class="at">STAT=</span> <span class="cn">NA</span>)</span>
<span id="cb91-37"><a href="individual-parameter-analyses.html#cb91-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(z) <span class="ot">&lt;-</span> <span class="fu">paste</span>(parameter,<span class="fu">names</span>(z), <span class="at">sep=</span><span class="st">&#39;_&#39;</span>)</span>
<span id="cb91-38"><a href="individual-parameter-analyses.html#cb91-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(z)</span>
<span id="cb91-39"><a href="individual-parameter-analyses.html#cb91-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb91-40"><a href="individual-parameter-analyses.html#cb91-40" aria-hidden="true" tabindex="-1"></a>      z <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">EXC =</span> <span class="cn">NA</span>, <span class="at">SAMP=</span> <span class="fu">nrow</span>(parameterDataset), <span class="at">exceedanceRate=</span> <span class="cn">NA</span>, <span class="at">STAT=</span> <span class="fu">paste</span>(parameter, <span class="st">&#39;WQS info missing from analysis&#39;</span>))</span>
<span id="cb91-41"><a href="individual-parameter-analyses.html#cb91-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(z) <span class="ot">&lt;-</span> <span class="fu">paste</span>(parameter,<span class="fu">names</span>(z), <span class="at">sep=</span><span class="st">&#39;_&#39;</span>)</span>
<span id="cb91-42"><a href="individual-parameter-analyses.html#cb91-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(z)</span>
<span id="cb91-43"><a href="individual-parameter-analyses.html#cb91-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb91-44"><a href="individual-parameter-analyses.html#cb91-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-45"><a href="individual-parameter-analyses.html#cb91-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-46"><a href="individual-parameter-analyses.html#cb91-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb91-47"><a href="individual-parameter-analyses.html#cb91-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-48"><a href="individual-parameter-analyses.html#cb91-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb91-49"><a href="individual-parameter-analyses.html#cb91-49" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb91-50"><a href="individual-parameter-analyses.html#cb91-50" aria-hidden="true" tabindex="-1"></a><span class="co"># tempExceedances(stationData) %&gt;% </span></span>
<span id="cb91-51"><a href="individual-parameter-analyses.html#cb91-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   quickStats(&#39;TEMP&#39;)</span></span></code></pre></div>
</div>
<div id="stationtablestartingdata" class="section level4" number="3.5.12.5">
<h4><span class="header-section-number">3.5.12.5</span> StationTableStartingData</h4>
<p>This helper function organizes existing site metadata into a format that matches the desired Station Table output format.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="individual-parameter-analyses.html#cb92-1" aria-hidden="true" tabindex="-1"></a>StationTableStartingData <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData){</span>
<span id="cb92-2"><a href="individual-parameter-analyses.html#cb92-2" aria-hidden="true" tabindex="-1"></a>  stationData <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="individual-parameter-analyses.html#cb92-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(FDT_STA_ID, ID305B_1<span class="sc">:</span>VAHU6) <span class="sc">%&gt;%</span></span>
<span id="cb92-4"><a href="individual-parameter-analyses.html#cb92-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&#39;STATION_ID&#39;</span> <span class="ot">=</span> <span class="st">&#39;FDT_STA_ID&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-5"><a href="individual-parameter-analyses.html#cb92-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(STATION_ID, <span class="at">.keep_all =</span> T)</span>
<span id="cb92-6"><a href="individual-parameter-analyses.html#cb92-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-7"><a href="individual-parameter-analyses.html#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="individual-parameter-analyses.html#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb92-9"><a href="individual-parameter-analyses.html#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb92-10"><a href="individual-parameter-analyses.html#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co"># StationTableStartingData(stationData)</span></span></code></pre></div>
</div>
<div id="temperaturespecialstandardscorrection" class="section level4" number="3.5.12.6">
<h4><span class="header-section-number">3.5.12.6</span> temperatureSpecialStandardsCorrection</h4>
<p>This helper function is applied after <code>WQSvalues()</code> is run on a tibble of station data. The function corrects the coarser WQS value joined by Class by identifying if any temperature special standards are attributed to a station. If so, the function then adjusts each <code>Max Temperature (C)</code> record based on temporal criteria accordingly.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="individual-parameter-analyses.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># temperature special standards adjustment function</span></span>
<span id="cb93-2"><a href="individual-parameter-analyses.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this is applied to the actual monitoring data because there is a temporal component to these criteria</span></span>
<span id="cb93-3"><a href="individual-parameter-analyses.html#cb93-3" aria-hidden="true" tabindex="-1"></a>temperatureSpecialStandardsCorrection <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb93-4"><a href="individual-parameter-analyses.html#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ee. Maximum temperature for these seasonally stockable trout waters is 26°C and applies May 1 through October 31. https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section310/</span></span>
<span id="cb93-5"><a href="individual-parameter-analyses.html#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ff. Maximum temperature for these seasonally stockable trout waters is 28°C and applies May 1 through October 31. https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section310/</span></span>
<span id="cb93-6"><a href="individual-parameter-analyses.html#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hh. Maximum temperature for these seasonally stockable trout waters is 31°C and applies May 1 through October 31. https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section310/</span></span>
<span id="cb93-7"><a href="individual-parameter-analyses.html#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(x, <span class="st">`</span><span class="at">Max Temperature (C)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(<span class="fu">as.character</span>(SPSTDS), <span class="st">&#39;ee&#39;</span>) <span class="sc">&amp;</span> <span class="fu">month</span>(FDT_DATE_TIME) <span class="sc">%in%</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">~</span> <span class="dv">26</span>,</span>
<span id="cb93-8"><a href="individual-parameter-analyses.html#cb93-8" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">str_detect</span>(<span class="fu">as.character</span>(SPSTDS), <span class="st">&#39;ff&#39;</span>) <span class="sc">&amp;</span> <span class="fu">month</span>(FDT_DATE_TIME) <span class="sc">%in%</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">~</span> <span class="dv">28</span>,</span>
<span id="cb93-9"><a href="individual-parameter-analyses.html#cb93-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">str_detect</span>(<span class="fu">as.character</span>(SPSTDS), <span class="st">&#39;hh&#39;</span>) <span class="sc">&amp;</span> <span class="fu">month</span>(FDT_DATE_TIME) <span class="sc">%in%</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">~</span> <span class="dv">31</span>,</span>
<span id="cb93-10"><a href="individual-parameter-analyses.html#cb93-10" aria-hidden="true" tabindex="-1"></a>                                              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">`</span><span class="at">Max Temperature (C)</span><span class="st">`</span>)) </span>
<span id="cb93-11"><a href="individual-parameter-analyses.html#cb93-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-12"><a href="individual-parameter-analyses.html#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="individual-parameter-analyses.html#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb93-14"><a href="individual-parameter-analyses.html#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="co"># where conventionals and stationTable objects are already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb93-15"><a href="individual-parameter-analyses.html#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="co"># stationData &lt;- filter(conventionals, FDT_STA_ID %in% &#39;2-JKS023.61&#39;) %&gt;%</span></span>
<span id="cb93-16"><a href="individual-parameter-analyses.html#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     left_join(stationTable, by = c(&#39;FDT_STA_ID&#39; = &#39;STATION_ID&#39;)) %&gt;%</span></span>
<span id="cb93-17"><a href="individual-parameter-analyses.html#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     temperatureSpecialStandardsCorrection()</span></span></code></pre></div>
</div>
<div id="phspecialstandardscorrection" class="section level4" number="3.5.12.7">
<h4><span class="header-section-number">3.5.12.7</span> pHSpecialStandardsCorrection</h4>
<p>This helper function is applied after <code>WQSvalues()</code> is run on a tibble of station data. The function corrects the coarser WQS value joined by Class by identifying if any pH special standards are attributed to a station. If so, the function then adjusts each <code>pH Min</code> and <code>pH Max</code> record based on applicable criteria accordingly.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="individual-parameter-analyses.html#cb94-1" aria-hidden="true" tabindex="-1"></a>pHSpecialStandardsCorrection <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData){</span>
<span id="cb94-2"><a href="individual-parameter-analyses.html#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(stationData, <span class="st">`</span><span class="at">pH Min</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(<span class="fu">as.character</span>(SPSTDS), <span class="st">&#39;6.5-9.5&#39;</span>) <span class="sc">~</span> <span class="fl">6.5</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">`</span><span class="at">pH Min</span><span class="st">`</span>),</span>
<span id="cb94-3"><a href="individual-parameter-analyses.html#cb94-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">pH Max</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(<span class="fu">as.character</span>(SPSTDS), <span class="st">&#39;6.5-9.5&#39;</span>) <span class="sc">~</span> <span class="fl">9.5</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">`</span><span class="at">pH Max</span><span class="st">`</span>))</span>
<span id="cb94-4"><a href="individual-parameter-analyses.html#cb94-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-5"><a href="individual-parameter-analyses.html#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb94-6"><a href="individual-parameter-analyses.html#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co"># where conventionals and stationTable objects are already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb94-7"><a href="individual-parameter-analyses.html#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co"># stationData &lt;- filter(conventionals, FDT_STA_ID %in% &#39;2-JKS023.61&#39;) %&gt;%</span></span>
<span id="cb94-8"><a href="individual-parameter-analyses.html#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     left_join(stationTable, by = c(&#39;FDT_STA_ID&#39; = &#39;STATION_ID&#39;)) %&gt;%</span></span>
<span id="cb94-9"><a href="individual-parameter-analyses.html#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     pHSpecialStandardsCorrection()</span></span></code></pre></div>
</div>
<div id="stationtablecomments" class="section level4" number="3.5.12.8">
<h4><span class="header-section-number">3.5.12.8</span> stationTableComments</h4>
<p>This helper function parses station level comments from the two most recent IR Station Table outputs. This information is joined into the current IR Station Table, despite not fitting with the CEDS Bulk Data Upload template, in order to provide regional assessment staff with historical station information adjacent to current station information.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="individual-parameter-analyses.html#cb95-1" aria-hidden="true" tabindex="-1"></a>stationTableComments <span class="ot">&lt;-</span> <span class="cf">function</span>(stations, </span>
<span id="cb95-2"><a href="individual-parameter-analyses.html#cb95-2" aria-hidden="true" tabindex="-1"></a>                                 previousStationTable, </span>
<span id="cb95-3"><a href="individual-parameter-analyses.html#cb95-3" aria-hidden="true" tabindex="-1"></a>                                 previousStationTableCycle,</span>
<span id="cb95-4"><a href="individual-parameter-analyses.html#cb95-4" aria-hidden="true" tabindex="-1"></a>                                 previousStationTable2,</span>
<span id="cb95-5"><a href="individual-parameter-analyses.html#cb95-5" aria-hidden="true" tabindex="-1"></a>                                 previousStationTable2Cycle){</span>
<span id="cb95-6"><a href="individual-parameter-analyses.html#cb95-6" aria-hidden="true" tabindex="-1"></a>  lastComment <span class="ot">&lt;-</span> <span class="fu">filter</span>(previousStationTable, <span class="st">`</span><span class="at">Station Id</span><span class="st">`</span> <span class="sc">%in%</span> stations) <span class="sc">%&gt;%</span></span>
<span id="cb95-7"><a href="individual-parameter-analyses.html#cb95-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">Station Id</span><span class="st">`</span>, Comments)</span>
<span id="cb95-8"><a href="individual-parameter-analyses.html#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lastComment) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;STATION_ID&#39;</span>, <span class="fu">paste</span>(previousStationTableCycle, <span class="st">&#39;IR COMMENTS&#39;</span>))</span>
<span id="cb95-9"><a href="individual-parameter-analyses.html#cb95-9" aria-hidden="true" tabindex="-1"></a>  lastComment2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(previousStationTable2, <span class="st">`</span><span class="at">Station Id</span><span class="st">`</span> <span class="sc">%in%</span> stations) <span class="sc">%&gt;%</span></span>
<span id="cb95-10"><a href="individual-parameter-analyses.html#cb95-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">Station Id</span><span class="st">`</span>, Comments)</span>
<span id="cb95-11"><a href="individual-parameter-analyses.html#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lastComment2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;STATION_ID&#39;</span>, <span class="fu">paste</span>(previousStationTable2Cycle, <span class="st">&#39;IR COMMENTS&#39;</span>))</span>
<span id="cb95-12"><a href="individual-parameter-analyses.html#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">left_join</span>(lastComment, lastComment2, <span class="at">by=</span> <span class="st">&#39;STATION_ID&#39;</span>))</span>
<span id="cb95-13"><a href="individual-parameter-analyses.html#cb95-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-14"><a href="individual-parameter-analyses.html#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="individual-parameter-analyses.html#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Usage:</span></span>
<span id="cb95-16"><a href="individual-parameter-analyses.html#cb95-16" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationsTable2022 and stationTable2020 are objects containing previous stations table spreadsheets read into your R environment, see Automated Assessment for environment set up help</span></span>
<span id="cb95-17"><a href="individual-parameter-analyses.html#cb95-17" aria-hidden="true" tabindex="-1"></a><span class="co"># stationTableComments(&#39;2-JKS023.61&#39;, stationsTable2022, &#39;2022&#39;, stationsTable2020, &#39;2020&#39;)</span></span></code></pre></div>
</div>
<div id="thermoclinedepth" class="section level4" number="3.5.12.9">
<h4><span class="header-section-number">3.5.12.9</span> thermoclineDepth</h4>
<p>This helper function is essential for any lake station. The function takes in all conventionals data for a particular station and calculates a thermocline depth for each sample date. This depth is then used to attribute every sample as either “Epilimnion,” “Hypolimnion,” or unstratified (NA).</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="individual-parameter-analyses.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate daily thermocline depth and designate Epilimnion vs Hypolimnion</span></span>
<span id="cb96-2"><a href="individual-parameter-analyses.html#cb96-2" aria-hidden="true" tabindex="-1"></a>thermoclineDepth <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData){</span>
<span id="cb96-3"><a href="individual-parameter-analyses.html#cb96-3" aria-hidden="true" tabindex="-1"></a>  stationData <span class="ot">&lt;-</span> stationData <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="individual-parameter-analyses.html#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">SampleDate =</span> <span class="fu">as.Date</span>(FDT_DATE_TIME)) <span class="sc">%&gt;%</span></span>
<span id="cb96-5"><a href="individual-parameter-analyses.html#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FDT_STA_ID, SampleDate) </span>
<span id="cb96-6"><a href="individual-parameter-analyses.html#cb96-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-7"><a href="individual-parameter-analyses.html#cb96-7" aria-hidden="true" tabindex="-1"></a>  dailyThermDepth <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(stationData, FDT_STA_ID, SampleDate, FDT_DEPTH, FDT_TEMP_CELCIUS) <span class="sc">%&gt;%</span></span>
<span id="cb96-8"><a href="individual-parameter-analyses.html#cb96-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">DepthDiff =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(FDT_DEPTH)),</span>
<span id="cb96-9"><a href="individual-parameter-analyses.html#cb96-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">TempDiff =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(FDT_TEMP_CELCIUS))) <span class="sc">%&gt;%</span></span>
<span id="cb96-10"><a href="individual-parameter-analyses.html#cb96-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(DepthDiff <span class="sc">==</span> <span class="dv">1</span>) <span class="co"># get rid of changes less than 1 meter depth</span></span>
<span id="cb96-11"><a href="individual-parameter-analyses.html#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Alt route in case shallow lake</span></span>
<span id="cb96-12"><a href="individual-parameter-analyses.html#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(dailyThermDepth) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb96-13"><a href="individual-parameter-analyses.html#cb96-13" aria-hidden="true" tabindex="-1"></a>    dailyThermDepth <span class="ot">&lt;-</span> <span class="fu">filter</span>(dailyThermDepth, TempDiff <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb96-14"><a href="individual-parameter-analyses.html#cb96-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># one more catch if no thermocline established</span></span>
<span id="cb96-15"><a href="individual-parameter-analyses.html#cb96-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(dailyThermDepth) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb96-16"><a href="individual-parameter-analyses.html#cb96-16" aria-hidden="true" tabindex="-1"></a>      dailyThermDepth <span class="ot">&lt;-</span> <span class="fu">summarise</span>(dailyThermDepth, <span class="at">ThermoclineDepth =</span> <span class="fu">min</span>(FDT_DEPTH) <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() </span>
<span id="cb96-17"><a href="individual-parameter-analyses.html#cb96-17" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb96-18"><a href="individual-parameter-analyses.html#cb96-18" aria-hidden="true" tabindex="-1"></a>      dailyThermDepth <span class="ot">&lt;-</span> <span class="fu">summarise</span>(stationData, <span class="at">ThermoclineDepth =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()  }</span>
<span id="cb96-19"><a href="individual-parameter-analyses.html#cb96-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb96-20"><a href="individual-parameter-analyses.html#cb96-20" aria-hidden="true" tabindex="-1"></a>    dailyThermDepth <span class="ot">&lt;-</span> <span class="fu">summarise</span>(stationData, <span class="at">ThermoclineDepth =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() }</span>
<span id="cb96-21"><a href="individual-parameter-analyses.html#cb96-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-22"><a href="individual-parameter-analyses.html#cb96-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-23"><a href="individual-parameter-analyses.html#cb96-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(stationData, dailyThermDepth, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;FDT_STA_ID&#39;</span>, <span class="st">&#39;SampleDate&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-24"><a href="individual-parameter-analyses.html#cb96-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">LakeStratification=</span> <span class="fu">ifelse</span>(FDT_DEPTH <span class="sc">&lt;</span> ThermoclineDepth,<span class="st">&quot;Epilimnion&quot;</span>,<span class="st">&quot;Hypolimnion&quot;</span>))<span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() </span>
<span id="cb96-25"><a href="individual-parameter-analyses.html#cb96-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-26"><a href="individual-parameter-analyses.html#cb96-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-27"><a href="individual-parameter-analyses.html#cb96-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb96-28"><a href="individual-parameter-analyses.html#cb96-28" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb96-29"><a href="individual-parameter-analyses.html#cb96-29" aria-hidden="true" tabindex="-1"></a><span class="co"># stationData %&gt;% thermoclineDepth()</span></span></code></pre></div>
</div>
<div id="lowflowflagcolumn" class="section level4" number="3.5.12.10">
<h4><span class="header-section-number">3.5.12.10</span> lowFlowFlagColumn</h4>
<p>This helper function is new for IR2024. The function provides a flag field to the Station Table output only if a station has temperature, DO, or pH data collected on day with gage in subbasin is below 7Q10.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="individual-parameter-analyses.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to add a column to stations table output that summarizes 7Q10 information for relevant parameters</span></span>
<span id="cb97-2"><a href="individual-parameter-analyses.html#cb97-2" aria-hidden="true" tabindex="-1"></a>lowFlowFlagColumn <span class="ot">&lt;-</span> <span class="cf">function</span>(stationData){</span>
<span id="cb97-3"><a href="individual-parameter-analyses.html#cb97-3" aria-hidden="true" tabindex="-1"></a>  lowFlowFlag <span class="ot">&lt;-</span> <span class="fu">filter</span>(stationData, <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>))</span>
<span id="cb97-4"><a href="individual-parameter-analyses.html#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(lowFlowFlag) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb97-5"><a href="individual-parameter-analyses.html#cb97-5" aria-hidden="true" tabindex="-1"></a>    withParameterData <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(lowFlowFlag, FDT_STA_ID, FDT_DATE_TIME, </span>
<span id="cb97-6"><a href="individual-parameter-analyses.html#cb97-6" aria-hidden="true" tabindex="-1"></a>                                       FDT_TEMP_CELCIUS, DO_mg_L, FDT_FIELD_PH, <span class="st">`</span><span class="at">7Q10 Flag Gage</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-7"><a href="individual-parameter-analyses.html#cb97-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(FDT_STA_ID, FDT_DATE_TIME, <span class="st">`</span><span class="at">7Q10 Flag Gage</span><span class="st">`</span>), <span class="at">names_to =</span> <span class="st">&#39;parameter&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;value&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-8"><a href="individual-parameter-analyses.html#cb97-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="co"># drop rows with no data for specific parameters</span></span>
<span id="cb97-9"><a href="individual-parameter-analyses.html#cb97-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(withParameterData) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb97-10"><a href="individual-parameter-analyses.html#cb97-10" aria-hidden="true" tabindex="-1"></a>      gageFlags <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(withParameterData, FDT_STA_ID, FDT_DATE_TIME,  <span class="st">`</span><span class="at">7Q10 Flag Gage</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-11"><a href="individual-parameter-analyses.html#cb97-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">distinct</span>(FDT_DATE_TIME, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb97-12"><a href="individual-parameter-analyses.html#cb97-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">STATION_ID =</span> FDT_STA_ID, </span>
<span id="cb97-13"><a href="individual-parameter-analyses.html#cb97-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">as.Date</span>(FDT_DATE_TIME),  <span class="st">`</span><span class="at">7Q10 Flag Gage</span><span class="st">`</span>, <span class="at">collapse =</span> <span class="st">&#39;; &#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-14"><a href="individual-parameter-analyses.html#cb97-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&#39;USGS Gages in subbasin below 7Q10: &#39;</span>, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>)) </span>
<span id="cb97-15"><a href="individual-parameter-analyses.html#cb97-15" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb97-16"><a href="individual-parameter-analyses.html#cb97-16" aria-hidden="true" tabindex="-1"></a>      gageFlags <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">STATION_ID =</span> <span class="fu">unique</span>(lowFlowFlag<span class="sc">$</span>FDT_STA_ID),</span>
<span id="cb97-17"><a href="individual-parameter-analyses.html#cb97-17" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>)   }</span>
<span id="cb97-18"><a href="individual-parameter-analyses.html#cb97-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb97-19"><a href="individual-parameter-analyses.html#cb97-19" aria-hidden="true" tabindex="-1"></a>    gageFlags <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">STATION_ID =</span> <span class="fu">unique</span>(lowFlowFlag<span class="sc">$</span>FDT_STA_ID),</span>
<span id="cb97-20"><a href="individual-parameter-analyses.html#cb97-20" aria-hidden="true" tabindex="-1"></a>                        <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">NA_character_</span>)</span>
<span id="cb97-21"><a href="individual-parameter-analyses.html#cb97-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb97-22"><a href="individual-parameter-analyses.html#cb97-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gageFlags)</span>
<span id="cb97-23"><a href="individual-parameter-analyses.html#cb97-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb97-24"><a href="individual-parameter-analyses.html#cb97-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-25"><a href="individual-parameter-analyses.html#cb97-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb97-26"><a href="individual-parameter-analyses.html#cb97-26" aria-hidden="true" tabindex="-1"></a><span class="co"># where stationData is already in your environment, see Automated Assessment for environment set up help</span></span>
<span id="cb97-27"><a href="individual-parameter-analyses.html#cb97-27" aria-hidden="true" tabindex="-1"></a><span class="co">#lowFlowFlagColumn(stationData)</span></span></code></pre></div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="automated-assessment-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="automated-output.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": null
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
