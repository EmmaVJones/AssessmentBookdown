<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.3 Automated Assessment | DEQ Water Quality Automated Assessment User Guide</title>
  <meta name="description" content="A companion document describing the WQA automated assessment methodology." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3.3 Automated Assessment | DEQ Water Quality Automated Assessment User Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A companion document describing the WQA automated assessment methodology." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.3 Automated Assessment | DEQ Water Quality Automated Assessment User Guide" />
  
  <meta name="twitter:description" content="A companion document describing the WQA automated assessment methodology." />
  

<meta name="author" content="DEQ Automated Assessment Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="organize-metadata.html"/>
<link rel="next" href="automated-assessment-analysis.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="assets/book.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DEQ Water Quality Automated Assessment User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="HowToUseDocument.html"><a href="HowToUseDocument.html"><i class="fa fa-check"></i><b>1.1</b> How to Use Document</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="HowToUseDocument.html"><a href="HowToUseDocument.html#ProgrammingExpectations"><i class="fa fa-check"></i><b>1.1.1</b> Programming Expectations</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ProjectHistory.html"><a href="ProjectHistory.html"><i class="fa fa-check"></i><b>1.2</b> Project History</a></li>
<li class="chapter" data-level="1.3" data-path="wqa-technical-support-team.html"><a href="wqa-technical-support-team.html"><i class="fa fa-check"></i><b>1.3</b> WQA Technical Support Team</a></li>
<li class="chapter" data-level="1.4" data-path="Acknowledgements.html"><a href="Acknowledgements.html"><i class="fa fa-check"></i><b>1.4</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-organization.html"><a href="data-organization.html"><i class="fa fa-check"></i><b>2</b> Data Organization</a>
<ul>
<li class="chapter" data-level="2.1" data-path="conventionals-data.html"><a href="conventionals-data.html"><i class="fa fa-check"></i><b>2.1</b> Conventionals Data</a></li>
<li class="chapter" data-level="2.2" data-path="water-column-metals.html"><a href="water-column-metals.html"><i class="fa fa-check"></i><b>2.2</b> Water Column Metals</a></li>
<li class="chapter" data-level="2.3" data-path="sediment-metals.html"><a href="sediment-metals.html"><i class="fa fa-check"></i><b>2.3</b> Sediment Metals</a></li>
<li class="chapter" data-level="2.4" data-path="fish-tissue-data.html"><a href="fish-tissue-data.html"><i class="fa fa-check"></i><b>2.4</b> Fish Tissue Data</a></li>
<li class="chapter" data-level="2.5" data-path="pcb-data.html"><a href="pcb-data.html"><i class="fa fa-check"></i><b>2.5</b> PCB Data</a></li>
<li class="chapter" data-level="2.6" data-path="vdh-data.html"><a href="vdh-data.html"><i class="fa fa-check"></i><b>2.6</b> VDH Data</a></li>
<li class="chapter" data-level="2.7" data-path="citizen-monitoring-data.html"><a href="citizen-monitoring-data.html"><i class="fa fa-check"></i><b>2.7</b> Citizen Monitoring Data</a></li>
<li class="chapter" data-level="2.8" data-path="station-metadata.html"><a href="station-metadata.html"><i class="fa fa-check"></i><b>2.8</b> Station Metadata</a></li>
<li class="chapter" data-level="2.9" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html"><i class="fa fa-check"></i><b>2.9</b> Low Flow (7Q10) Data</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#q10-method"><i class="fa fa-check"></i><b>2.9.1</b> 7Q10 Method</a></li>
<li class="chapter" data-level="2.9.2" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#usgs-site-data-gathering"><i class="fa fa-check"></i><b>2.9.2</b> USGS Site Data Gathering</a></li>
<li class="chapter" data-level="2.9.3" data-path="low-flow-7q10-data.html"><a href="low-flow-7q10-data.html#important-7q10-calculation-notes"><i class="fa fa-check"></i><b>2.9.3</b> Important 7Q10 Calculation Notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="automated-assessment-methods.html"><a href="automated-assessment-methods.html"><i class="fa fa-check"></i><b>3</b> Automated Assessment Methods</a>
<ul>
<li class="chapter" data-level="3.1" data-path="metadata-attribution.html"><a href="metadata-attribution.html"><i class="fa fa-check"></i><b>3.1</b> Metadata Attribution</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="metadata-attribution.html"><a href="metadata-attribution.html#distinct-sites"><i class="fa fa-check"></i><b>3.1.1</b> Distinct Sites</a></li>
<li class="chapter" data-level="3.1.2" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-assessment-region-and-subbasin-information"><i class="fa fa-check"></i><b>3.1.2</b> Join Assessment Region and Subbasin Information</a></li>
<li class="chapter" data-level="3.1.3" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-stations-to-wqs"><i class="fa fa-check"></i><b>3.1.3</b> Join Stations to WQS</a></li>
<li class="chapter" data-level="3.1.4" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-stations-to-aus"><i class="fa fa-check"></i><b>3.1.4</b> Join Stations to AUs</a></li>
<li class="chapter" data-level="3.1.5" data-path="metadata-attribution.html"><a href="metadata-attribution.html#where-does-this-information-go"><i class="fa fa-check"></i><b>3.1.5</b> Where does this information go?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="organize-metadata.html"><a href="organize-metadata.html"><i class="fa fa-check"></i><b>3.2</b> Organize Metadata</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="organize-metadata.html"><a href="organize-metadata.html#reorganize-conventionals-dataset"><i class="fa fa-check"></i><b>3.2.1</b> Reorganize Conventionals Dataset</a></li>
<li class="chapter" data-level="3.2.2" data-path="organize-metadata.html"><a href="organize-metadata.html#adding-secchi-depth-to-conventionals-dataset"><i class="fa fa-check"></i><b>3.2.2</b> Adding Secchi Depth to conventionals dataset</a></li>
<li class="chapter" data-level="3.2.3" data-path="organize-metadata.html"><a href="organize-metadata.html#add-citizen-monitoring-data-to-conventionals"><i class="fa fa-check"></i><b>3.2.3</b> Add Citizen Monitoring Data to conventionals</a></li>
<li class="chapter" data-level="3.2.4" data-path="organize-metadata.html"><a href="organize-metadata.html#ensure-all-stations-have-necessary-wqs-and-au-information"><i class="fa fa-check"></i><b>3.2.4</b> Ensure all stations have necessary WQS and AU information</a></li>
<li class="chapter" data-level="3.2.5" data-path="organize-metadata.html"><a href="organize-metadata.html#clean-up-pcb-dataset"><i class="fa fa-check"></i><b>3.2.5</b> Clean up PCB dataset</a></li>
<li class="chapter" data-level="3.2.6" data-path="organize-metadata.html"><a href="organize-metadata.html#clean-up-fish-tissue-dataset"><i class="fa fa-check"></i><b>3.2.6</b> Clean up Fish Tissue dataset</a></li>
<li class="chapter" data-level="3.2.7" data-path="organize-metadata.html"><a href="organize-metadata.html#pin-official-clean-ir-data-to-r-server"><i class="fa fa-check"></i><b>3.2.7</b> Pin Official Clean IR data to R server</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="automated-assessment.html"><a href="automated-assessment.html"><i class="fa fa-check"></i><b>3.3</b> Automated Assessment</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="automated-assessment.html"><a href="automated-assessment.html#bring-in-required-datasets"><i class="fa fa-check"></i><b>3.3.1</b> Bring in required datasets</a></li>
<li class="chapter" data-level="3.3.2" data-path="automated-assessment.html"><a href="automated-assessment.html#attach-wqs-information"><i class="fa fa-check"></i><b>3.3.2</b> Attach WQS information</a></li>
<li class="chapter" data-level="3.3.3" data-path="automated-assessment.html"><a href="automated-assessment.html#identify-station-type"><i class="fa fa-check"></i><b>3.3.3</b> Identify Station Type</a></li>
<li class="chapter" data-level="3.3.4" data-path="automated-assessment.html"><a href="automated-assessment.html#bring-in-low-flow-information"><i class="fa fa-check"></i><b>3.3.4</b> Bring in Low Flow Information</a></li>
<li class="chapter" data-level="3.3.5" data-path="automated-assessment.html"><a href="automated-assessment.html#metals-reoganization"><i class="fa fa-check"></i><b>3.3.5</b> Metals Reoganization</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="automated-assessment-analysis.html"><a href="automated-assessment-analysis.html"><i class="fa fa-check"></i><b>3.4</b> Automated Assessment Analysis</a></li>
<li class="chapter" data-level="3.5" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html"><i class="fa fa-check"></i><b>3.5</b> Individual Parameter Analyses</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#how-to-test-individual-parameter-functions"><i class="fa fa-check"></i><b>3.5.1</b> How to Test Individual Parameter Functions</a></li>
<li class="chapter" data-level="3.5.2" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#temperature"><i class="fa fa-check"></i><b>3.5.2</b> Temperature</a></li>
<li class="chapter" data-level="3.5.3" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#dissolved-oxygen"><i class="fa fa-check"></i><b>3.5.3</b> Dissolved Oxygen</a></li>
<li class="chapter" data-level="3.5.4" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#ph"><i class="fa fa-check"></i><b>3.5.4</b> pH</a></li>
<li class="chapter" data-level="3.5.5" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#bacteria"><i class="fa fa-check"></i><b>3.5.5</b> Bacteria</a></li>
<li class="chapter" data-level="3.5.6" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#nutrients"><i class="fa fa-check"></i><b>3.5.6</b> Nutrients</a></li>
<li class="chapter" data-level="3.5.7" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#ammonia"><i class="fa fa-check"></i><b>3.5.7</b> Ammonia</a></li>
<li class="chapter" data-level="3.5.8" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#water-column-toxics"><i class="fa fa-check"></i><b>3.5.8</b> Water Column Toxics</a></li>
<li class="chapter" data-level="3.5.9" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#public-water-supply-criteria"><i class="fa fa-check"></i><b>3.5.9</b> Public Water Supply Criteria</a></li>
<li class="chapter" data-level="3.5.10" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#freshwater-chloride"><i class="fa fa-check"></i><b>3.5.10</b> Freshwater Chloride</a></li>
<li class="chapter" data-level="3.5.11" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#pcb"><i class="fa fa-check"></i><b>3.5.11</b> PCB</a></li>
<li class="chapter" data-level="3.5.12" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#water-column-metals-1"><i class="fa fa-check"></i><b>3.5.12</b> Water Column Metals</a></li>
<li class="chapter" data-level="3.5.13" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#fish-tissue"><i class="fa fa-check"></i><b>3.5.13</b> Fish Tissue</a></li>
<li class="chapter" data-level="3.5.14" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#benthics"><i class="fa fa-check"></i><b>3.5.14</b> Benthics</a></li>
<li class="chapter" data-level="3.5.15" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#additional-functions"><i class="fa fa-check"></i><b>3.5.15</b> Additional Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="automated-output.html"><a href="automated-output.html"><i class="fa fa-check"></i><b>3.6</b> Automated Output</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regional-metadata-validation-tool-how-to.html"><a href="regional-metadata-validation-tool-how-to.html"><i class="fa fa-check"></i><b>4</b> Regional Metadata Validation <br>Tool How To</a>
<ul>
<li class="chapter" data-level="4.1" data-path="application-orientation.html"><a href="application-orientation.html"><i class="fa fa-check"></i><b>4.1</b> Application Orientation</a></li>
<li class="chapter" data-level="4.2" data-path="application-use-water-quality-standards-qa-watershed-selection-tab.html"><a href="application-use-water-quality-standards-qa-watershed-selection-tab.html"><i class="fa fa-check"></i><b>4.2</b> Application Use: <br>Water Quality Standards QA- <br>Watershed Selection Tab</a></li>
<li class="chapter" data-level="4.3" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html"><i class="fa fa-check"></i><b>4.3</b> Application Use: <br>Water Quality Standards QA- <br>Manual Review Tab</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#map-orientation"><i class="fa fa-check"></i><b>4.3.1</b> Map Orientation</a></li>
<li class="chapter" data-level="4.3.2" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#what-do-the-buttons-do"><i class="fa fa-check"></i><b>4.3.2</b> What do the buttons do?</a></li>
<li class="chapter" data-level="4.3.3" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation"><i class="fa fa-check"></i><b>4.3.3</b> Application Operation</a></li>
<li class="chapter" data-level="4.3.4" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-1-wqs-segment"><i class="fa fa-check"></i><b>4.3.4</b> Application Operation: <br>Station that Snapped to 1 WQS Segment</a></li>
<li class="chapter" data-level="4.3.5" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-1-wqs-segment-1"><i class="fa fa-check"></i><b>4.3.5</b> Application Operation: <br>Station that Snapped to &gt;1 WQS Segment</a></li>
<li class="chapter" data-level="4.3.6" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-0-wqs-segments"><i class="fa fa-check"></i><b>4.3.6</b> Application Operation: <br>Station that Snapped to 0 WQS Segments</a></li>
<li class="chapter" data-level="4.3.7" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-there-are-no-more-stations-to-attribute"><i class="fa fa-check"></i><b>4.3.7</b> Application Operation: <br>There are no more stations to attribute</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="having-problems.html"><a href="having-problems.html"><i class="fa fa-check"></i><b>4.4</b> Having problems?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="riverine-application-how-to.html"><a href="riverine-application-how-to.html"><i class="fa fa-check"></i><b>5</b> Riverine Application How To</a>
<ul>
<li class="chapter" data-level="5.1" data-path="application-orientation-1.html"><a href="application-orientation-1.html"><i class="fa fa-check"></i><b>5.1</b> Application Orientation</a></li>
<li class="chapter" data-level="5.2" data-path="application-use-data-upload-tab.html"><a href="application-use-data-upload-tab.html"><i class="fa fa-check"></i><b>5.2</b> Application Use: Data Upload Tab</a></li>
<li class="chapter" data-level="5.3" data-path="application-use-watershed-selection-tab.html"><a href="application-use-watershed-selection-tab.html"><i class="fa fa-check"></i><b>5.3</b> Application Use: Watershed Selection Tab</a></li>
<li class="chapter" data-level="5.4" data-path="application-use-assessment-unit-review-tab.html"><a href="application-use-assessment-unit-review-tab.html"><i class="fa fa-check"></i><b>5.4</b> Application Use: Assessment Unit Review Tab</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="application-use-assessment-unit-review-tab.html"><a href="application-use-assessment-unit-review-tab.html#conventionals-data-tab"><i class="fa fa-check"></i><b>5.4.1</b> Conventionals Data Tab</a></li>
<li class="chapter" data-level="5.4.2" data-path="application-use-assessment-unit-review-tab.html"><a href="application-use-assessment-unit-review-tab.html#benthic-data-tab"><i class="fa fa-check"></i><b>5.4.2</b> Benthic Data Tab</a></li>
<li class="chapter" data-level="5.4.3" data-path="application-use-assessment-unit-review-tab.html"><a href="application-use-assessment-unit-review-tab.html#metals-data-tab"><i class="fa fa-check"></i><b>5.4.3</b> Metals Data Tab</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="lacustrine-application-how-to.html"><a href="lacustrine-application-how-to.html"><i class="fa fa-check"></i><b>6</b> Lacustrine Application How To</a></li>
<li class="chapter" data-level="7" data-path="bioassessment-applications-how-to.html"><a href="bioassessment-applications-how-to.html"><i class="fa fa-check"></i><b>7</b> Bioassessment Applications How To</a>
<ul>
<li class="chapter" data-level="7.1" data-path="general-bioassessment-workflow.html"><a href="general-bioassessment-workflow.html"><i class="fa fa-check"></i><b>7.1</b> General Bioassessment Workflow</a></li>
<li class="chapter" data-level="7.2" data-path="application-use-bioassessment-dashboard.html"><a href="application-use-bioassessment-dashboard.html"><i class="fa fa-check"></i><b>7.2</b> Application Use: Bioassessment Dashboard</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="application-use-bioassessment-dashboard.html"><a href="application-use-bioassessment-dashboard.html#map-tab"><i class="fa fa-check"></i><b>7.2.1</b> Map Tab</a></li>
<li class="chapter" data-level="7.2.2" data-path="application-use-bioassessment-dashboard.html"><a href="application-use-bioassessment-dashboard.html#sci-scores-tab"><i class="fa fa-check"></i><b>7.2.2</b> SCI Scores Tab</a></li>
<li class="chapter" data-level="7.2.3" data-path="application-use-bioassessment-dashboard.html"><a href="application-use-bioassessment-dashboard.html#habitat-scores-tab"><i class="fa fa-check"></i><b>7.2.3</b> Habitat Scores Tab</a></li>
<li class="chapter" data-level="7.2.4" data-path="application-use-bioassessment-dashboard.html"><a href="application-use-bioassessment-dashboard.html#station-summary-tab"><i class="fa fa-check"></i><b>7.2.4</b> Station Summary Tab</a></li>
<li class="chapter" data-level="7.2.5" data-path="application-use-bioassessment-dashboard.html"><a href="application-use-bioassessment-dashboard.html#assessment-decision-tab"><i class="fa fa-check"></i><b>7.2.5</b> Assessment Decision Tab</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="application-use-benthic-assessment-fact-sheet-tool.html"><a href="application-use-benthic-assessment-fact-sheet-tool.html"><i class="fa fa-check"></i><b>7.3</b> Application Use: Benthic Assessment Fact Sheet Tool</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="application-use-benthic-assessment-fact-sheet-tool.html"><a href="application-use-benthic-assessment-fact-sheet-tool.html#assessment-fact-sheet-tab"><i class="fa fa-check"></i><b>7.3.1</b> Assessment Fact Sheet Tab</a></li>
<li class="chapter" data-level="7.3.2" data-path="application-use-benthic-assessment-fact-sheet-tool.html"><a href="application-use-benthic-assessment-fact-sheet-tool.html#general-purpose-biological-fact-sheet-tab"><i class="fa fa-check"></i><b>7.3.2</b> General Purpose Biological Fact Sheet Tab</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DEQ Water Quality Automated Assessment User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="automated-assessment" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Automated Assessment</h2>
<p>Now that data are prepped for analysis, the last step is to bring all the data together, complete a few more manipulation steps, and feed the data through a process that assesses the data. To minimize the level of coding experience required to run the automated assessment process, the operation is written as a loop instead of as a function. Loops are inherently slow and sometimes confusing, but for this specific use case housing all operations inside a single loop increases the visibility of the order of operations and decreases the amount of coding experience users need to understand what is happening when. All individual parameter analyses are programmed as efficient functions and are detailed in the <a href="individual-parameter-analyses.html#individual-parameter-analyses">Individual Parameter Analyses</a> section.</p>
<p>As always, first set up your local environment with all the necessary packages you will use, source any necessary scripts, and connect to the R server to pull pinned data.</p>
<p>The custom assessment functions brought in below are stored in separate .R files and “sourced” into this script. This is a best practice to enable easier maintenance of the custom assessment functions as well as minimize the amount of code in this Rmarkdown document. When you source the scripts, you will see all the functions in your Environment pane. This is different than when we call in a package because one cannot see all the functions in a loaded package in their Environment pane. DEQ is working towards publishing an automated assessment package to neatly distribute all these custom functions. Until then, you can download these sourced scripts <a href="https://github.com/EmmaVJones/IR2024/tree/main/3.automatedAssessment" target="_blank">here</a>. You can download the latest working copy of the automated assessment workflow in a single Rmarkdown document <a href="https://github.com/EmmaVJones/IR2024/blob/main/3.automatedAssessment/HowToRunAutomatedAssessmentIR2024.Rmd" target="_blank">here</a>.</p>
<p>An important feature of this script is in the first line of code: <code>options(digits = 12)</code>. This set our local environment options and tells R to use 12 digits when storing numeric information. It is critical to store all potential digits of numeric data to not impose intermediate rounding steps and potentially skew results. Steps like these allow for statewide consistency. Spreadsheet and database software do not easily allow this level of calculation control. It is important to note that some tidyverse default printing behavior might make it appear that numerical data are rounded to only three digits. This is a feature for fast and clear data printing and does not reflect the true nature of the numeric data stored in your environment after establishing the <code>options(digits = 12)</code> environment option. You can always double check the numeric data by printing the full object (e.g. datasetIamWorkingWith$numericalColumnIwantToInvestigateFurther).</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="automated-assessment.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">12</span>) <span class="co"># critical to seeing all the data</span></span>
<span id="cb66-2"><a href="automated-assessment.html#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="automated-assessment.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb66-4"><a href="automated-assessment.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb66-5"><a href="automated-assessment.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb66-6"><a href="automated-assessment.html#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pins)</span>
<span id="cb66-7"><a href="automated-assessment.html#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(config)</span>
<span id="cb66-8"><a href="automated-assessment.html#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnvStats)</span>
<span id="cb66-9"><a href="automated-assessment.html#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb66-10"><a href="automated-assessment.html#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(round) <span class="co"># for correct round to even logic</span></span>
<span id="cb66-11"><a href="automated-assessment.html#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="automated-assessment.html#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Bring in custom assessment functions</span></span>
<span id="cb66-13"><a href="automated-assessment.html#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;automatedAssessmentFunctions.R&#39;</span>)</span>
<span id="cb66-14"><a href="automated-assessment.html#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;updatedBacteriaCriteria.R&#39;</span>)</span>
<span id="cb66-15"><a href="automated-assessment.html#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="automated-assessment.html#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co"># get configuration settings</span></span>
<span id="cb66-17"><a href="automated-assessment.html#cb66-17" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> config<span class="sc">::</span><span class="fu">get</span>(<span class="st">&quot;connectionSettings&quot;</span>)</span>
<span id="cb66-18"><a href="automated-assessment.html#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="automated-assessment.html#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="co"># use API key to register board</span></span>
<span id="cb66-20"><a href="automated-assessment.html#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="fu">board_register_rsconnect</span>(<span class="at">key =</span> conn<span class="sc">$</span>CONNECT_API_KEY,  </span>
<span id="cb66-21"><a href="automated-assessment.html#cb66-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">server =</span> conn<span class="sc">$</span>CONNECT_SERVER)</span></code></pre></div>
<div id="bring-in-required-datasets" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Bring in required datasets</h3>
<p>Bring in pinned data and local data. <strong>This section is still being actively written, stay tuned for an update with final IR2024 data.</strong></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="automated-assessment.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># official March Data releases for IR 2022</span></span>
<span id="cb67-2"><a href="automated-assessment.html#cb67-2" aria-hidden="true" tabindex="-1"></a>conventionals <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&#39;ejones/conventionals2024draft&#39;</span>, <span class="at">board =</span> <span class="st">&#39;rsconnect&#39;</span>) </span>
<span id="cb67-3"><a href="automated-assessment.html#cb67-3" aria-hidden="true" tabindex="-1"></a>conventionals_distinct <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&#39;ejones/conventionals2024_distinctdraft&#39;</span>, <span class="at">board =</span> <span class="st">&#39;rsconnect&#39;</span>) </span>
<span id="cb67-4"><a href="automated-assessment.html#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="automated-assessment.html#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co">#old will update</span></span>
<span id="cb67-6"><a href="automated-assessment.html#cb67-6" aria-hidden="true" tabindex="-1"></a>stations2020IR <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&quot;stations2020IR-sf-final&quot;</span>, <span class="at">board =</span> <span class="st">&quot;rsconnect&quot;</span>)</span>
<span id="cb67-7"><a href="automated-assessment.html#cb67-7" aria-hidden="true" tabindex="-1"></a>WQMstationFull <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&quot;WQM-Station-Full&quot;</span>, <span class="at">board =</span> <span class="st">&quot;rsconnect&quot;</span>)</span>
<span id="cb67-8"><a href="automated-assessment.html#cb67-8" aria-hidden="true" tabindex="-1"></a>VSCIresults <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&quot;VSCIresults&quot;</span>, <span class="at">board =</span> <span class="st">&quot;rsconnect&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-9"><a href="automated-assessment.html#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="fu">between</span>(<span class="st">`</span><span class="at">Collection Date</span><span class="st">`</span>, assessmentPeriod[<span class="dv">1</span>], assessmentPeriod[<span class="dv">2</span>]) )</span>
<span id="cb67-10"><a href="automated-assessment.html#cb67-10" aria-hidden="true" tabindex="-1"></a>VCPMI63results <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&quot;VCPMI63results&quot;</span>, <span class="at">board =</span> <span class="st">&quot;rsconnect&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-11"><a href="automated-assessment.html#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="fu">between</span>(<span class="st">`</span><span class="at">Collection Date</span><span class="st">`</span>, assessmentPeriod[<span class="dv">1</span>], assessmentPeriod[<span class="dv">2</span>]) )</span>
<span id="cb67-12"><a href="automated-assessment.html#cb67-12" aria-hidden="true" tabindex="-1"></a>VCPMI65results <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&quot;VCPMI65results&quot;</span>, <span class="at">board =</span> <span class="st">&quot;rsconnect&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="automated-assessment.html#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="fu">between</span>(<span class="st">`</span><span class="at">Collection Date</span><span class="st">`</span>, assessmentPeriod[<span class="dv">1</span>], assessmentPeriod[<span class="dv">2</span>]) ) </span>
<span id="cb67-14"><a href="automated-assessment.html#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="co"># placeholders from IR2022 until draft or final IR2024 data are available</span></span>
<span id="cb67-15"><a href="automated-assessment.html#cb67-15" aria-hidden="true" tabindex="-1"></a>WCmetals <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&quot;WCmetals-2022IRfinal&quot;</span>,  <span class="at">board =</span> <span class="st">&quot;rsconnect&quot;</span>)</span>
<span id="cb67-16"><a href="automated-assessment.html#cb67-16" aria-hidden="true" tabindex="-1"></a>Smetals <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&quot;Smetals-2022IRfinal&quot;</span>,  <span class="at">board =</span> <span class="st">&quot;rsconnect&quot;</span>)</span>
<span id="cb67-17"><a href="automated-assessment.html#cb67-17" aria-hidden="true" tabindex="-1"></a>markPCB <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;data/2022 IR PCBDatapull_EVJ.xlsx&#39;</span>, <span class="at">sheet =</span> <span class="st">&#39;2022IR Datapull EVJ&#39;</span>) <span class="co"># will be pinned data for IR2024</span></span>
<span id="cb67-18"><a href="automated-assessment.html#cb67-18" aria-hidden="true" tabindex="-1"></a>fishPCB <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;data/FishTissuePCBsMetals_EVJ.xlsx&#39;</span>, <span class="at">sheet=</span> <span class="st">&#39;PCBs&#39;</span>) <span class="co"># will be pinned data for IR2024</span></span>
<span id="cb67-19"><a href="automated-assessment.html#cb67-19" aria-hidden="true" tabindex="-1"></a>fishMetals <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;data/FishTissuePCBsMetals_EVJ.xlsx&#39;</span>, <span class="at">sheet=</span> <span class="st">&#39;Metals&#39;</span>) <span class="co"># will be pinned data for IR2024</span></span></code></pre></div>
<p>Bring in the Station Table from the two most recent assessment cycles. The comment field from each of these datasets is joined to the Station Table output to assist regional assessment staff.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="automated-assessment.html#cb68-1" aria-hidden="true" tabindex="-1"></a>stationsTable2022 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;../2.organizeMetadata/data/stationsTable2022.RDS&#39;</span>)</span>
<span id="cb68-2"><a href="automated-assessment.html#cb68-2" aria-hidden="true" tabindex="-1"></a>stationsTable2020 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;../2.organizeMetadata/data/stationsTable2020.RDS&#39;</span>)</span></code></pre></div>
<p>Bring in lake nutrient standards. The lake-specific nutrient criteria are stored separate from WQS spatial data because these fields do not exist in the WQS spatial layers. Lake names in the WQS spatial layers are notoriously difficult to join against because of all the variation in names. As such, this dataset contains a special joining name field <code>Lake_Name</code> to clean up joining issues.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="automated-assessment.html#cb69-1" aria-hidden="true" tabindex="-1"></a>lakeNutStandards <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&#39;exampleData/9VAC25-260-187lakeNutrientStandards.csv&#39;</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   Lake_Name = col_character(),
##   `Man-made Lake or Reservoir Name` = col_character(),
##   Location = col_character(),
##   `Chlorophyll a (ug/L)` = col_double(),
##   `Total Phosphorus (ug/L)` = col_double()
## )</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="automated-assessment.html#cb71-1" aria-hidden="true" tabindex="-1"></a>lakeNutStandards <span class="sc">%&gt;%</span> <span class="co"># preview dataset</span></span>
<span id="cb71-2"><a href="automated-assessment.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">rownames =</span> F, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">&#39;lftip&#39;</span>, <span class="at">pageLength =</span> <span class="dv">5</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div id="htmlwidget-721aba63e187320edfeb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-721aba63e187320edfeb">{"x":{"filter":"none","data":[["Abel Lake","Airfield Pond","Amelia Lake","Aquia Reservoir (Smith Lake)","Bark Camp Lake","Beaver Creek Reservoir","Beaverdam Reservoir (XKD)","Beaverdam Reservoir","Bedford (Stony Creek) Reservoir","Big Cherry Lake","Breckenridge Reservoir","Briery Creek Lake","Brunswick Lake (County Pond)","Burke Lake","Carvin Cove Reservoir","Cherrystone Reservoir","Chickahominy Lake","Chris Green Lake","Claytor Lake","Smith Creek Reservoir (Clifton Forge)","Coles Run Reservoir","Curtis Lake","Diascund Creek Reservoir","Douthat Lake","Elkhorn Lake","Emporia Lake (Meherrin Reservoir)","Fairystone Lake","Falling Creek Reservoir","Fluvanna Ruritan Lake","Fort Pickett Reservoir","Gatewood Reservoir","Georges Creek Reservoir","Goose Creek Reservoir","Graham Creek Reservoir","Great Creek Reservoir","Harrison Lake","Harwood Mills Reservoir","Hidden Valley Lake","Hogan Lake","Holiday Lake","Hungry Mother Lake","Hunting Run Reservoir","John Flannagan Reservoir","Kerr Reservoir","Keysville Reservoir","Lake Albemarle","Lake Anna","Lake Arrowhead","Lake Burnt Mills","Lake Chesdin","Lake Cohoon","Lake Conner","Lake Frederick","Lake Gaston","Lake Gordon","Lake Keokee","Lake Kilby","Lake Lawson","Lake Manassas","Lake Meade","Lake Moomaw","Lake Nelson","Lake Nottoway (Lee Lake)","Lake Orange","Lake Pelham","Lake Prince","Lake Robertson","Lake Smith","Lake Whitehurst","Lake Wright","Lakeview Reservoir","Laurel Bed Lake","Lee Hall Reservoir","Leesville Lake","Little Creek Reservoir (VBC)","Little Creek Reservoir (JCC)","Little River Reservoir","Lone Star Lake F (Crystal Lake)","Lone Star Lake G (Crane Lake)","Lone Star Lake I (Butler Lake)","Lunga Reservoir","Lunenburg Beach Lake","Martinsville Reservoir (Beaver Creek Reservoir)","Mill Creek Reservoir","Modest Creek Reservoir","Motts Run Reservoir","Mount Jackson Reservoir","Mountain Run Lake","Ni River Reservoir","North Fork Pound Reservoir","Northeast Creek Reservoir","Occoquan Reservoir","Pedlar Lake","Philpott Reservoir","Phelps Creek Reservoir","Powhatan Lakes","Ragged Mountain Reservoir","Rivanna Reservoir (South Fork Rivanna Reservoir)","Roaring Fork","Rural Retreat Lake","Sandy River Reservoir","Shenandoah Lake","Silver Lake","Smith Mountain Lake","South Holston Reservoir","Speights Run Lake","Spring Hollow Reservoir","Staunton Dam Lake","Stonehouse Creek Reservoir","Strasburg Reservoir","Stumpy Lake","Sugar Hollow Reservoir","Swift Creek Lake","Swift Creek Reservoir","Switzer Lake","Talbott Reservoir","Thrashers Creek Reservoir","Totier Creek Reservoir","Townes Reservoir","Troublesome Creek Reservoir","Waller Mill Reservoir","Western Branch Reservoir","Wise Reservoir"],["Abel Lake","Airfield Pond","Amelia Lake","Aquia Reservoir (Smith Lake)","Bark Camp Lake (Corder Bottom Lake, Lee/Scott/Wise Lake)","Beaver Creek Reservoir","Beaverdam Creek Reservoir (Beaverdam Reservoir)","Beaverdam Reservoir","Bedford Reservoir (Stony Creek Reservoir)","Big Cherry Lake","Breckenridge Reservoir","Briery Creek Lake","Brunswick Lake (County Pond)","Burke Lake","Carvin Cove Reservoir","Cherrystone Reservoir","Chickahominy Lake","Chris Green Lake","Claytor Lake","Clifton Forge Reservoir (Smith Creek Reservoir)","Coles Run Reservoir","Curtis Lake","Diascund Creek Reservoir","Douthat Lake","Elkhorn Lake","Emporia Lake (Meherrin Reservoir)","Fairystone Lake","Falling Creek Reservoir","Fluvanna Ruritan Lake","Fort Pickett Reservoir","Gatewood Reservoir","Georges Creek Reservoir","Goose Creek Reservoir","Graham Creek Reservoir","Great Creek Reservoir","Harrison Lake","Harwood Mills Reservoir","Hidden Valley Lake","Hogan Lake","Holiday Lake","Hungry Mother Lake","Hunting Run Reservoir","J. W. Flannagan Reservoir","Kerr Reservoir, Virginia portion (Buggs Island Lake)","Keysville Reservoir","Lake Albemarle","Lake Anna","Lake Arrowhead","Lake Burnt Mills","Lake Chesdin","Lake Cohoon","Lake Conner","Lake Frederick","Lake Gaston, (Virginia portion)","Lake Gordon","Lake Keokee","Lake Kilby","Lake Lawson","Lake Manassas","Lake Meade","Lake Moomaw","Lake Nelson","Lake Nottoway (Lee Lake, Nottoway Lake)","Lake Orange","Lake Pelham","Lake Prince","Lake Robertson","Lake Smith","Lake Whitehurst","Lake Wright","Lakeview Reservoir","Laurel Bed Lake","Lee Hall Reservoir (Newport News Reservoir)","Leesville Reservoir","Little Creek Reservoir","Little Creek Reservoir","Little River Reservoir","Lone Star Lake F (Crystal Lake)","Lone Star Lake G (Crane Lake)","Lone Star Lake I (Butler Lake)","Lunga Reservoir","Lunenburg Beach Lake (Victoria Lake)","Martinsville Reservoir (Beaver Creek Reservoir)","Mill Creek Reservoir","Modest Creek Reservoir","Motts Run Reservoir","Mount Jackson Reservoir","Mountain Run Lake","Ni Reservoir","North Fork Pound Reservoir","Northeast Creek Reservoir","Occoquan Reservoir","Pedlar Lake","Philpott Reservoir","Phelps Creek Reservoir (Brookneal Reservoir)","Powhatan Lakes (Upper and Lower)","Ragged Mountain Reservoir","Rivanna Reservoir (South Fork Rivanna Reservoir)","Roaring Fork","Rural Retreat Lake","Sandy River Reservoir","Shenandoah Lake","Silver Lake","Smith Mountain Lake","South Holston Reservoir","Speights Run Lake","Spring Hollow Reservoir","Staunton Dam Lake","Stonehouse Creek Reservoir","Strasburg Reservoir","Stumpy Lake","Sugar Hollow Reservoir","Swift Creek Lake","Swift Creek Reservoir","Switzer Lake","Talbott Reservoir","Thrashers Creek Reservoir","Totier Creek Reservoir","Townes Reservoir","Troublesome Creek Reservoir","Waller Mill Reservoir","Western Branch Reservoir","Wise Reservoir"],["Stafford County","Sussex County","Amelia County","Stafford County","Scott County","Albemarle County","Bedford County","Loudoun County","Bedford County","Wise County","Prince William County","Prince Edward County","Brunswick County","Fairfax County","Botetourt County","Pittsylvania County","Charles City County","Albemarle County","Pulaski County","Alleghany County","Augusta County","Stafford County","New Kent County","Bath County","Augusta County","Greensville County","Henry County","Chesterfield County","Fluvanna County","Nottoway/Brunswick County","Pulaski County","Pittsylvania County","Loudoun County","Amherst County","Lawrenceville","Charles City County","York County","Washington County","Pulaski County","Appomattox County","Smyth County","Spotsylvania County","Dickenson County","Halifax County","Charlotte County","Albemarle County","Louisa County","Page County","Isle of Wight County","Chesterfield County","Suffolk City","Halifax County","Frederick County","Brunswick County","Mecklenburg County","Lee County","Suffolk City","Virginia Beach City","Prince William County","Suffolk City","Bath County","Nelson County","Nottoway County","Orange County","Culpeper County","Suffolk City","Rockbridge County","Virginia Beach City","Norfolk City","Norfolk City","Chesterfield County","Russell County","Newport News City","Bedford County","Virginia Beach City","James City County","Montgomery County","Suffolk City","Suffolk City","Suffolk City","Prince William County","Town of Victoria","Henry County","Amherst County","Town of Victoria","Spotsylvania County","Shenandoah County","Culpeper County","Spotsylvania County","Wise County","Louisa County","Fairfax County","Amherst County","Henry County","Campbell County","Powhatan County","Albemarle County","Albemarle County","Pittsylvania County","Wythe County","Prince Edward County","Rockingham County","Rockingham County","Bedford County","Washington County","Suffolk City","Roanoke County","Augusta County","Amherst County","Shenandoah County","Virginia Beach","Albemarle County","Chesterfield County","Chesterfield County","Rockingham County","Patrick County","Amherst County","Albemarle County","Patrick County","Buckingham County","York County","Suffolk City","Wise County"],[35,35,35,35,35,35,35,35,35,35,35,35,35,60,35,35,35,35,25,35,10,60,35,25,10,35,35,35,60,35,35,35,35,35,35,35,60,35,35,35,35,35,25,25,35,35,25,35,60,35,60,35,35,25,35,35,60,60,35,60,10,60,35,60,35,60,35,60,60,60,35,35,60,25,60,25,35,60,60,60,35,35,35,35,35,25,35,35,35,35,35,35,25,25,35,35,35,35,35,35,35,35,35,25,25,60,25,35,60,35,60,25,35,35,10,35,35,35,25,35,25,25,25],[40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,20,20,10,40,40,20,10,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,20,30,40,40,30,40,40,40,40,40,40,30,40,40,40,40,40,40,10,40,40,40,40,40,40,40,40,40,40,40,40,30,40,30,40,40,40,40,40,40,40,40,40,30,40,40,40,40,40,40,20,30,40,40,40,40,40,40,40,40,40,30,20,40,20,40,40,40,40,20,40,40,10,40,40,40,20,40,30,20,20]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Lake_Name<\/th>\n      <th>Man-made Lake or Reservoir Name<\/th>\n      <th>Location<\/th>\n      <th>Chlorophyll a (ug/L)<\/th>\n      <th>Total Phosphorus (ug/L)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"lftip","pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Bring in beginning station table data. This information communicates to the scripts which stations should be assessed and where they should be organized (AUs). It also has data from the last cycle to populate the historical station information table in the application.</p>
<p><strong>To Note: The AU assignments in this table are valid as of the start of the assessment process. For any AU splits/reassignments, the assessors control that through local (.csv) copies of the output of this script that is uploaded to the relevant Assessment Application on the Connect Server (and subsequently uploaded to CEDS via the bulk data upload tool).</strong></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="automated-assessment.html#cb72-1" aria-hidden="true" tabindex="-1"></a>stationTable <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&#39;ejones/stationsTable2024begin&#39;</span>, <span class="at">board =</span> <span class="st">&#39;rsconnect&#39;</span>)</span></code></pre></div>
<p>Bring in Station Table Bulk Upload Template. This is the template format to match such that output from this script can be easily uploaded to CEDS via the Bulk Data Upload tool. Any deviations to this template in the output dataset were specifically requested by regional assessment staff to improve and expedite their review process. They are responsible for removing those added fields prior to bulk data upload.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="automated-assessment.html#cb73-1" aria-hidden="true" tabindex="-1"></a>stationsTemplate <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;WQA_CEDS_templates/WQA_Bulk_Station_Upload_Final.xlsx&#39;</span>,<span class="co">#&#39;WQA_CEDS_templates/WQA_Bulk_Station_Upload (3).xlsx&#39;, </span></span>
<span id="cb73-2"><a href="automated-assessment.html#cb73-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sheet =</span> <span class="st">&#39;Stations&#39;</span>, <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span>)[<span class="dv">0</span>,] <span class="sc">%&gt;%</span> </span>
<span id="cb73-3"><a href="automated-assessment.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">LATITUDE =</span> <span class="fu">as.numeric</span>(LATITUDE), <span class="at">LONGITUDE =</span> <span class="fu">as.numeric</span>(LONGITUDE)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="automated-assessment.html#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(<span class="st">&#39;_EXC&#39;</span>)), as.integer) <span class="sc">%&gt;%</span> </span>
<span id="cb73-5"><a href="automated-assessment.html#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(<span class="st">&#39;_SAMP&#39;</span>)), as.integer) <span class="sc">%&gt;%</span> </span>
<span id="cb73-6"><a href="automated-assessment.html#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># new addition that breaks station table upload template but very helpful for assessors</span></span>
<span id="cb73-7"><a href="automated-assessment.html#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">BACTERIADECISION =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb73-8"><a href="automated-assessment.html#cb73-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">BACTERIASTATS =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb73-9"><a href="automated-assessment.html#cb73-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Date Last Sampled</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.character</span>(<span class="cn">NA</span>))</span></code></pre></div>
</div>
<div id="attach-wqs-information" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Attach WQS information</h3>
<p>Pull pinned WQS info saved on server. Then perform a series of data manipulation steps that:</p>
<ol style="list-style-type: decimal">
<li>Join WQS to station table by StationID</li>
<li>Create a new variable that will correct for Class II pH differences for Tidal Waters</li>
<li>Join actual WQS critera (object name WQSvalues) to each StationID</li>
<li>Perform a little data cleanup to lose columns unnecessary for future steps</li>
<li>Join station ecoregion information (for benthic analyses)</li>
<li>Standardize lake names (to match 187 lake names for future joining of criteria)
<ul>
<li>Some problematic stations need manual steps to attach the correct lake name</li>
</ul></li>
<li>Join lake nutrient criteria to individual stations
<ul>
<li>Lake Drummond requires some extra manual work per hh special standard <a href="https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section310/" class="uri">https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section310/</a></li>
</ul></li>
<li>Rearrange data schema to more useful format after all previous joins</li>
<li>Correct units for nutrient criteria to match conventionals data format (ug/L to mg/L)</li>
</ol>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="automated-assessment.html#cb74-1" aria-hidden="true" tabindex="-1"></a>WQSlookup <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&quot;WQSlookup-withStandards&quot;</span>,  <span class="at">board =</span> <span class="st">&quot;rsconnect&quot;</span>)</span>
<span id="cb74-2"><a href="automated-assessment.html#cb74-2" aria-hidden="true" tabindex="-1"></a>citmonWQS <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;C:/HardDriveBackup/R/GitHub/IR2024/1.preprocessData/data/citmonStationsWithWQS.RDS&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-3"><a href="automated-assessment.html#cb74-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">StationID =</span> <span class="st">`</span><span class="at">Station Id</span><span class="st">`</span>, <span class="st">`</span><span class="at">WQS Section</span><span class="st">`</span>, <span class="st">`</span><span class="at">WQS Class</span><span class="st">`</span>, <span class="st">`</span><span class="at">WQS Special Standard</span><span class="st">`</span>)</span>
<span id="cb74-4"><a href="automated-assessment.html#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="automated-assessment.html#cb74-5" aria-hidden="true" tabindex="-1"></a>stationTable <span class="ot">&lt;-</span> stationTable <span class="sc">%&gt;%</span> <span class="co"># (1)</span></span>
<span id="cb74-6"><a href="automated-assessment.html#cb74-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-7"><a href="automated-assessment.html#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Special CitMon/Non Agency step until full WQS_ID inplementation in IR2028</span></span>
<span id="cb74-8"><a href="automated-assessment.html#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(citmonWQS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;STATION_ID&#39;</span> <span class="ot">=</span> <span class="st">&#39;StationID&#39;</span>)) <span class="sc">%&gt;%</span> <span class="co"># (1)</span></span>
<span id="cb74-9"><a href="automated-assessment.html#cb74-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-10"><a href="automated-assessment.html#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join to real WQS_ID&#39;s (do this second in case citmon station double listed, want proper WQS_ID if available) (1)</span></span>
<span id="cb74-11"><a href="automated-assessment.html#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(WQSlookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;STATION_ID&#39;</span> <span class="ot">=</span> <span class="st">&#39;StationID&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-12"><a href="automated-assessment.html#cb74-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-13"><a href="automated-assessment.html#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coalesce these similar fields together, taking WQS_ID info before citmon method</span></span>
<span id="cb74-14"><a href="automated-assessment.html#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CLASS =</span> <span class="fu">coalesce</span>(CLASS, <span class="st">`</span><span class="at">WQS Class</span><span class="st">`</span>),</span>
<span id="cb74-15"><a href="automated-assessment.html#cb74-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">SEC =</span> <span class="fu">coalesce</span>(SEC, <span class="st">`</span><span class="at">WQS Section</span><span class="st">`</span>),</span>
<span id="cb74-16"><a href="automated-assessment.html#cb74-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">SPSTDS =</span> <span class="fu">coalesce</span>(SPSTDS, <span class="st">`</span><span class="at">WQS Special Standard</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-17"><a href="automated-assessment.html#cb74-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">WQS Section</span><span class="st">`</span>, <span class="st">`</span><span class="at">WQS Class</span><span class="st">`</span>, <span class="st">`</span><span class="at">WQS Special Standard</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-18"><a href="automated-assessment.html#cb74-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-19"><a href="automated-assessment.html#cb74-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix for Class II Tidal Waters in Chesapeake (bc complicated DO/temp/etc standard)</span></span>
<span id="cb74-20"><a href="automated-assessment.html#cb74-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CLASS_BASIN =</span> <span class="fu">paste</span>(CLASS,<span class="fu">substr</span>(BASIN, <span class="dv">1</span>,<span class="dv">1</span>), <span class="at">sep=</span><span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># (2)</span></span>
<span id="cb74-21"><a href="automated-assessment.html#cb74-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CLASS_BASIN =</span> <span class="fu">ifelse</span>(CLASS_BASIN <span class="sc">==</span> <span class="st">&#39;II_7&#39;</span>, <span class="st">&quot;II_7&quot;</span>, <span class="fu">as.character</span>(CLASS))) <span class="sc">%&gt;%</span> <span class="co"># (2)</span></span>
<span id="cb74-22"><a href="automated-assessment.html#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join actual WQS criteria to each StationID</span></span>
<span id="cb74-23"><a href="automated-assessment.html#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(WQSvalues, <span class="at">by =</span> <span class="st">&#39;CLASS_BASIN&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># (3)</span></span>
<span id="cb74-24"><a href="automated-assessment.html#cb74-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data cleanup</span></span>
<span id="cb74-25"><a href="automated-assessment.html#cb74-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(CLASS.y,CLASS_BASIN)) <span class="sc">%&gt;%</span> <span class="co"># (4)</span></span>
<span id="cb74-26"><a href="automated-assessment.html#cb74-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&#39;CLASS&#39;</span> <span class="ot">=</span> <span class="st">&#39;CLASS.x&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># (4)</span></span>
<span id="cb74-27"><a href="automated-assessment.html#cb74-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-28"><a href="automated-assessment.html#cb74-28" aria-hidden="true" tabindex="-1"></a>   <span class="co"># As of 1/5/23, confirmed that water temperature criteria for class VII waters is determined by the former class of the water. Also confirmed that all class VII waters in TRO, PRO, and NRO were formerly class III, which means that these waters have a maximum temperature criteria of 32 degrees C.</span></span>
<span id="cb74-29"><a href="automated-assessment.html#cb74-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Max Temperature (C)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb74-30"><a href="automated-assessment.html#cb74-30" aria-hidden="true" tabindex="-1"></a>    CLASS <span class="sc">==</span> <span class="st">&quot;VII&quot;</span> <span class="sc">&amp;</span> REGION <span class="sc">==</span> <span class="st">&quot;TRO&quot;</span> <span class="sc">~</span> <span class="dv">32</span>,</span>
<span id="cb74-31"><a href="automated-assessment.html#cb74-31" aria-hidden="true" tabindex="-1"></a>    CLASS <span class="sc">==</span> <span class="st">&quot;VII&quot;</span> <span class="sc">&amp;</span> REGION <span class="sc">==</span> <span class="st">&quot;PRO&quot;</span> <span class="sc">~</span> <span class="dv">32</span>,</span>
<span id="cb74-32"><a href="automated-assessment.html#cb74-32" aria-hidden="true" tabindex="-1"></a>    CLASS <span class="sc">==</span> <span class="st">&quot;VII&quot;</span> <span class="sc">&amp;</span> REGION <span class="sc">==</span> <span class="st">&quot;NRO&quot;</span> <span class="sc">~</span> <span class="dv">32</span>,</span>
<span id="cb74-33"><a href="automated-assessment.html#cb74-33" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Max Temperature (C)</span><span class="st">`</span>) )) <span class="sc">%&gt;%</span> <span class="co"># (3)</span></span>
<span id="cb74-34"><a href="automated-assessment.html#cb74-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-35"><a href="automated-assessment.html#cb74-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-36"><a href="automated-assessment.html#cb74-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join station ecoregion information (for benthic analyses)</span></span>
<span id="cb74-37"><a href="automated-assessment.html#cb74-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(WQMstationFull, WQM_STA_ID, EPA_ECO_US_L3CODE, EPA_ECO_US_L3NAME) <span class="sc">%&gt;%</span> <span class="co">#(5)</span></span>
<span id="cb74-38"><a href="automated-assessment.html#cb74-38" aria-hidden="true" tabindex="-1"></a>              <span class="fu">distinct</span>(WQM_STA_ID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;STATION_ID&#39;</span> <span class="ot">=</span> <span class="st">&#39;WQM_STA_ID&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-39"><a href="automated-assessment.html#cb74-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardize lake names (to match 187 lake names for future joining of criteria)</span></span>
<span id="cb74-40"><a href="automated-assessment.html#cb74-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lakeNameStandardization</span>() <span class="sc">%&gt;%</span> <span class="co"># standardize lake names (6)</span></span>
<span id="cb74-41"><a href="automated-assessment.html#cb74-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-42"><a href="automated-assessment.html#cb74-42" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb74-43"><a href="automated-assessment.html#cb74-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extra special step (6)</span></span>
<span id="cb74-44"><a href="automated-assessment.html#cb74-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Lake_Name =</span> <span class="fu">case_when</span>(STATION_ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;2-TRH000.40&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Thrashers Creek Reservoir&#39;</span>,</span>
<span id="cb74-45"><a href="automated-assessment.html#cb74-45" aria-hidden="true" tabindex="-1"></a>                               STATION_ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;2-LSL000.16&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lone Star Lake F (Crystal Lake)&#39;</span>,</span>
<span id="cb74-46"><a href="automated-assessment.html#cb74-46" aria-hidden="true" tabindex="-1"></a>                               STATION_ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;2-LSL000.04&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lone Star Lake G (Crane Lake)&#39;</span>,</span>
<span id="cb74-47"><a href="automated-assessment.html#cb74-47" aria-hidden="true" tabindex="-1"></a>                               STATION_ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;2-LSL000.20&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lone Star Lake I (Butler Lake)&#39;</span>,</span>
<span id="cb74-48"><a href="automated-assessment.html#cb74-48" aria-hidden="true" tabindex="-1"></a>                               STATION_ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;2-NWB002.93&#39;</span>,<span class="st">&#39;2-NWB004.67&#39;</span>,</span>
<span id="cb74-49"><a href="automated-assessment.html#cb74-49" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">&#39;2-NWB006.06&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Western Branch Reservoir&#39;</span>,</span>
<span id="cb74-50"><a href="automated-assessment.html#cb74-50" aria-hidden="true" tabindex="-1"></a>                               STATION_ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;2-LDJ000.60&#39;</span>) <span class="sc">~</span> <span class="st">&#39;Lake Nottoway (Lee Lake)&#39;</span>,</span>
<span id="cb74-51"><a href="automated-assessment.html#cb74-51" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(Lake_Name))) <span class="sc">%&gt;%</span></span>
<span id="cb74-52"><a href="automated-assessment.html#cb74-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-53"><a href="automated-assessment.html#cb74-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-54"><a href="automated-assessment.html#cb74-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join lake nutrient criteria to individual stations</span></span>
<span id="cb74-55"><a href="automated-assessment.html#cb74-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lakeNutStandards <span class="sc">%&gt;%</span> </span>
<span id="cb74-56"><a href="automated-assessment.html#cb74-56" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">Lakes_187B =</span> <span class="st">&#39;y&#39;</span>),  <span class="co"># special step to make sure the WQS designation for 187 are correct even when not</span></span>
<span id="cb74-57"><a href="automated-assessment.html#cb74-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;Lake_Name&#39;</span>)) <span class="sc">%&gt;%</span> <span class="co"># (7)</span></span>
<span id="cb74-58"><a href="automated-assessment.html#cb74-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lake drummond special standards</span></span>
<span id="cb74-59"><a href="automated-assessment.html#cb74-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Lakes_187B =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Lakes_187B.y ), Lakes_187B.x, Lakes_187B.y), </span>
<span id="cb74-60"><a href="automated-assessment.html#cb74-60" aria-hidden="true" tabindex="-1"></a>         <span class="co"># dd. For Lake Drummond, located within the boundaries of Chesapeake and Suffolk in the Great Dismal Swamp, chlorophyll a shall not exceed 35 µg/L and total phosphorus shall not exceed 40 µg/L at a depth of one meter or less. https://law.lis.virginia.gov/admincode/title9/agency25/chapter260/section310/</span></span>
<span id="cb74-61"><a href="automated-assessment.html#cb74-61" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Chlorophyll a (ug/L)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(Lake_Name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Drummond&#39;</span>) <span class="sc">~</span> <span class="dv">35</span>,</span>
<span id="cb74-62"><a href="automated-assessment.html#cb74-62" aria-hidden="true" tabindex="-1"></a>                                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Chlorophyll a (ug/L)</span><span class="st">`</span>)),</span>
<span id="cb74-63"><a href="automated-assessment.html#cb74-63" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Total Phosphorus (ug/L)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(Lake_Name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Lake Drummond&#39;</span>) <span class="sc">~</span> <span class="dv">40</span>,</span>
<span id="cb74-64"><a href="automated-assessment.html#cb74-64" aria-hidden="true" tabindex="-1"></a>                                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Total Phosphorus (ug/L)</span><span class="st">`</span>))) <span class="sc">%&gt;%</span> <span class="co"># (7)</span></span>
<span id="cb74-65"><a href="automated-assessment.html#cb74-65" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(STATION_ID<span class="sc">:</span>StreamType, Lakes_187B, <span class="st">`</span><span class="at">Description Of Waters</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Total Phosphorus (ug/L)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="co"># (8)</span></span>
<span id="cb74-66"><a href="automated-assessment.html#cb74-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># match lake limit to TP data unit</span></span>
<span id="cb74-67"><a href="automated-assessment.html#cb74-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Total Phosphorus (mg/L)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Total Phosphorus (ug/L)</span><span class="st">`</span> <span class="sc">/</span> <span class="dv">1000</span>) <span class="co"># (9)</span></span>
<span id="cb74-68"><a href="automated-assessment.html#cb74-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-69"><a href="automated-assessment.html#cb74-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-70"><a href="automated-assessment.html#cb74-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify stations that are missing WQS</span></span>
<span id="cb74-71"><a href="automated-assessment.html#cb74-71" aria-hidden="true" tabindex="-1"></a>missingWQS <span class="ot">&lt;-</span> <span class="fu">filter</span>(stationTable, <span class="fu">is.na</span>(CLASS))</span></code></pre></div>
</div>
<div id="identify-station-type" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Identify Station Type</h3>
<p>It is important to have a lookup table of all lake stations to efficiently run computationally-intense lake methods only on lake stations. This next step identifies all stations that have lake AU designations. We will use this information later to determine how to analyze certain parameters that have different methods based on waterbody type.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="automated-assessment.html#cb75-1" aria-hidden="true" tabindex="-1"></a>lakeStations <span class="ot">&lt;-</span> <span class="fu">filter_at</span>(stationTable,</span>
<span id="cb75-2"><a href="automated-assessment.html#cb75-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.vars =</span> <span class="fu">vars</span>(<span class="fu">contains</span>(<span class="st">&quot;ID305B&quot;</span>)),</span>
<span id="cb75-3"><a href="automated-assessment.html#cb75-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.vars_predicate =</span> <span class="fu">any_vars</span>(<span class="fu">str_detect</span>(., <span class="st">&#39;L_&#39;</span>)))</span></code></pre></div>
</div>
<div id="bring-in-low-flow-information" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Bring in Low Flow Information</h3>
<p>We also need to bring in the previously analyzed low flow periods for the assessment window. These USGS stream gages are analyzed using the 7Q10 methodology consistent with the DEQ Water Permitting Program with two assumption changes:</p>
<ol style="list-style-type: decimal">
<li>Provisional data are accepted (due to the expedited assessment timeline). QA/QC changes from Provision to Accepted data generally involve storm event corrections, so using Provisional data should not affect low flow analyses.</li>
<li>Gages analyzed for low flow statistics require 10 or more valid water years for inclusion in analyses.</li>
</ol>
<p>This gage-specific information is spatially joined to major river subbasins to extrapolate low flow conditions to stations that fall into said watersheds. The temporal windows where low flow events were recorded in a watershed are joined to stations that fall into said watershed. Lake stations are removed from this flag. Parameters that should not be analyzed during low flow events are flagged during the automated assessment process and presented to the assessment staff in the assessment applications. A station-level flag is presented in the stationTable output of these scripts for users who prefer to only use the tabular output from the automated assessment tools.</p>
<p>Spatially join when doing stuff now with draft data</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="automated-assessment.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simplify the data first by date and BASIN_CODE as to not duplicate data when joined to conventionals raw data</span></span>
<span id="cb76-2"><a href="automated-assessment.html#cb76-2" aria-hidden="true" tabindex="-1"></a>assessmentWindowLowFlowsBasinLevelFlag <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(assessmentWindowLowFlows, Date, <span class="st">`</span><span class="at">Gage ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>, BASIN_CODE) <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="automated-assessment.html#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Date, BASIN_CODE) <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="automated-assessment.html#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">7Q10 Flag Gage</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Gage ID</span><span class="st">`</span>),<span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>),</span>
<span id="cb76-5"><a href="automated-assessment.html#cb76-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-6"><a href="automated-assessment.html#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># still have duplicate rows with same info, so need to drop those or will duplicate conventionals data when joined in</span></span>
<span id="cb76-7"><a href="automated-assessment.html#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb76-8"><a href="automated-assessment.html#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-9"><a href="automated-assessment.html#cb76-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>n) <span class="co"># get rid of count bc no longer needed</span></span>
<span id="cb76-10"><a href="automated-assessment.html#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="automated-assessment.html#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="automated-assessment.html#cb76-12" aria-hidden="true" tabindex="-1"></a>conventionals <span class="ot">&lt;-</span> conventionals <span class="sc">%&gt;%</span> </span>
<span id="cb76-13"><a href="automated-assessment.html#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(conventionals_distinct, FDT_STA_ID, BASIN_CODE) <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>(),</span>
<span id="cb76-14"><a href="automated-assessment.html#cb76-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&#39;FDT_STA_ID&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-15"><a href="automated-assessment.html#cb76-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SampleDate =</span> <span class="fu">as.Date</span>(FDT_DATE_TIME)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-16"><a href="automated-assessment.html#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#left_join(dplyr::select(stationTable, STATION_ID, VAHU6), by = c(&#39;FDT_STA_ID&#39; = &#39;STATION_ID&#39;)) %&gt;% # join in VAHU6 information from Assessors</span></span>
<span id="cb76-17"><a href="automated-assessment.html#cb76-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#left_join(dplyr::select(subbasinToVAHU6, VAHU6, BASIN_CODE, Basin_Code), by = &#39;VAHU6&#39;)  # join in basin information by VAHU6</span></span>
<span id="cb76-18"><a href="automated-assessment.html#cb76-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(assessmentWindowLowFlowsBasinLevelFlag,</span>
<span id="cb76-19"><a href="automated-assessment.html#cb76-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;SampleDate&#39;</span> <span class="ot">=</span> <span class="st">&#39;Date&#39;</span>, <span class="st">&#39;BASIN_CODE&#39;</span> <span class="ot">=</span> <span class="st">&#39;BASIN_CODE&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-20"><a href="automated-assessment.html#cb76-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>SampleDate) <span class="co"># rm unnecessary column</span></span>
<span id="cb76-21"><a href="automated-assessment.html#cb76-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-22"><a href="automated-assessment.html#cb76-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-23"><a href="automated-assessment.html#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="automated-assessment.html#cb76-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Special step to remove low flow information from lake stations</span></span>
<span id="cb76-25"><a href="automated-assessment.html#cb76-25" aria-hidden="true" tabindex="-1"></a>conventionals <span class="ot">&lt;-</span> conventionals <span class="sc">%&gt;%</span> </span>
<span id="cb76-26"><a href="automated-assessment.html#cb76-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">case_when</span>(FDT_STA_ID <span class="sc">%in%</span> lakeStations<span class="sc">$</span>STATION_ID <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb76-27"><a href="automated-assessment.html#cb76-27" aria-hidden="true" tabindex="-1"></a>                                 <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">`</span><span class="at">7Q10 Flag</span><span class="st">`</span>))</span>
<span id="cb76-28"><a href="automated-assessment.html#cb76-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-29"><a href="automated-assessment.html#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="co">#View(filter(conventionals, `7Q10 Flag` == &quot;7Q10 Flag&quot;))</span></span></code></pre></div>
</div>
<div id="metals-reoganization" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Metals Reoganization</h3>
<p>We need to reorganize raw water column metals data to enable better exceedance analyses across automated scripts and applications.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="automated-assessment.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate object for analysis, tack on METALS and RMK designation to make the filtering of certain lab comment codes easier</span></span>
<span id="cb77-2"><a href="automated-assessment.html#cb77-2" aria-hidden="true" tabindex="-1"></a>WCmetalsForAnalysis <span class="ot">&lt;-</span> WCmetals <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="automated-assessment.html#cb77-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Station_Id, FDT_DATE_TIME, FDT_DEPTH, <span class="co"># include depth bc a few samples taken same datetime but different depths</span></span>
<span id="cb77-4"><a href="automated-assessment.html#cb77-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Antimony =</span> <span class="st">`</span><span class="at">STORET_01095_ANTIMONY, DISSOLVED (UG/L AS SB)</span><span class="st">`</span>, <span class="at">RMK_Antimony =</span> RMK_01097,</span>
<span id="cb77-5"><a href="automated-assessment.html#cb77-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Arsenic =</span> <span class="st">`</span><span class="at">STORET_01000_ARSENIC, DISSOLVED  (UG/L AS AS)</span><span class="st">`</span>, <span class="at">RMK_Arsenic =</span> RMK_01002,</span>
<span id="cb77-6"><a href="automated-assessment.html#cb77-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Barium =</span> <span class="st">`</span><span class="at">STORET_01005_BARIUM, DISSOLVED (UG/L AS BA)</span><span class="st">`</span>, <span class="at">RMK_Barium =</span> RMK_01005,</span>
<span id="cb77-7"><a href="automated-assessment.html#cb77-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Cadmium =</span> <span class="st">`</span><span class="at">STORET_01025_CADMIUM, DISSOLVED (UG/L AS CD)</span><span class="st">`</span>, <span class="at">RMK_Cadmium =</span> RMK_01025,</span>
<span id="cb77-8"><a href="automated-assessment.html#cb77-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Chromium =</span> <span class="st">`</span><span class="at">STORET_01030_CHROMIUM, DISSOLVED (UG/L AS CR)</span><span class="st">`</span>, <span class="at">RMK_Chromium =</span> RMK_01030,</span>
<span id="cb77-9"><a href="automated-assessment.html#cb77-9" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Chromium III and ChromiumVI dealt with inside metalsAnalysis()</span></span>
<span id="cb77-10"><a href="automated-assessment.html#cb77-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Copper =</span> <span class="st">`</span><span class="at">STORET_01040_COPPER, DISSOLVED (UG/L AS CU)</span><span class="st">`</span>, <span class="at">RMK_Copper =</span> RMK_01040,</span>
<span id="cb77-11"><a href="automated-assessment.html#cb77-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Lead =</span> <span class="st">`</span><span class="at">STORET_01049_LEAD, DISSOLVED (UG/L AS PB)</span><span class="st">`</span>, <span class="at">RMK_Lead =</span> RMK_01049,</span>
<span id="cb77-12"><a href="automated-assessment.html#cb77-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Mercury =</span> <span class="st">`</span><span class="at">STORET_50091_MERCURY-TL,FILTERED WATER,ULTRATRACE METHOD UG/L</span><span class="st">`</span>, <span class="at">RMK_Mercury =</span> RMK_50091,</span>
<span id="cb77-13"><a href="automated-assessment.html#cb77-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Nickel =</span> <span class="st">`</span><span class="at">STORET_01065_NICKEL, DISSOLVED (UG/L AS NI)</span><span class="st">`</span>, <span class="at">RMK_Nickel =</span> RMK_01067,</span>
<span id="cb77-14"><a href="automated-assessment.html#cb77-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Uranium =</span> <span class="st">`</span><span class="at">URANIUM_TOT</span><span class="st">`</span>, <span class="at">RMK_Uranium =</span> <span class="st">`</span><span class="at">RMK_7440-61-1T</span><span class="st">`</span>,</span>
<span id="cb77-15"><a href="automated-assessment.html#cb77-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Selenium =</span> <span class="st">`</span><span class="at">STORET_01145_SELENIUM, DISSOLVED (UG/L AS SE)</span><span class="st">`</span>, <span class="at">RMK_Selenium =</span> RMK_01145,</span>
<span id="cb77-16"><a href="automated-assessment.html#cb77-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Silver =</span> <span class="st">`</span><span class="at">STORET_01075_SILVER, DISSOLVED (UG/L AS AG)</span><span class="st">`</span>, <span class="at">RMK_Silver =</span> RMK_01075,</span>
<span id="cb77-17"><a href="automated-assessment.html#cb77-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Thallium =</span> <span class="st">`</span><span class="at">STORET_01057_THALLIUM, DISSOLVED (UG/L AS TL)</span><span class="st">`</span>, <span class="at">RMK_Thallium =</span> RMK_01057,</span>
<span id="cb77-18"><a href="automated-assessment.html#cb77-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Zinc =</span> <span class="st">`</span><span class="at">STORET_01090_ZINC, DISSOLVED (UG/L AS ZN)</span><span class="st">`</span>, <span class="at">RMK_Zinc =</span> RMK_01092,</span>
<span id="cb77-19"><a href="automated-assessment.html#cb77-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">METAL_Hardness =</span> <span class="st">`</span><span class="at">STORET_DHARD_HARDNESS, CA MG CALCULATED (MG/L AS CACO3) AS DISSOLVED</span><span class="st">`</span>, <span class="at">RMK_Hardness =</span> RMK_DHARD) <span class="sc">%&gt;%</span></span>
<span id="cb77-20"><a href="automated-assessment.html#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Station_Id, FDT_DATE_TIME, FDT_DEPTH) <span class="sc">%&gt;%</span></span>
<span id="cb77-21"><a href="automated-assessment.html#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, as.character) <span class="sc">%&gt;%</span> <span class="co"># need everyone as character so we can pivot longer in one go</span></span>
<span id="cb77-22"><a href="automated-assessment.html#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> METAL_Antimony<span class="sc">:</span>RMK_Hardness, <span class="co">#RMK_Antimony:RMK_Hardness,</span></span>
<span id="cb77-23"><a href="automated-assessment.html#cb77-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&#39;Type&#39;</span>, <span class="st">&#39;Metal&#39;</span>),</span>
<span id="cb77-24"><a href="automated-assessment.html#cb77-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb77-25"><a href="automated-assessment.html#cb77-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&#39;Value&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-26"><a href="automated-assessment.html#cb77-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Station_Id, FDT_DATE_TIME, FDT_DEPTH, Metal) <span class="sc">%&gt;%</span></span>
<span id="cb77-27"><a href="automated-assessment.html#cb77-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(Station_Id, FDT_DATE_TIME, FDT_DEPTH, Metal), <span class="at">names_from =</span> Type, <span class="at">values_from =</span> Value) <span class="sc">%&gt;%</span> <span class="co"># pivot remark wider so the appropriate metal value is dropped when filtering on lab comment codes</span></span>
<span id="cb77-28"><a href="automated-assessment.html#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span> RMK <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;IF&#39;</span>, <span class="st">&#39;J&#39;</span>, <span class="st">&#39;O&#39;</span>, <span class="st">&#39;QF&#39;</span>, <span class="st">&#39;V&#39;</span>)) <span class="sc">%&gt;%</span> <span class="co"># lab codes dropped from further analysis</span></span>
<span id="cb77-29"><a href="automated-assessment.html#cb77-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span> METAL<span class="sc">:</span>RMK, <span class="at">names_to =</span> <span class="st">&#39;Type&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;Value&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># get in appropriate format to flip wide again</span></span>
<span id="cb77-30"><a href="automated-assessment.html#cb77-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(Station_Id, FDT_DATE_TIME, FDT_DEPTH), <span class="at">names_from =</span> <span class="fu">c</span>(Type, Metal), <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">values_from =</span> Value) <span class="sc">%&gt;%</span></span>
<span id="cb77-31"><a href="automated-assessment.html#cb77-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(<span class="st">&#39;METAL&#39;</span>)), as.numeric) <span class="sc">%&gt;%</span><span class="co"># change metals values back to numeric</span></span>
<span id="cb77-32"><a href="automated-assessment.html#cb77-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">str_remove</span>(., <span class="st">&#39;METAL_&#39;</span>)) <span class="co"># drop METAL_ prefix for easier analyses</span></span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="organize-metadata.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="automated-assessment-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": null
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
