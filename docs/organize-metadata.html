<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.2 Organize Metadata | DEQ Water Quality Automated Assessment User Guide</title>
  <meta name="description" content="A companion document describing the WQA automated assessment methodology." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3.2 Organize Metadata | DEQ Water Quality Automated Assessment User Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A companion document describing the WQA automated assessment methodology." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.2 Organize Metadata | DEQ Water Quality Automated Assessment User Guide" />
  
  <meta name="twitter:description" content="A companion document describing the WQA automated assessment methodology." />
  

<meta name="author" content="DEQ Automated Assessment Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="metadata-attribution.html"/>
<link rel="next" href="automated-assessment.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="assets/book.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DEQ Water Quality Automated Assessment User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="HowToUseDocument.html"><a href="HowToUseDocument.html"><i class="fa fa-check"></i><b>1.1</b> How to Use Document</a></li>
<li class="chapter" data-level="1.2" data-path="ProjectHistory.html"><a href="ProjectHistory.html"><i class="fa fa-check"></i><b>1.2</b> Project History</a></li>
<li class="chapter" data-level="1.3" data-path="Acknowledgements.html"><a href="Acknowledgements.html"><i class="fa fa-check"></i><b>1.3</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-organization.html"><a href="data-organization.html"><i class="fa fa-check"></i><b>2</b> Data Organization</a>
<ul>
<li class="chapter" data-level="2.1" data-path="conventionals-data.html"><a href="conventionals-data.html"><i class="fa fa-check"></i><b>2.1</b> Conventionals Data</a></li>
<li class="chapter" data-level="2.2" data-path="water-column-metals.html"><a href="water-column-metals.html"><i class="fa fa-check"></i><b>2.2</b> Water Column Metals</a></li>
<li class="chapter" data-level="2.3" data-path="sediment-metals.html"><a href="sediment-metals.html"><i class="fa fa-check"></i><b>2.3</b> Sediment Metals</a></li>
<li class="chapter" data-level="2.4" data-path="fish-tissue-data.html"><a href="fish-tissue-data.html"><i class="fa fa-check"></i><b>2.4</b> Fish Tissue Data</a></li>
<li class="chapter" data-level="2.5" data-path="pcb-data.html"><a href="pcb-data.html"><i class="fa fa-check"></i><b>2.5</b> PCB Data</a></li>
<li class="chapter" data-level="2.6" data-path="vdh-data.html"><a href="vdh-data.html"><i class="fa fa-check"></i><b>2.6</b> VDH Data</a></li>
<li class="chapter" data-level="2.7" data-path="citizen-monitoring-data.html"><a href="citizen-monitoring-data.html"><i class="fa fa-check"></i><b>2.7</b> Citizen Monitoring Data</a></li>
<li class="chapter" data-level="2.8" data-path="station-metadata.html"><a href="station-metadata.html"><i class="fa fa-check"></i><b>2.8</b> Station Metadata</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="automated-assessment-methods.html"><a href="automated-assessment-methods.html"><i class="fa fa-check"></i><b>3</b> Automated Assessment Methods</a>
<ul>
<li class="chapter" data-level="3.1" data-path="metadata-attribution.html"><a href="metadata-attribution.html"><i class="fa fa-check"></i><b>3.1</b> Metadata Attribution</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="metadata-attribution.html"><a href="metadata-attribution.html#distinct-sites"><i class="fa fa-check"></i><b>3.1.1</b> Distinct Sites</a></li>
<li class="chapter" data-level="3.1.2" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-assessment-region-and-subbasin-information"><i class="fa fa-check"></i><b>3.1.2</b> Join Assessment Region and Subbasin Information</a></li>
<li class="chapter" data-level="3.1.3" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-stations-to-wqs"><i class="fa fa-check"></i><b>3.1.3</b> Join Stations to WQS</a></li>
<li class="chapter" data-level="3.1.4" data-path="metadata-attribution.html"><a href="metadata-attribution.html#spatially-join-polygons"><i class="fa fa-check"></i><b>3.1.4</b> Spatially Join Polygons</a></li>
<li class="chapter" data-level="3.1.5" data-path="metadata-attribution.html"><a href="metadata-attribution.html#spatially-join-wqs-lines"><i class="fa fa-check"></i><b>3.1.5</b> Spatially Join WQS Lines</a></li>
<li class="chapter" data-level="3.1.6" data-path="metadata-attribution.html"><a href="metadata-attribution.html#assign-something-to-wqs_id-so-sites-will-not-fall-through-the-cracks-when-application-filtering-occurs"><i class="fa fa-check"></i><b>3.1.6</b> Assign something to WQS_ID so sites will not fall through the cracks when application filtering occurs</a></li>
<li class="chapter" data-level="3.1.7" data-path="metadata-attribution.html"><a href="metadata-attribution.html#join-stations-to-aus"><i class="fa fa-check"></i><b>3.1.7</b> Join Stations to AUs</a></li>
<li class="chapter" data-level="3.1.8" data-path="metadata-attribution.html"><a href="metadata-attribution.html#where-does-this-information-go"><i class="fa fa-check"></i><b>3.1.8</b> Where does this information go?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="organize-metadata.html"><a href="organize-metadata.html"><i class="fa fa-check"></i><b>3.2</b> Organize Metadata</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="organize-metadata.html"><a href="organize-metadata.html#organizing-all-new-wqsau-metadata-from-the-r-server"><i class="fa fa-check"></i><b>3.2.1</b> Organizing all new WQS/AU metadata from the R server</a></li>
<li class="chapter" data-level="3.2.2" data-path="organize-metadata.html"><a href="organize-metadata.html#reorganize-conventionals-dataset"><i class="fa fa-check"></i><b>3.2.2</b> Reorganize Conventionals Dataset</a></li>
<li class="chapter" data-level="3.2.3" data-path="organize-metadata.html"><a href="organize-metadata.html#add-citizen-monitoring-data-to-conventionals"><i class="fa fa-check"></i><b>3.2.3</b> Add Citizen Monitoring Data to conventionals</a></li>
<li class="chapter" data-level="3.2.4" data-path="organize-metadata.html"><a href="organize-metadata.html#adding-secchi-depth-to-conventionals-dataset"><i class="fa fa-check"></i><b>3.2.4</b> Adding Secchi Depth to conventionals dataset</a></li>
<li class="chapter" data-level="3.2.5" data-path="organize-metadata.html"><a href="organize-metadata.html#clean-up-pcb-dataset"><i class="fa fa-check"></i><b>3.2.5</b> Clean up PCB dataset</a></li>
<li class="chapter" data-level="3.2.6" data-path="organize-metadata.html"><a href="organize-metadata.html#clean-up-fish-tissue-dataset"><i class="fa fa-check"></i><b>3.2.6</b> Clean up Fish Tissue dataset</a></li>
<li class="chapter" data-level="3.2.7" data-path="organize-metadata.html"><a href="organize-metadata.html#stationstablebegin"><i class="fa fa-check"></i><b>3.2.7</b> stationsTablebegin</a></li>
<li class="chapter" data-level="3.2.8" data-path="organize-metadata.html"><a href="organize-metadata.html#pin-official-clean-ir-data-to-r-server"><i class="fa fa-check"></i><b>3.2.8</b> Pin Official Clean IR data to R server</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="automated-assessment.html"><a href="automated-assessment.html"><i class="fa fa-check"></i><b>3.3</b> Automated Assessment</a></li>
<li class="chapter" data-level="3.4" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html"><i class="fa fa-check"></i><b>3.4</b> Individual Parameter Analyses</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#temperature"><i class="fa fa-check"></i><b>3.4.1</b> Temperature</a></li>
<li class="chapter" data-level="3.4.2" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#dissolved-oxygen"><i class="fa fa-check"></i><b>3.4.2</b> Dissolved Oxygen</a></li>
<li class="chapter" data-level="3.4.3" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#ph"><i class="fa fa-check"></i><b>3.4.3</b> pH</a></li>
<li class="chapter" data-level="3.4.4" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#bacteria"><i class="fa fa-check"></i><b>3.4.4</b> Bacteria</a></li>
<li class="chapter" data-level="3.4.5" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#nutrients"><i class="fa fa-check"></i><b>3.4.5</b> Nutrients</a></li>
<li class="chapter" data-level="3.4.6" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#ammonia"><i class="fa fa-check"></i><b>3.4.6</b> Ammonia</a></li>
<li class="chapter" data-level="3.4.7" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#pcb"><i class="fa fa-check"></i><b>3.4.7</b> PCB</a></li>
<li class="chapter" data-level="3.4.8" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#metals"><i class="fa fa-check"></i><b>3.4.8</b> Metals</a></li>
<li class="chapter" data-level="3.4.9" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#fish-tissue"><i class="fa fa-check"></i><b>3.4.9</b> Fish Tissue</a></li>
<li class="chapter" data-level="3.4.10" data-path="individual-parameter-analyses.html"><a href="individual-parameter-analyses.html#benthics"><i class="fa fa-check"></i><b>3.4.10</b> Benthics</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="automated-output.html"><a href="automated-output.html"><i class="fa fa-check"></i><b>3.5</b> Automated Output</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regional-metadata-validation-tool-how-to.html"><a href="regional-metadata-validation-tool-how-to.html"><i class="fa fa-check"></i><b>4</b> Regional Metadata Validation <br>Tool How To</a>
<ul>
<li class="chapter" data-level="4.1" data-path="application-orientation.html"><a href="application-orientation.html"><i class="fa fa-check"></i><b>4.1</b> Application Orientation</a></li>
<li class="chapter" data-level="4.2" data-path="application-use-water-quality-standards-qa-watershed-selection-tab.html"><a href="application-use-water-quality-standards-qa-watershed-selection-tab.html"><i class="fa fa-check"></i><b>4.2</b> Application Use: <br>Water Quality Standards QA- <br>Watershed Selection Tab</a></li>
<li class="chapter" data-level="4.3" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html"><i class="fa fa-check"></i><b>4.3</b> Application Use: <br>Water Quality Standards QA- <br>Manual Review Tab</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#map-orientation"><i class="fa fa-check"></i><b>4.3.1</b> Map Orientation</a></li>
<li class="chapter" data-level="4.3.2" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#what-do-the-buttons-do"><i class="fa fa-check"></i><b>4.3.2</b> What do the buttons do?</a></li>
<li class="chapter" data-level="4.3.3" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation"><i class="fa fa-check"></i><b>4.3.3</b> Application Operation</a></li>
<li class="chapter" data-level="4.3.4" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-1-wqs-segment"><i class="fa fa-check"></i><b>4.3.4</b> Application Operation: <br>Station that Snapped to 1 WQS Segment</a></li>
<li class="chapter" data-level="4.3.5" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-1-wqs-segment-1"><i class="fa fa-check"></i><b>4.3.5</b> Application Operation: <br>Station that Snapped to &gt;1 WQS Segment</a></li>
<li class="chapter" data-level="4.3.6" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-station-that-snapped-to-0-wqs-segments"><i class="fa fa-check"></i><b>4.3.6</b> Application Operation: <br>Station that Snapped to 0 WQS Segments</a></li>
<li class="chapter" data-level="4.3.7" data-path="application-use-water-quality-standards-qa-manual-review-tab.html"><a href="application-use-water-quality-standards-qa-manual-review-tab.html#application-operation-there-are-no-more-stations-to-attribute"><i class="fa fa-check"></i><b>4.3.7</b> Application Operation: <br>There are no more stations to attribute</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="having-problems.html"><a href="having-problems.html"><i class="fa fa-check"></i><b>4.4</b> Having problems?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="riverine-application-how-to.html"><a href="riverine-application-how-to.html"><i class="fa fa-check"></i><b>5</b> Riverine Application How To</a></li>
<li class="chapter" data-level="6" data-path="lacustrine-application-how-to.html"><a href="lacustrine-application-how-to.html"><i class="fa fa-check"></i><b>6</b> Lacustrine Application How To</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DEQ Water Quality Automated Assessment User Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="organize-metadata" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Organize Metadata</h2>
<p>After all stations for a given assessment window have the appropriate WQS and AU information attributed, there are a number of data organization steps that still need to happen before the data are ready for the automated assessment scripts. These steps include:</p>
<ul>
<li>Organizing all new WQS/AU metadata from the R server and adding new data to pinned datasets</li>
<li>Reorganizing the conventionals dataset to match schema for automated assessment scripts</li>
<li>Add Citizen Monitoring Data to conventionals</li>
<li>Adding Secchi Depth to conventionals dataset</li>
<li>Clean up PCB dataset</li>
<li>Clean up Fish Tissue dataset</li>
</ul>
<p><strong>The sections below are purposefully sparse as the methods are in flux given that new data are available in ODS. Stay tuned to see how these methods flesh out for more streamlined data organization in future cycles.</strong></p>
<div id="organizing-all-new-wqsau-metadata-from-the-r-server" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Organizing all new WQS/AU metadata from the R server</h3>
<p>A server administrator must retrieve all the WQS/AU information from the attribution application. This directory is consolidated into a single dataset of all new StationID-WQS/AU records. It is important to verify that all expected StationIDs (all distinct stations from the conventionals and citizen monitoring datasets) have WQS and AU information before proceeding. If stations lack this information they will not be assessed accurately.</p>
<div id="adding-new-wqs-data-to-pinned-datasets" class="section level4" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Adding new WQS data to pinned datasets</h4>
<p>Once WQS/AU information is available for all stations, the data is appended to the master WQS information pin on the R server in the case of WQS information. AU information can change cycle to cycle, so the IR year for the StationID-AU information is added to the dataset before pinning back to the master AU information pin.</p>
<p>To expedite the transfer of actual WQS information, another pin contains the actual WQS metadata as well as relevant StationID. All new stations attributed need to be joined to the relevant WQS layer to extract this metadata before it can be appended to the master WQS information pin with standards. The script below details this process by bringing in each necessary WQS layer, joining it to the WQSlookup information, and then pinning it to the R server.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="organize-metadata.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table with StationID and WQS_ID information that needs actual WQS metadata</span></span>
<span id="cb22-2"><a href="organize-metadata.html#cb22-2" aria-hidden="true" tabindex="-1"></a>WQSlookupToDo <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">StationID =</span> <span class="cn">NA</span>, <span class="at">WQS_ID =</span> <span class="cn">NA</span>) <span class="co"># blank for example purposes</span></span>
<span id="cb22-3"><a href="organize-metadata.html#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="organize-metadata.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#bring in Riverine layers, valid for the assessment window</span></span>
<span id="cb22-5"><a href="organize-metadata.html#cb22-5" aria-hidden="true" tabindex="-1"></a>riverine <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&#39;../GIS/draft_WQS_shapefiles_2022/riverine_draft2022.shp&#39;</span>,</span>
<span id="cb22-6"><a href="organize-metadata.html#cb22-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fid_column_name =</span> <span class="st">&quot;OBJECTID&quot;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="organize-metadata.html#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="co"># only care about data not geometry</span></span>
<span id="cb22-8"><a href="organize-metadata.html#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="organize-metadata.html#cb22-9" aria-hidden="true" tabindex="-1"></a>WQSlookupFull <span class="ot">&lt;-</span> <span class="fu">left_join</span>(WQSlookupToDo, riverine) <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="organize-metadata.html#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(CLASS)) <span class="co"># drop sites that didn&#39;t actually join </span></span>
<span id="cb22-11"><a href="organize-metadata.html#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(riverine)</span>
<span id="cb22-12"><a href="organize-metadata.html#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="organize-metadata.html#cb22-13" aria-hidden="true" tabindex="-1"></a>lacustrine <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&#39;../GIS/draft_WQS_shapefiles_2022/lakes_reservoirs_draft2022.shp&#39;</span>,</span>
<span id="cb22-14"><a href="organize-metadata.html#cb22-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fid_column_name =</span> <span class="st">&quot;OBJECTID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="organize-metadata.html#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="co"># only care about data not geometry</span></span>
<span id="cb22-16"><a href="organize-metadata.html#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="organize-metadata.html#cb22-17" aria-hidden="true" tabindex="-1"></a>WQSlookupFull <span class="ot">&lt;-</span> <span class="fu">left_join</span>(WQSlookupToDo, lacustrine) <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="organize-metadata.html#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(CLASS)) <span class="sc">%&gt;%</span> <span class="co"># drop sites that didn&#39;t actually join </span></span>
<span id="cb22-19"><a href="organize-metadata.html#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(WQSlookupFull) <span class="co"># add these to the larger dataset</span></span>
<span id="cb22-20"><a href="organize-metadata.html#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(lacustrine)</span>
<span id="cb22-21"><a href="organize-metadata.html#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="organize-metadata.html#cb22-22" aria-hidden="true" tabindex="-1"></a>estuarineLines <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&#39;../GIS/draft_WQS_shapefiles_2022/estuarinelines_draft2022.shp&#39;</span> , <span class="at">fid_column_name =</span> <span class="st">&quot;OBJECTID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-23"><a href="organize-metadata.html#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="co"># only care about data not geometry</span></span>
<span id="cb22-24"><a href="organize-metadata.html#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="organize-metadata.html#cb22-25" aria-hidden="true" tabindex="-1"></a>WQSlookupFull <span class="ot">&lt;-</span> <span class="fu">left_join</span>(WQSlookupToDo, estuarineLines) <span class="sc">%&gt;%</span></span>
<span id="cb22-26"><a href="organize-metadata.html#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(CLASS)) <span class="sc">%&gt;%</span> <span class="co"># drop sites that didn&#39;t actually join </span></span>
<span id="cb22-27"><a href="organize-metadata.html#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(WQSlookupFull) <span class="co"># add these to the larger dataset</span></span>
<span id="cb22-28"><a href="organize-metadata.html#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(estuarineLines)</span>
<span id="cb22-29"><a href="organize-metadata.html#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="organize-metadata.html#cb22-30" aria-hidden="true" tabindex="-1"></a>estuarinePolys <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&#39;../GIS/draft_WQS_shapefiles_2022/estuarinepolygons_draft2022.shp&#39;</span>, </span>
<span id="cb22-31"><a href="organize-metadata.html#cb22-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">fid_column_name =</span> <span class="st">&quot;OBJECTID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-32"><a href="organize-metadata.html#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="co"># only care about data not geometry</span></span>
<span id="cb22-33"><a href="organize-metadata.html#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="organize-metadata.html#cb22-34" aria-hidden="true" tabindex="-1"></a>WQSlookupFull <span class="ot">&lt;-</span> <span class="fu">left_join</span>(WQSlookupToDo, estuarinePolys) <span class="sc">%&gt;%</span></span>
<span id="cb22-35"><a href="organize-metadata.html#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(CLASS)) <span class="sc">%&gt;%</span> <span class="co"># drop sites that didn&#39;t actually join </span></span>
<span id="cb22-36"><a href="organize-metadata.html#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(WQSlookupFull) <span class="co"># add these to the larger dataset</span></span>
<span id="cb22-37"><a href="organize-metadata.html#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(estuarinePolys)</span>
<span id="cb22-38"><a href="organize-metadata.html#cb22-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-39"><a href="organize-metadata.html#cb22-39" aria-hidden="true" tabindex="-1"></a>WQSlookup_withStandards_pin <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(WQSlookup_withStandards, WQSlookupFull) <span class="co"># for pin</span></span></code></pre></div>
<p>The WQSlookup_withStandards_pin object is then pinned to the R server to be sourced by numerous other data users/products. This pin is available by using the following script.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="organize-metadata.html#cb23-1" aria-hidden="true" tabindex="-1"></a>WQSlookup_withStandards <span class="ot">&lt;-</span> <span class="fu">pin_get</span>(<span class="st">&#39;ejones/WQSlookup-withStandards&#39;</span>, <span class="at">board =</span> <span class="st">&#39;rsconnect&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="reorganize-conventionals-dataset" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Reorganize Conventionals Dataset</h3>
<p>The official (SAS) conventionals data schema tends to vary from IR to IR. It is essential that this data are provided to the R scripts exactly how the scripts expect data, so each cycle the provided conventionals dataset must be meticulously QAed to ensure all data are of expected name/type. Additionally, in order to automate the assessment of citizen monitoring data, we must augment the provided conventionals dataset to accommodate the level schema for each citizen monitoring parameter.</p>
<p>The nuanced data manipulation steps required to convert the conventionals data and citizen monitoring data from the provided format to the required format for automated analyses are beyond the scope of this book. Instead, the required data schema for automated assessment is provided below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="organize-metadata.html#cb24-1" aria-hidden="true" tabindex="-1"></a>conventionalsSchema <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&#39;exampleData/schemaFin.RDS&#39;</span>)</span>
<span id="cb24-2"><a href="organize-metadata.html#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="organize-metadata.html#cb24-3" aria-hidden="true" tabindex="-1"></a>conventionalsSchema <span class="sc">%&gt;%</span> <span class="co"># preview data</span></span>
<span id="cb24-4"><a href="organize-metadata.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">rownames =</span> F, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">&#39;lftip&#39;</span>, <span class="at">pageLength =</span> <span class="dv">5</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div id="htmlwidget-0d2498ab9c62cbc441e5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0d2498ab9c62cbc441e5">{"x":{"filter":"none","data":[[null,null,null,null,null],["ACB.A4","ACB.A4","ACB.A4","ACB.A5","ACB.A4"],["1111 Potomac Drive off the dock","1111 Potomac Drive off the dock","1111 Potomac Drive off the dock","Harbour Marina off the last T dock","1111 Potomac Drive off the dock"],[null,null,null,null,null],[null,null,null,null,null],["2019-12-08T14:45:00Z","2019-11-10T14:10:00Z","2019-10-25T13:20:00Z","2019-08-10T13:50:00Z","2019-10-25T13:20:00Z"],[0.3,0.3,0.3,0.3,0.3],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],["Sample ID:1 | sodium thiosulfate check failed","Sample ID:1 | Sodium thiosulfate check failed","Sample ID:2 |","Sample ID:2 |","Sample ID:1 |"],[7.14,6.33,6.66,null,6.65],["pH method:PH.1 | pH group data tier:2 |","pH method:PH.1 | pH group data tier:2 |","pH method:PH.1 | pH group data tier:2 |",null,"pH method:PH.1 | pH group data tier:2 |"],["Level II","Level II","Level II","Level II","Level II"],[5.9,8.4,13.5,null,13.7],["Water temperature method:WT.2 | Water temperature group data tier:2 |","Water temperature method:WT.2 | Water temperature group data tier:2 |","Water temperature method:WT.2 | Water temperature group data tier:2 |",null,"Water temperature method:WT.2 | Water temperature group data tier:2 |"],["Level II","Level II","Level II","Level II","Level II"],[9.8,6.8,5.6,4.2,5.4],["Dissolved oxygen method:DO.1 | Dissolved oxygen problem:V | Dissolved oxygen group data tier:2 |","Dissolved oxygen method:DO.1 | Dissolved oxygen problem:V | Dissolved oxygen group data tier:2 |","Dissolved oxygen method:DO.1 | Dissolved oxygen group data tier:2 |","Dissolved oxygen method:DO.1 | Dissolved oxygen group data tier:2 |","Dissolved oxygen method:DO.1 | Dissolved oxygen group data tier:2 |"],["Level II","Level II","Level II","Level II","Level II"],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,33,133,null,166],[null,"E# coli method:ECOLI.1 | E# coli group data tier:1 |","E# coli method:ECOLI.1 | E# coli group data tier:1 |",null,"E# coli method:ECOLI.1 | E# coli group data tier:1 |"],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[38.2744,38.2744,38.2744,38.0279,38.2744],[-77.0237,-77.0237,-77.0237,-77.2329,-77.0237],["Rosier Creek-Potomac River","Rosier Creek-Potomac River","Rosier Creek-Potomac River","Jacks Creek-Maracossic Creek","Rosier Creek-Potomac River"],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],["Total Depth M:0.3 | Total Depth method:TD.1 | Total Depth group data tier:1 | Secchi Depth M:0.3 | Secchi Depth group data tier:1 | Air temperature C:3.1 | Air temperature method:AT.2 | Air temperature group data tier:2 | Stream Flow:Low | Tidal Stage:Low | Water Color:Normal | Water Surfaces:Calm | Weather Conditions Today:Sunny |","Total Depth M:0.6 | Total Depth method:TD.1 | Total Depth group data tier:1 | Secchi Depth M:0.6 | Secchi Depth qualifier:&gt; | Secchi Depth group data tier:1 | Air temperature C:8.2 | Air temperature method:AT.2 | Air temperature group data tier:2 | Stream Flow:Dry (Negligible) | Tidal Stage:Outgoing (ebb) | Water Color:Normal | Water Surfaces:Calm | Weather Conditions Today:Partly cloudy |","Air temperature C:11.02 | Air temperature method:AT.2 | Air temperature group data tier:2 | Stream Flow:Normal | Tidal Stage:Outgoing (ebb) | Water Color:Normal | Water Surfaces:Calm | Weather Conditions Today:Partly cloudy | Wind Speed:Calm |","Stream Flow:Normal | Tidal Stage:Outgoing (ebb) | Water Color:Normal | Water Surfaces:Calm | Weather Conditions Today:Sunny |","Total Depth M:0.6 | Total Depth method:TD.1 | Total Depth group data tier:1 | Secchi Depth M:0.6 | Secchi Depth qualifier:&gt; | Secchi Depth group data tier:1 | Air temperature C:10.8 | Air temperature method:AT.2 | Air temperature group data tier:2 | Stream Flow:Normal | Tidal Stage:Outgoing (ebb) | Water Color:Normal | Water Surfaces:Calm | Weather Conditions Today:Partly cloudy | Wind Speed:Calm |"],["2019 CMC - Green Aquia","2019 CMC - Green Aquia","2019 CMC - Green Aquia","2019 CMC - Green Aquia","2019 CMC - Green Aquia"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>FDT_STA_ID<\/th>\n      <th>GROUP_STA_ID<\/th>\n      <th>STA_DESC<\/th>\n      <th>Deq_Region<\/th>\n      <th>STA_REC_CODE<\/th>\n      <th>FDT_DATE_TIME<\/th>\n      <th>FDT_DEPTH<\/th>\n      <th>FDT_DEPTH_DESC<\/th>\n      <th>FDT_PERCENT_FRB<\/th>\n      <th>FDT_SSC_CODE<\/th>\n      <th>FDT_SPG_CODE<\/th>\n      <th>FDT_COMMENT<\/th>\n      <th>FDT_FIELD_PH<\/th>\n      <th>RMK_FDT_FIELD_PH<\/th>\n      <th>LEVEL_FDT_FIELD_PH<\/th>\n      <th>FDT_TEMP_CELCIUS<\/th>\n      <th>RMK_FDT_TEMP_CELCIUS<\/th>\n      <th>LEVEL_FDT_TEMP_CELCIUS<\/th>\n      <th>DO_mg_L<\/th>\n      <th>RMK_DO<\/th>\n      <th>LEVEL_DO<\/th>\n      <th>DISSOLVED_OXYGEN_00300_mg_L<\/th>\n      <th>RMK_FDT_DO_PROBE<\/th>\n      <th>LEVEL_FDT_DO_PROBE<\/th>\n      <th>DISSOLVED_OXYGEN_DOOPT_mg_L<\/th>\n      <th>RMK_FDT_DO_OPTICAL<\/th>\n      <th>LEVEL_FDT_DO_OPTICAL<\/th>\n      <th>DISSOLVED_OXYGEN_WINK_mg_L<\/th>\n      <th>RMK_FDT_DO_WINKLER<\/th>\n      <th>LEVEL_FDT_DO_WINKLER<\/th>\n      <th>FDT_SPECIFIC_CONDUCTANCE<\/th>\n      <th>RMK_FDT_SPECIFIC_CONDUCTANCE<\/th>\n      <th>LEVEL_FDT_SPECIFIC_CONDUCTANCE<\/th>\n      <th>FDT_SALINITY<\/th>\n      <th>RMK_FDT_SALINITY<\/th>\n      <th>LEVEL_FDT_SALINITY<\/th>\n      <th>NITROGEN_mg_L<\/th>\n      <th>RMK_NITROGEN<\/th>\n      <th>LEVEL_NITROGEN<\/th>\n      <th>AMMONIA_mg_L<\/th>\n      <th>RMK_AMMONIA<\/th>\n      <th>LEVEL_AMMONIA<\/th>\n      <th>NITRATE_mg_L<\/th>\n      <th>RMK_NITRATE<\/th>\n      <th>LEVEL_NITRATE<\/th>\n      <th>NOX_mg_L<\/th>\n      <th>RMK_NOX<\/th>\n      <th>LEVEL_NOX<\/th>\n      <th>NITROGEN_TOTAL_00600_mg_L<\/th>\n      <th>RMK_00600<\/th>\n      <th>LEVEL_00600<\/th>\n      <th>NITROGEN_AMMONIA_DISSOLVED_00608_mg_L<\/th>\n      <th>RMK_00608<\/th>\n      <th>LEVEL_00608<\/th>\n      <th>NITROGEN_AMMONIA_TOTAL_00610_mg_L<\/th>\n      <th>RMK_00610<\/th>\n      <th>LEVEL_00610<\/th>\n      <th>NITROGEN_NITRITE_DISSOLVED_00613_mg_L<\/th>\n      <th>RMK_00613<\/th>\n      <th>LEVEL_00613<\/th>\n      <th>NITROGEN_NITRITE_TOTAL_00615_mg_L<\/th>\n      <th>RMK_00615<\/th>\n      <th>LEVEL_00615<\/th>\n      <th>NITROGEN_NITRATE_DISSOLVED_00618_mg_L<\/th>\n      <th>RMK_00618<\/th>\n      <th>LEVEL_00618<\/th>\n      <th>NITROGEN_NITRATE_TOTAL_00620_mg_L<\/th>\n      <th>RMK_00620<\/th>\n      <th>LEVEL_00620<\/th>\n      <th>NITROGEN_KJELDAHL_TOTAL_00625_mg_L<\/th>\n      <th>RMK_00625<\/th>\n      <th>LEVEL_00625<\/th>\n      <th>NITRITE+NITRATE_TOTAL_00630_mg_L<\/th>\n      <th>RMK_00630<\/th>\n      <th>LEVEL_00630<\/th>\n      <th>NITRITE+NITRATE_DISSOLVED_00631_mg_L<\/th>\n      <th>RMK_00631<\/th>\n      <th>LEVEL_00631<\/th>\n      <th>NITROGEN_PARTICULATE_49570_mg_L<\/th>\n      <th>RMK_49570<\/th>\n      <th>LEVEL_49570<\/th>\n      <th>NITROGEN_TOTAL_DISSOLVED_49571_mg_L<\/th>\n      <th>RMK_49571<\/th>\n      <th>LEVEL_49571<\/th>\n      <th>NITROGEN_TOTAL_DISSOLVED_TDNLF_mg_L<\/th>\n      <th>RMK_TDNLF<\/th>\n      <th>LEVEL_TDNLF<\/th>\n      <th>PHOSPHORUS_mg_L<\/th>\n      <th>RMK_PHOSPHORUS<\/th>\n      <th>LEVEL_PHOSPHORUS<\/th>\n      <th>PHOSPHORUS_TOTAL_00665_mg_L<\/th>\n      <th>RMK_00665<\/th>\n      <th>LEVEL_00665<\/th>\n      <th>PHOSPHORUS_DISSOLVED_00666_mg_L<\/th>\n      <th>RMK_00666<\/th>\n      <th>LEVEL_00666<\/th>\n      <th>PHOSPHORUS_DISSOLVED_ORTHOPHOSPHATE_00671_mg_L<\/th>\n      <th>RMK_00671<\/th>\n      <th>LEVEL_00671<\/th>\n      <th>PHOSPHOROUS_PARTICULATE_49567_mg_L<\/th>\n      <th>RMK_49567<\/th>\n      <th>LEVEL_49567<\/th>\n      <th>PHOSPHOROUS_TOTAL_DISSOLVED_49572_mg_L<\/th>\n      <th>RMK_49572<\/th>\n      <th>LEVEL_49572<\/th>\n      <th>PHOSPHORUS_TOTAL_ORTHOPHOSPHATE_70507_mg_L<\/th>\n      <th>RMK_70507<\/th>\n      <th>LEVEL_70507<\/th>\n      <th>ORTHOPHOSPHATE_DISSOLVED_OPWLF_mg_L<\/th>\n      <th>RMK_OPWLF<\/th>\n      <th>LEVEL_OPWLF<\/th>\n      <th>PHOSPHORUS_SUSPENDED_INORGANIC_PIPLF_mg_L<\/th>\n      <th>RMK_PIPLF<\/th>\n      <th>LEVEL_PIPLF<\/th>\n      <th>PHOSPHORUS_PARTICULATE_PPWLF_mg_L<\/th>\n      <th>RMK_PPWLF<\/th>\n      <th>LEVEL_PPWLF<\/th>\n      <th>PHOSPHORUS_TOTAL_DISSOLVED_TDPLF_mg_L<\/th>\n      <th>RMK_TDPLF<\/th>\n      <th>LEVEL_TDPLF<\/th>\n      <th>HARDNESS_TOTAL_00900_mg_L<\/th>\n      <th>RMK_00900<\/th>\n      <th>LEVEL_00900<\/th>\n      <th>CHLORIDE_mg_L<\/th>\n      <th>RMK_CHLORIDE<\/th>\n      <th>LEVEL_CHLORIDE<\/th>\n      <th>CHLORIDE_TOTAL_00940_mg_L<\/th>\n      <th>RMK_00940<\/th>\n      <th>LEVEL_00940<\/th>\n      <th>CHLORIDE_DISSOLVED_00941_mg_L<\/th>\n      <th>RMK_00941<\/th>\n      <th>LEVEL_00941<\/th>\n      <th>SULFATE_mg_L<\/th>\n      <th>RMK_SULFATE<\/th>\n      <th>LEVEL_SULFATE<\/th>\n      <th>SULFATE_TOTAL_mg_L<\/th>\n      <th>RMK_SULFATE_TOTAL<\/th>\n      <th>LEVEL_SULFATE_TOTAL<\/th>\n      <th>SULFATE_DISS_mg_L<\/th>\n      <th>RMK_SULFATE_DISS<\/th>\n      <th>LEVEL_SULFATE_DISS<\/th>\n      <th>ECOLI<\/th>\n      <th>RMK_ECOLI<\/th>\n      <th>LEVEL_ECOLI<\/th>\n      <th>ECOLI_31648_NO_100mL<\/th>\n      <th>RMK_31648<\/th>\n      <th>LEVEL_31648<\/th>\n      <th>ENTEROCOCCI<\/th>\n      <th>RMK_ENTEROCOCCI<\/th>\n      <th>LEVEL_ENTEROCOCCI<\/th>\n      <th>FECAL_COLI<\/th>\n      <th>RMK_FECAL_COLI<\/th>\n      <th>LEVEL_FECAL_COLI<\/th>\n      <th>CHLOROPHYLL_A_ug_L<\/th>\n      <th>RMK_CHLOROPHYLL_A<\/th>\n      <th>LEVEL_CHLOROPHYLL_A<\/th>\n      <th>TSS_mg_L<\/th>\n      <th>RMK_TSS<\/th>\n      <th>LEVEL_TSS<\/th>\n      <th>TOTAL_SUSPENDED_SOLIDS_00530_mg_L<\/th>\n      <th>RMK_00530<\/th>\n      <th>LEVEL_00530<\/th>\n      <th>SSC_mg_L<\/th>\n      <th>RMK_SSC<\/th>\n      <th>LEVEL_SSC<\/th>\n      <th>TOTAL_SUSPENDED_SOLIDS_TSS45_mg_L<\/th>\n      <th>RMK_TSS45<\/th>\n      <th>LEVEL_TSS45<\/th>\n      <th>SECCHI_DEPTH_M<\/th>\n      <th>RMK_SECCHI_DEPTH<\/th>\n      <th>LEVEL_SECCHI_DEPTH<\/th>\n      <th>Latitude<\/th>\n      <th>Longitude<\/th>\n      <th>Waterbody<\/th>\n      <th>Huc6_Huc_8<\/th>\n      <th>Huc6_Huc_8_Name<\/th>\n      <th>Huc6_Name<\/th>\n      <th>Huc6_Vahu5<\/th>\n      <th>Huc6_Huc_12<\/th>\n      <th>Huc6_Huc_12_Name<\/th>\n      <th>Huc6_Vahu6<\/th>\n      <th>STA_LV1_CODE<\/th>\n      <th>LV1_DESCRIPTION<\/th>\n      <th>STA_LV2_CODE<\/th>\n      <th>LV2_DESCRIPTION<\/th>\n      <th>STA_LV3_CODE<\/th>\n      <th>LV3_DESCRIPTION<\/th>\n      <th>STA_CBP_NAME<\/th>\n      <th>OTHER_CITMON_NONAGENCY_INFO<\/th>\n      <th>Data_Source<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"lftip","pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[6,12,15,18,33,144,168,171,172]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="add-citizen-monitoring-data-to-conventionals" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Add Citizen Monitoring Data to conventionals</h3>
<p>Once the citizen monitoring data is queried, QAed, and matches the required conventionals schema (above), the data can be appended to the conventionals dataset for automated analysis.</p>
</div>
<div id="adding-secchi-depth-to-conventionals-dataset" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Adding Secchi Depth to conventionals dataset</h3>
<p>This data are not included in the official (SAS) conventionals data pull but are required for Trophic State Index (TSI) analyses for some lacustrine stations. The below script will only work if a user’s credentials have access to production ODS wqm data. The example script below first finds all unique stations in the conventionals dataset before querying secchi depth information for those stations for the given assessment window. The date range requires updating each assessment cycle.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="organize-metadata.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset of all the unique stations that we need to organize</span></span>
<span id="cb25-2"><a href="organize-metadata.html#cb25-2" aria-hidden="true" tabindex="-1"></a>conventionals_distinct <span class="ot">&lt;-</span> conventionals <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="organize-metadata.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(FDT_STA_ID, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="organize-metadata.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove any data to avoid confusion</span></span>
<span id="cb25-5"><a href="organize-metadata.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(FDT_STA_ID<span class="sc">:</span>FDT_COMMENT, Latitude<span class="sc">:</span>Data_Source) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="organize-metadata.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(FDT_STA_ID))</span>
<span id="cb25-7"><a href="organize-metadata.html#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="organize-metadata.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Query secchi data for unique conventionals stations in the appropriate data window</span></span>
<span id="cb25-9"><a href="organize-metadata.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pool)</span>
<span id="cb25-10"><a href="organize-metadata.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb25-11"><a href="organize-metadata.html#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="do">### connect to Production Environment</span></span>
<span id="cb25-12"><a href="organize-metadata.html#cb25-12" aria-hidden="true" tabindex="-1"></a>pool <span class="ot">&lt;-</span> <span class="fu">dbPool</span>(</span>
<span id="cb25-13"><a href="organize-metadata.html#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">drv =</span> odbc<span class="sc">::</span><span class="fu">odbc</span>(),</span>
<span id="cb25-14"><a href="organize-metadata.html#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Driver =</span> <span class="st">&quot;ODBC Driver 11 for SQL Server&quot;</span>,</span>
<span id="cb25-15"><a href="organize-metadata.html#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Server=</span> <span class="st">&quot;DEQ-SQLODS-PROD,50000&quot;</span>,</span>
<span id="cb25-16"><a href="organize-metadata.html#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">dbname =</span> <span class="st">&quot;ODS&quot;</span>,</span>
<span id="cb25-17"><a href="organize-metadata.html#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">trusted_connection =</span> <span class="st">&quot;yes&quot;</span></span>
<span id="cb25-18"><a href="organize-metadata.html#cb25-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-19"><a href="organize-metadata.html#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="organize-metadata.html#cb25-20" aria-hidden="true" tabindex="-1"></a>stationSecchiDepth <span class="ot">&lt;-</span> pool <span class="sc">%&gt;%</span> <span class="fu">tbl</span>(<span class="fu">in_schema</span>(<span class="st">&#39;wqm&#39;</span>, <span class="st">&quot;Wqm_Field_Data_View&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-21"><a href="organize-metadata.html#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Fdt_Sta_Id <span class="sc">%in%</span> <span class="sc">!!</span> conventionals_distinct<span class="sc">$</span>FDT_STA_ID <span class="sc">&amp;</span> </span>
<span id="cb25-22"><a href="organize-metadata.html#cb25-22" aria-hidden="true" tabindex="-1"></a>           <span class="fu">between</span>(<span class="fu">as.Date</span>(Fdt_Date_Time), <span class="st">&quot;2014-12-31&quot;</span>, <span class="st">&quot;2020-12-31&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb25-23"><a href="organize-metadata.html#cb25-23" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(Fdt_Secchi_Depth)) <span class="sc">%&gt;%</span> <span class="co"># x &gt;= left &amp; x &lt;= right</span></span>
<span id="cb25-24"><a href="organize-metadata.html#cb25-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Fdt_Sta_Id, Fdt_Date_Time, Fdt_Depth, Fdt_Secchi_Depth) <span class="sc">%&gt;%</span></span>
<span id="cb25-25"><a href="organize-metadata.html#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-26"><a href="organize-metadata.html#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Fdt_Date_Time)) <span class="sc">%&gt;%</span></span>
<span id="cb25-27"><a href="organize-metadata.html#cb25-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">FDT_STA_ID =</span> Fdt_Sta_Id, Date, <span class="at">FDT_DEPTH =</span> Fdt_Depth, Fdt_Secchi_Depth) </span></code></pre></div>
<p>Once the secchi data is acquired, it can be attached to the original conventionals dataset carefully as detailed below.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="organize-metadata.html#cb26-1" aria-hidden="true" tabindex="-1"></a>conventionalsArchive <span class="ot">&lt;-</span> conventionals <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="organize-metadata.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(FDT_DATE_TIME))</span>
<span id="cb26-3"><a href="organize-metadata.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="organize-metadata.html#cb26-4" aria-hidden="true" tabindex="-1"></a>conventionals <span class="ot">&lt;-</span> <span class="fu">left_join</span>(conventionalsArchive, stationSecchiDepth, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;FDT_STA_ID&#39;</span>, <span class="st">&#39;Date&#39;</span>, <span class="st">&#39;FDT_DEPTH&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="organize-metadata.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SECCHI_DEPTH_M =</span> Fdt_Secchi_Depth) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="organize-metadata.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Fdt_Secchi_Depth, Date))</span></code></pre></div>
</div>
<div id="clean-up-pcb-dataset" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Clean up PCB dataset</h3>
<p>IR 2022 had to use fuzzyjoining to get PCB StationID to a real DEQ StationID for the data to show up in apps.</p>
</div>
<div id="clean-up-fish-tissue-dataset" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Clean up Fish Tissue dataset</h3>
<p>Who knows what this will look like. We really need a better system for updating data.</p>
</div>
<div id="stationstablebegin" class="section level3" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> stationsTablebegin</h3>
<p><strong>No scripts/data here on purpose bc method in flux since moved to CEDS WQA</strong></p>
<p>The so called “stationsTablebegin” dataset contains all the stations that need to be addressed in a given IR cycle. This is not limited to just stations with data in that window, however. The stations that are included in this dataset are all the unique stations from the current cycle’s conventionals dataset (conventionals + citizen monitoring data) and any stations from the previous assessment cycle that might need to be carried over. AU information will accompany a dataset of distinct stations and pertinent metadata that need assessment information for the forthcoming cycle. WQS information is only joined to the conventionals dataset at a later step and does not accompany the aforementioned station information. The format of this dataset mimics the CEDS bulk upload template.</p>
<p>To help identify any stations that need to be carried over from one cycle to the next, we start with the previous cycle’s final stations table and look for any stations that aren’t Fully Supporting. These stations are added to the distinct stations from the conventionals dataset.</p>
<p>The above data are manipulated to match the bulk data upload template. This is where AU information is joined in from the previous assessment cycle. If a station wasn’t sampled last assessment (and had AU information from the metadata attribution process) it is then joined to the dataset.</p>
<p>This dataset is the start of the automated assessment process. It is saved as a .csv and used for upload to both the automated assessment scripts and the riverine and lacustrine applications. The reason the data are stored in .csv and not on the server is to enable individual assessors to adjust AU information manually whenever needed. If this data were stored on the server then the Assessment Data Analyst would need to be involved anytime an assessor needed to adjust which AU(s) a station is connected to. This data is available for download from each of the riverine and lacustrine assessment applications.</p>
</div>
<div id="pin-official-clean-ir-data-to-r-server" class="section level3" number="3.2.8">
<h3><span class="header-section-number">3.2.8</span> Pin Official Clean IR data to R server</h3>
<p>By cleaning up all provided data and then pinning to the R server, we can easily distribute and archive all data required and sourced by automated scripts in on secure location. The assessment applications source the pinned data to expedite application rendering time.</p>
<p>The official assessment data pinned to the R server include:</p>
<ul>
<li>Conventionals dataset (including citizen monitoring data)</li>
<li>Water Column Metals</li>
<li>Sediment Metals</li>
</ul>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="metadata-attribution.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="automated-assessment.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": null
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
